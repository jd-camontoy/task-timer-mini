!function(){return function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[a]={exports:{}};t[a][0].call(c.exports,function(e){return i(t[a][1][e]||e)},c,c.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}}()({1:[function(e,t,n){"use strict";n.byteLength=function(e){var t=u(e),n=t[1];return 3*(t[0]+n)/4-n},n.toByteArray=function(e){var t,n,r=u(e),a=r[0],s=r[1],l=new o(function(e,t,n){return 3*(t+n)/4-n}(0,a,s)),c=0,p=s>0?a-4:a;for(n=0;n<p;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],l[c++]=t>>16&255,l[c++]=t>>8&255,l[c++]=255&t;2===s&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,l[c++]=255&t);1===s&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,l[c++]=t>>8&255,l[c++]=255&t);return l},n.fromByteArray=function(e){for(var t,n=e.length,i=n%3,o=[],a=0,s=n-i;a<s;a+=16383)o.push(c(e,a,a+16383>s?s:a+16383));1===i?o.push(r[(t=e[n-1])>>2]+r[t<<4&63]+"=="):2===i&&o.push(r[(t=(e[n-2]<<8)+e[n-1])>>10]+r[t>>4&63]+r[t<<2&63]+"=");return o.join("")};for(var r=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,l=a.length;s<l;++s)r[s]=a[s],i[a.charCodeAt(s)]=s;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function c(e,t,n){for(var i,o=[],a=t;a<n;a+=3)o.push(r[(i=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]))>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},{}],2:[function(e,t,n){(function(t){(function(){"use strict";var t=e("base64-js"),r=e("ieee754");n.Buffer=a,n.SlowBuffer=function(e){+e!=e&&(e=0);return a.alloc(+e)},n.INSPECT_MAX_BYTES=50;var i=2147483647;function o(e){if(e>i)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return t.__proto__=a.prototype,t}function a(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return u(e)}return s(e,t,n)}function s(e,t,n){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!a.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var n=0|h(e,t),r=o(n),i=r.write(e,t);i!==n&&(r=r.slice(0,i));return r}(e,t);if(ArrayBuffer.isView(e))return c(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(F(e,ArrayBuffer)||e&&F(e.buffer,ArrayBuffer))return function(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');var r;r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n);return r.__proto__=a.prototype,r}(e,t,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var r=e.valueOf&&e.valueOf();if(null!=r&&r!==e)return a.from(r,t,n);var i=function(e){if(a.isBuffer(e)){var t=0|p(e.length),n=o(t);return 0===n.length?n:(e.copy(n,0,0,t),n)}if(void 0!==e.length)return"number"!=typeof e.length||z(e.length)?o(0):c(e);if("Buffer"===e.type&&Array.isArray(e.data))return c(e.data)}(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return a.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function u(e){return l(e),o(e<0?0:0|p(e))}function c(e){for(var t=e.length<0?0:0|p(e.length),n=o(t),r=0;r<t;r+=1)n[r]=255&e[r];return n}function p(e){if(e>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return 0|e}function h(e,t){if(a.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||F(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return R(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return I(e).length;default:if(i)return r?-1:R(e).length;t=(""+t).toLowerCase(),i=!0}}function f(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function d(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),z(n=+n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=a.from(t,r)),a.isBuffer(t))return 0===t.length?-1:m(e,t,n,r,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):m(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function m(e,t,n,r,i){var o,a=1,s=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;a=2,s/=2,l/=2,n/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var c=-1;for(o=n;o<s;o++)if(u(e,o)===u(t,-1===c?0:o-c)){if(-1===c&&(c=o),o-c+1===l)return c*a}else-1!==c&&(o-=o-c),c=-1}else for(n+l>s&&(n=s-l),o=n;o>=0;o--){for(var p=!0,h=0;h<l;h++)if(u(e,o+h)!==u(t,h)){p=!1;break}if(p)return o}return-1}function v(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;r>o/2&&(r=o/2);for(var a=0;a<r;++a){var s=parseInt(t.substr(2*a,2),16);if(z(s))return a;e[n+a]=s}return a}function b(e,t,n,r){return B(R(t,e.length-n),e,n,r)}function g(e,t,n,r){return B(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function y(e,t,n,r){return g(e,t,n,r)}function w(e,t,n,r){return B(I(t),e,n,r)}function _(e,t,n,r){return B(function(e,t){for(var n,r,i=[],o=0;o<e.length&&!((t-=2)<0);++o)n=e.charCodeAt(o),r=n>>8,i.push(n%256),i.push(r);return i}(t,e.length-n),e,n,r)}function x(e,n,r){return t.fromByteArray(0===n&&r===e.length?e:e.slice(n,r))}function k(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o,a,s,l,u=e[i],c=null,p=u>239?4:u>223?3:u>191?2:1;if(i+p<=n)switch(p){case 1:u<128&&(c=u);break;case 2:128==(192&(o=e[i+1]))&&(l=(31&u)<<6|63&o)>127&&(c=l);break;case 3:a=e[i+2],128==(192&(o=e[i+1]))&&128==(192&a)&&(l=(15&u)<<12|(63&o)<<6|63&a)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:a=e[i+2],s=e[i+3],128==(192&(o=e[i+1]))&&128==(192&a)&&128==(192&s)&&(l=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&l<1114112&&(c=l)}null===c?(c=65533,p=1):c>65535&&(r.push((c-=65536)>>>10&1023|55296),c=56320|1023&c),r.push(c),i+=p}return function(e){var t=e.length;if(t<=C)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=C));return n}(r)}n.kMaxLength=i,(a.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&a[Symbol.species]===a&&Object.defineProperty(a,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),a.poolSize=8192,a.from=function(e,t,n){return s(e,t,n)},a.prototype.__proto__=Uint8Array.prototype,a.__proto__=Uint8Array,a.alloc=function(e,t,n){return function(e,t,n){return l(e),e<=0?o(e):void 0!==t?"string"==typeof n?o(e).fill(t,n):o(e).fill(t):o(e)}(e,t,n)},a.allocUnsafe=function(e){return u(e)},a.allocUnsafeSlow=function(e){return u(e)},a.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==a.prototype},a.compare=function(e,t){if(F(e,Uint8Array)&&(e=a.from(e,e.offset,e.byteLength)),F(t,Uint8Array)&&(t=a.from(t,t.offset,t.byteLength)),!a.isBuffer(e)||!a.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},a.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return a.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=a.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var o=e[n];if(F(o,Uint8Array)&&(o=a.from(o)),!a.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},a.byteLength=h,a.prototype._isBuffer=!0,a.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)f(this,t,t+1);return this},a.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)f(this,t,t+3),f(this,t+1,t+2);return this},a.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)f(this,t,t+7),f(this,t+1,t+6),f(this,t+2,t+5),f(this,t+3,t+4);return this},a.prototype.toLocaleString=a.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?k(this,0,e):function(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return P(this,t,n);case"utf8":case"utf-8":return k(this,t,n);case"ascii":return E(this,t,n);case"latin1":case"binary":return A(this,t,n);case"base64":return x(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}.apply(this,arguments)},a.prototype.equals=function(e){if(!a.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===a.compare(this,e)},a.prototype.inspect=function(){var e="",t=n.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},a.prototype.compare=function(e,t,n,r,i){if(F(e,Uint8Array)&&(e=a.from(e,e.offset,e.byteLength)),!a.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0),l=Math.min(o,s),u=this.slice(r,i),c=e.slice(t,n),p=0;p<l;++p)if(u[p]!==c[p]){o=u[p],s=c[p];break}return o<s?-1:s<o?1:0},a.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},a.prototype.indexOf=function(e,t,n){return d(this,e,t,n,!0)},a.prototype.lastIndexOf=function(e,t,n){return d(this,e,t,n,!1)},a.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return v(this,e,t,n);case"utf8":case"utf-8":return b(this,e,t,n);case"ascii":return g(this,e,t,n);case"latin1":case"binary":return y(this,e,t,n);case"base64":return w(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var C=4096;function E(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function A(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function P(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=L(e[o]);return i}function M(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function S(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function T(e,t,n,r,i,o){if(!a.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function V(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function j(e,t,n,i,o){return t=+t,n>>>=0,o||V(e,0,n,4),r.write(e,t,n,i,23,4),n+4}function O(e,t,n,i,o){return t=+t,n>>>=0,o||V(e,0,n,8),r.write(e,t,n,i,52,8),n+8}a.prototype.slice=function(e,t){var n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var r=this.subarray(e,t);return r.__proto__=a.prototype,r},a.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||S(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},a.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||S(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},a.prototype.readUInt8=function(e,t){return e>>>=0,t||S(e,1,this.length),this[e]},a.prototype.readUInt16LE=function(e,t){return e>>>=0,t||S(e,2,this.length),this[e]|this[e+1]<<8},a.prototype.readUInt16BE=function(e,t){return e>>>=0,t||S(e,2,this.length),this[e]<<8|this[e+1]},a.prototype.readUInt32LE=function(e,t){return e>>>=0,t||S(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},a.prototype.readUInt32BE=function(e,t){return e>>>=0,t||S(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},a.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||S(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},a.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||S(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},a.prototype.readInt8=function(e,t){return e>>>=0,t||S(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},a.prototype.readInt16LE=function(e,t){e>>>=0,t||S(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt16BE=function(e,t){e>>>=0,t||S(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt32LE=function(e,t){return e>>>=0,t||S(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},a.prototype.readInt32BE=function(e,t){return e>>>=0,t||S(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},a.prototype.readFloatLE=function(e,t){return e>>>=0,t||S(e,4,this.length),r.read(this,e,!0,23,4)},a.prototype.readFloatBE=function(e,t){return e>>>=0,t||S(e,4,this.length),r.read(this,e,!1,23,4)},a.prototype.readDoubleLE=function(e,t){return e>>>=0,t||S(e,8,this.length),r.read(this,e,!0,52,8)},a.prototype.readDoubleBE=function(e,t){return e>>>=0,t||S(e,8,this.length),r.read(this,e,!1,52,8)},a.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t>>>=0,n>>>=0,r)||T(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},a.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t>>>=0,n>>>=0,r)||T(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},a.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||T(this,e,t,1,255,0),this[t]=255&e,t+1},a.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||T(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},a.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||T(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},a.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||T(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},a.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||T(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},a.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var i=Math.pow(2,8*n-1);T(this,e,t,n,i-1,-i)}var o=0,a=1,s=0;for(this[t]=255&e;++o<n&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},a.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var i=Math.pow(2,8*n-1);T(this,e,t,n,i-1,-i)}var o=n-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},a.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||T(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},a.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||T(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},a.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||T(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},a.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||T(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},a.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||T(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},a.prototype.writeFloatLE=function(e,t,n){return j(this,e,t,!0,n)},a.prototype.writeFloatBE=function(e,t,n){return j(this,e,t,!1,n)},a.prototype.writeDoubleLE=function(e,t,n){return O(this,e,t,!0,n)},a.prototype.writeDoubleBE=function(e,t,n){return O(this,e,t,!1,n)},a.prototype.copy=function(e,t,n,r){if(!a.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i=r-n;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,n,r);else if(this===e&&n<t&&t<r)for(var o=i-1;o>=0;--o)e[o+t]=this[o+n];else Uint8Array.prototype.set.call(e,this.subarray(n,r),t);return i},a.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!a.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===e.length){var i=e.charCodeAt(0);("utf8"===r&&i<128||"latin1"===r)&&(e=i)}}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var s=a.isBuffer(e)?e:a.from(e,r),l=s.length;if(0===l)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<n-t;++o)this[o+t]=s[o%l]}return this};var D=/[^+/0-9A-Za-z-_]/g;function L(e){return e<16?"0"+e.toString(16):e.toString(16)}function R(e,t){var n;t=t||Infinity;for(var r=e.length,i=null,o=[],a=0;a<r;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function I(e){return t.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(D,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function B(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function F(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function z(e){return e!=e}}).call(this)}).call(this,e("buffer").Buffer)},{"base64-js":1,buffer:2,ieee754:3}],3:[function(e,t,n){n.read=function(e,t,n,r,i){var o,a,s=8*i-r-1,l=(1<<s)-1,u=l>>1,c=-7,p=n?i-1:0,h=n?-1:1,f=e[t+p];for(p+=h,o=f&(1<<-c)-1,f>>=-c,c+=s;c>0;o=256*o+e[t+p],p+=h,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=r;c>0;a=256*a+e[t+p],p+=h,c-=8);if(0===o)o=1-u;else{if(o===l)return a?NaN:Infinity*(f?-1:1);a+=Math.pow(2,r),o-=u}return(f?-1:1)*a*Math.pow(2,o-r)},n.write=function(e,t,n,r,i,o){var a,s,l,u=8*o-i-1,c=(1<<u)-1,p=c>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:o-1,d=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||Infinity===t?(s=isNaN(t)?1:0,a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),(t+=a+p>=1?h/l:h*Math.pow(2,1-p))*l>=2&&(a++,l/=2),a+p>=c?(s=0,a=c):a+p>=1?(s=(t*l-1)*Math.pow(2,i),a+=p):(s=t*Math.pow(2,p-1)*Math.pow(2,i),a=0));i>=8;e[n+f]=255&s,f+=d,s/=256,i-=8);for(a=a<<i|s,u+=i;u>0;e[n+f]=255&a,f+=d,a/=256,u-=8);e[n+f-d]|=128*m}},{}],4:[function(e,t,n){var r,i;r=this,i=function(e){"use strict";class t{constructor(e){this.controller_=e}get element(){return this.controller_.view.element}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(e){this.controller_.viewProps.set("disabled",e)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(e){this.controller_.viewProps.set("hidden",e)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class n{constructor(e){this.target=e}}class r extends n{constructor(e,t,n,r){super(e),this.value=t,this.presetKey=n,this.last=null==r||r}}class i extends n{constructor(e,t,n){super(e),this.value=t,this.presetKey=n}}class o extends n{constructor(e,t){super(e),this.expanded=t}}class a extends n{constructor(e,t){super(e),this.index=t}}function s(e){return e}function l(e){return null==e}function u(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}const c={alreadydisposed:()=>"View has been already disposed",invalidparams:e=>`Invalid parameters for '${e.name}'`,nomatchingcontroller:e=>`No matching controller for '${e.key}'`,nomatchingview:e=>`No matching view for '${JSON.stringify(e.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:e=>`Property '${e.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class p{constructor(e){var t;this.message=null!==(t=c[e.type](s(e.context)))&&void 0!==t?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}static alreadyDisposed(){return new p({type:"alreadydisposed"})}static notBindable(){return new p({type:"notbindable"})}static propertyNotFound(e){return new p({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new p({type:"shouldneverhappen"})}}class h{constructor(e,t,n){this.obj_=e,this.key_=t,this.presetKey_=null!=n?n:t}static isBindable(e){return null!==e&&"object"==typeof e}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(e){this.obj_[this.key_]=e}writeProperty(e,t){const n=this.read();if(!h.isBindable(n))throw p.notBindable();if(!(e in n))throw p.propertyNotFound(e);n[e]=t}}class f extends t{get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get title(){var e;return null!==(e=this.controller_.valueController.props.get("title"))&&void 0!==e?e:""}set title(e){this.controller_.valueController.props.set("title",e)}on(e,t){const r=t.bind(this);return this.controller_.valueController.emitter.on(e,()=>{r(new n(this))}),this}}class d{constructor(){this.observers_={}}on(e,t){let n=this.observers_[e];return n||(n=this.observers_[e]=[]),n.push({handler:t}),this}off(e,t){const n=this.observers_[e];return n&&(this.observers_[e]=n.filter(e=>e.handler!==t)),this}emit(e,t){const n=this.observers_[e];n&&n.forEach(e=>{e.handler(t)})}}const m="tp";function v(e){return(t,n)=>[m,"-",e,"v",t?`_${t}`:"",n?`-${n}`:""].join("")}function b(e){return e.rawValue}function g(e,t){var n,r;e.emitter.on("change",(n=b,r=t,e=>r(n(e)))),t(e.rawValue)}function y(e,t,n){g(e.value(t),n)}function w(e,t){return n=>{!function(e,t,n){n?e.classList.add(t):e.classList.remove(t)}(e,t,n)}}function _(e,t){g(e,e=>{t.textContent=null!=e?e:""})}const x=v("btn");class k{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(x()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("button");n.classList.add(x("b")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const r=e.createElement("div");r.classList.add(x("t")),_(t.props.value("title"),r),this.buttonElement.appendChild(r)}}class C{constructor(e,t){this.emitter=new d,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new k(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class E{constructor(e,t){var n;this.constraint_=null==t?void 0:t.constraint,this.equals_=null!==(n=null==t?void 0:t.equals)&&void 0!==n?n:(e,t)=>e===t,this.emitter=new d,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const n=null!=t?t:{forceEmit:!1,last:!0},r=this.constraint_?this.constraint_.constrain(e):e;(!this.equals_(this.rawValue_,r)||n.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=r,this.emitter.emit("change",{options:n,rawValue:r,sender:this}))}}class A{constructor(e){this.emitter=new d,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const n=null!=t?t:{forceEmit:!1,last:!0};(this.value_!==e||n.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:n,rawValue:this.value_,sender:this}))}}function P(e,t){return(null==t?void 0:t.constraint)||(null==t?void 0:t.equals)?new E(e,t):new A(e)}class M{constructor(e){this.emitter=new d,this.valMap_=e;for(const e in this.valMap_){this.valMap_[e].emitter.on("change",()=>{this.emitter.emit("change",{key:e,sender:this})})}}static createCore(e){return Object.keys(e).reduce((t,n)=>Object.assign(t,{[n]:P(e[n])}),{})}static fromObject(e){const t=this.createCore(e);return new M(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}}function S(e){return t=>n=>{if(!t&&void 0===n)return{succeeded:!1,value:void 0};if(t&&void 0===n)return{succeeded:!0,value:void 0};const r=e(n);return void 0!==r?{succeeded:!0,value:r}:{succeeded:!1,value:void 0}}}function T(e){return{custom:t=>S(t)(e),boolean:S(e=>"boolean"==typeof e?e:void 0)(e),number:S(e=>"number"==typeof e?e:void 0)(e),string:S(e=>"string"==typeof e?e:void 0)(e),function:S(e=>"function"==typeof e?e:void 0)(e),constant:t=>S(e=>e===t?t:void 0)(e),raw:S(e=>e)(e),object:t=>S(e=>{if(function(e){return null!==e&&"object"==typeof e}(e))return function(e,t){return s(Object.keys(t).reduce((n,r)=>{if(void 0===n)return;const i=(0,t[r])(e[r]);return i.succeeded?Object.assign(Object.assign({},n),{[r]:i.value}):void 0},{}))}(e,t)})(e),array:t=>S(e=>{if(Array.isArray(e))return function(e,t){return e.reduce((e,n)=>{if(void 0===e)return;const r=t(n);return r.succeeded&&void 0!==r.value?[...e,r.value]:void 0},[])}(e,t)})(e)}}const V={optional:T(!0),required:T(!1)};function j(e,t){const n=V.required.object(t)(e);return n.succeeded?n.value:void 0}const O=v(""),D={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class L{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",()=>{["veryfirst","first","last","verylast"].forEach(e=>{t.classList.remove(O(void 0,D[e]))}),this.blade.get("positions").forEach(e=>{t.classList.add(O(void 0,D[e]))})}),this.viewProps.handleDispose(()=>{!function(e){e&&e.parentElement&&e.parentElement.removeChild(e)}(t)})}get parent(){return this.parent_}}const R="http://www.w3.org/2000/svg";function I(e){return void 0!==e.ontouchstart}function B(){return s(new Function("return this")()).document}const F={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function z(e,t){const n=e.createElementNS(R,"svg");return n.innerHTML=F[t],n}function U(e,t,n){e.insertBefore(t,e.children[n])}function N(e){e.parentElement&&e.parentElement.removeChild(e)}function q(e){for(;e.children.length>0;)e.removeChild(e.children[0])}function H(e){return e.relatedTarget?s(e.relatedTarget):"explicitOriginalTarget"in e?e.explicitOriginalTarget:null}const K=v("lbl");class G{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(K()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(K("l")),y(t.props,"label",t=>{l(t)?this.element.classList.add(K(void 0,"nol")):(this.element.classList.remove(K(void 0,"nol")),function(e){for(;e.childNodes.length>0;)e.removeChild(e.childNodes[0])}(n),n.appendChild(function(e,t){const n=e.createDocumentFragment();return t.split("\n").map(t=>e.createTextNode(t)).forEach((t,r)=>{r>0&&n.appendChild(e.createElement("br")),n.appendChild(t)}),n}(e,t)))}),this.element.appendChild(n),this.labelElement=n;const r=e.createElement("div");r.classList.add(K("v")),this.element.appendChild(r),this.valueElement=r}}class $ extends L{constructor(e,t){const n=t.valueController.viewProps;super(Object.assign(Object.assign({},t),{view:new G(e,{props:t.props,viewProps:n}),viewProps:n})),this.props=t.props,this.valueController=t.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const W={id:"button",type:"blade",accept(e){const t=V,n=j(e,{title:t.required.string,view:t.required.constant("button"),label:t.optional.string});return n?{params:n}:null},controller:e=>new $(e.document,{blade:e.blade,props:M.fromObject({label:e.params.label}),valueController:new C(e.document,{props:M.fromObject({title:e.params.title}),viewProps:e.viewProps})}),api:e=>e.controller instanceof $&&e.controller.valueController instanceof C?new f(e.controller):null};class Y extends L{constructor(e){super(e),this.value=e.value}}function Q(){return new M({positions:P([],{equals:u})})}class X extends M{constructor(e){super(e)}static create(e){const t=M.createCore({completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null});return new X(t)}get styleExpanded(){var e;return null!==(e=this.get("temporaryExpanded"))&&void 0!==e?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!l(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const n=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};y(this,"expanded",n),y(this,"temporaryExpanded",n)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function J(e,t){t.style.height=e.styleHeight}function Z(e,t){e.value("expanded").emitter.on("beforechange",()=>{e.set("completed",!1),l(e.get("expandedHeight"))&&e.set("expandedHeight",function(e,t){let n=0;return function(e,t){const n=e.style.transition;e.style.transition="none",t(),e.style.transition=n}(t,()=>{e.set("expandedHeight",null),e.set("temporaryExpanded",!0),n=t.clientHeight,e.set("temporaryExpanded",null)}),n}(e,t)),e.set("shouldFixHeight",!0)}),e.emitter.on("change",()=>{J(e,t)}),J(e,t),t.addEventListener("transitionend",t=>{"height"===t.propertyName&&e.cleanUpTransition()})}class ee extends t{constructor(e,t){super(e),this.rackApi_=t}}class te{constructor(e){this.emitter=new d,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw p.shouldNeverHappen();const n=void 0!==t?t:this.items_.length;this.items_.splice(n,0,e),this.cache_.add(e);const r=this.extract_(e);r&&(r.emitter.on("add",this.onSubListAdd_),r.emitter.on("remove",this.onSubListRemove_),r.allItems().forEach(e=>{this.cache_.add(e)})),this.emitter.emit("add",{index:n,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const n=this.extract_(e);n&&(n.emitter.off("add",this.onSubListAdd_),n.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}}class ne extends t{constructor(e){super(e),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new d,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,e=>{n(e.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(e){const t=e.sender.target.read();this.emitter_.emit("change",{event:new r(this,s(t),this.controller_.binding.target.presetKey,e.options.last)})}}class re extends ${constructor(e,t){super(e,t),this.binding=t.binding}}class ie extends t{constructor(e){super(e),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new d,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,e=>{n(e.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(e){const t=e.sender.target.read();this.emitter_.emit("update",{event:new i(this,s(t),this.controller_.binding.target.presetKey)})}}class oe extends ${constructor(e,t){super(e,t),this.binding=t.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function ae(e){return e instanceof ue?e.apiSet_:e instanceof ee?e.rackApi_.apiSet_:null}function se(e,t){const n=e.find(e=>e.controller_===t);if(!n)throw p.shouldNeverHappen();return n}function le(e,t,n){if(!h.isBindable(e))throw p.notBindable();return new h(e,t,n)}class ue extends t{constructor(e,t){super(e),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new d,this.apiSet_=new te(ae),this.pool_=t;const n=this.controller_.rack;n.emitter.on("add",this.onRackAdd_),n.emitter.on("remove",this.onRackRemove_),n.emitter.on("inputchange",this.onRackInputChange_),n.emitter.on("monitorupdate",this.onRackMonitorUpdate_),n.children.forEach(e=>{this.setUpApi_(e)})}get children(){return this.controller_.rack.children.map(e=>se(this.apiSet_,e))}addInput(e,t,n){const r=null!=n?n:{},i=this.pool_.createInput(this.controller_.view.element.ownerDocument,le(e,t,r.presetKey),r),o=new ne(i);return this.add(o,r.index)}addMonitor(e,t,n){const r=null!=n?n:{},i=this.pool_.createMonitor(this.controller_.view.element.ownerDocument,le(e,t),r),o=new ie(i);return s(this.add(o,r.index))}addFolder(e){return function(e,t){return e.addBlade(Object.assign(Object.assign({},t),{view:"folder"}))}(this,e)}addButton(e){return function(e,t){return e.addBlade(Object.assign(Object.assign({},t),{view:"button"}))}(this,e)}addSeparator(e){return function(e,t){return e.addBlade(Object.assign(Object.assign({},null!=t?t:{}),{view:"separator"}))}(this,e)}addTab(e){return function(e,t){return e.addBlade(Object.assign(Object.assign({},t),{view:"tab"}))}(this,e)}add(e,t){this.controller_.rack.add(e.controller_,t);const n=this.apiSet_.find(t=>t.controller_===e.controller_);return n&&this.apiSet_.remove(n),this.apiSet_.add(e),e}remove(e){this.controller_.rack.remove(e.controller_)}addBlade(e){const t=this.pool_.createBlade(this.controller_.view.element.ownerDocument,e),n=this.pool_.createBladeApi(t);return this.add(n,e.index)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,e=>{n(e.event)}),this}setUpApi_(e){this.apiSet_.find(t=>t.controller_===e)||this.apiSet_.add(this.pool_.createBladeApi(e))}onRackAdd_(e){this.setUpApi_(e.bladeController)}onRackRemove_(e){if(e.isRoot){const t=se(this.apiSet_,e.bladeController);this.apiSet_.remove(t)}}onRackInputChange_(e){const t=e.bladeController;if(t instanceof re){const n=se(this.apiSet_,t),i=t.binding;this.emitter_.emit("change",{event:new r(n,s(i.target.read()),i.target.presetKey,e.options.last)})}else if(t instanceof Y){const n=se(this.apiSet_,t);this.emitter_.emit("change",{event:new r(n,t.value.rawValue,void 0,e.options.last)})}}onRackMonitorUpdate_(e){if(!(e.bladeController instanceof oe))throw p.shouldNeverHappen();const t=se(this.apiSet_,e.bladeController),n=e.bladeController.binding;this.emitter_.emit("update",{event:new i(t,s(n.target.read()),n.target.presetKey)})}}class ce extends ee{constructor(e,t){super(e,new ue(e.rackController,t)),this.emitter_=new d,this.controller_.foldable.value("expanded").emitter.on("change",e=>{this.emitter_.emit("fold",{event:new o(this,e.sender.rawValue)})}),this.rackApi_.on("change",e=>{this.emitter_.emit("change",{event:e})}),this.rackApi_.on("update",e=>{this.emitter_.emit("update",{event:e})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(e){this.controller_.foldable.set("expanded",e)}get title(){return this.controller_.props.get("title")}set title(e){this.controller_.props.set("title",e)}get children(){return this.rackApi_.children}addInput(e,t,n){return this.rackApi_.addInput(e,t,n)}addMonitor(e,t,n){return this.rackApi_.addMonitor(e,t,n)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addSeparator(e){return this.rackApi_.addSeparator(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,e=>{n(e.event)}),this}}class pe extends L{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}}class he{constructor(e,t){const n=v(t.viewName);this.element=e.createElement("div"),this.element.classList.add(n()),t.viewProps.bindClassModifiers(this.element)}}function fe(e){return e instanceof ve?e.rack:e instanceof pe?e.rackController.rack:null}function de(e){const t=fe(e);return t?t.bcSet_:null}class me{constructor(e){var t;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new d,this.blade_=null!=e?e:null,null===(t=this.blade_)||void 0===t||t.value("positions").emitter.on("change",this.onBladePositionsChange_),this.bcSet_=new te(de),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){e.parent&&e.parent.remove(e),e.parent_=this,this.bcSet_.add(e,t)}remove(e){e.parent_=null,this.bcSet_.remove(e)}find(e){return s(this.bcSet_.allItems().filter(t=>t instanceof e))}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,isRoot:t,sender:this}),!t)return;const n=e.item;if(n.viewProps.emitter.on("change",this.onChildViewPropsChange_),n.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),n.viewProps.handleDispose(this.onChildDispose_),n instanceof re)n.binding.emitter.on("change",this.onChildInputChange_);else if(n instanceof oe)n.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(n instanceof Y)n.value.emitter.on("change",this.onChildValueChange_);else{const e=fe(n);if(e){const t=e.emitter;t.on("layout",this.onDescendantLayout_),t.on("inputchange",this.onDescendantInputChange_),t.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,isRoot:t,sender:this}),!t)return;const n=e.item;if(n instanceof re)n.binding.emitter.off("change",this.onChildInputChange_);else if(n instanceof oe)n.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(n instanceof Y)n.value.emitter.off("change",this.onChildValueChange_);else{const e=fe(n);if(e){const t=e.emitter;t.off("layout",this.onDescendantLayout_),t.off("inputchange",this.onDescendantInputChange_),t.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const e=this.bcSet_.items.filter(e=>!e.viewProps.get("hidden")),t=e[0],n=e[e.length-1];this.bcSet_.items.forEach(e=>{const r=[];e===t&&(r.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||r.push("veryfirst")),e===n&&(r.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||r.push("verylast")),e.blade.set("positions",r)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(e=>e.viewProps.get("disposed")).forEach(e=>{this.bcSet_.remove(e)})}onChildInputChange_(e){const t=function(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(r instanceof re&&r.binding===t)return r}return null}(this.find(re),e.sender);if(!t)throw p.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:t,options:e.options,sender:this})}onChildMonitorUpdate_(e){const t=function(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(r instanceof oe&&r.binding===t)return r}return null}(this.find(oe),e.sender);if(!t)throw p.shouldNeverHappen();this.emitter.emit("monitorupdate",{bladeController:t,sender:this})}onChildValueChange_(e){const t=function(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(r instanceof Y&&r.value===t)return r}return null}(this.find(Y),e.sender);if(!t)throw p.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:t,options:e.options,sender:this})}onDescendantLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(e){this.emitter.emit("inputchange",{bladeController:e.bladeController,options:e.options,sender:this})}onDescendantMonitorUpdate_(e){this.emitter.emit("monitorupdate",{bladeController:e.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class ve extends L{constructor(e,t){super(Object.assign(Object.assign({},t),{view:new he(e,{viewName:"brk",viewProps:t.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const n=new me(t.root?void 0:t.blade);n.emitter.on("add",this.onRackAdd_),n.emitter.on("remove",this.onRackRemove_),this.rack=n,this.viewProps.handleDispose(()=>{for(let e=this.rack.children.length-1;e>=0;e--){this.rack.children[e].viewProps.set("disposed",!0)}})}onRackAdd_(e){e.isRoot&&U(this.view.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.isRoot&&N(e.bladeController.view.element)}}const be=v("cnt");class ge{constructor(e,t){var n;this.className_=v(null!==(n=t.viewName)&&void 0!==n?n:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),be()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),y(this.foldable_,"completed",w(this.element,this.className_(void 0,"cpl")));const r=e.createElement("button");r.classList.add(this.className_("b")),y(t.props,"title",e=>{l(e)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),t.viewProps.bindDisabled(r),this.element.appendChild(r),this.buttonElement=r;const i=e.createElement("div");i.classList.add(this.className_("t")),_(t.props.value("title"),i),this.buttonElement.appendChild(i),this.titleElement=i;const o=e.createElement("div");o.classList.add(this.className_("m")),this.buttonElement.appendChild(o);const a=t.containerElement;a.classList.add(this.className_("c")),this.element.appendChild(a),this.containerElement=a}}class ye extends pe{constructor(e,t){var n;const r=X.create(null===(n=t.expanded)||void 0===n||n),i=new ve(e,{blade:t.blade,root:t.root,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:i,view:new ge(e,{containerElement:i.view.element,foldable:r,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=r,Z(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const we={id:"folder",type:"blade",accept(e){const t=V,n=j(e,{title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean});return n?{params:n}:null},controller:e=>new ye(e.document,{blade:e.blade,expanded:e.params.expanded,props:M.fromObject({title:e.params.title}),viewProps:e.viewProps}),api:e=>e.controller instanceof ye?new ce(e.controller,e.pool):null};class _e extends Y{constructor(e,t){const n=t.valueController.viewProps;super(Object.assign(Object.assign({},t),{value:t.valueController.value,view:new G(e,{props:t.props,viewProps:n}),viewProps:n})),this.props=t.props,this.valueController=t.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class xe extends t{}const ke=v("spr");class Ce{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(ke()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("hr");n.classList.add(ke("r")),this.element.appendChild(n)}}class Ee extends L{constructor(e,t){super(Object.assign(Object.assign({},t),{view:new Ce(e,{viewProps:t.viewProps})}))}}const Ae={id:"separator",type:"blade",accept(e){const t=j(e,{view:V.required.constant("separator")});return t?{params:t}:null},controller:e=>new Ee(e.document,{blade:e.blade,viewProps:e.viewProps}),api:e=>e.controller instanceof Ee?new xe(e.controller):null},Pe=v("");function Me(e,t){return w(e,Pe(void 0,t))}class Se extends M{constructor(e){super(e)}static create(e){var t,n;const r=null!=e?e:{},i={disabled:null!==(t=r.disabled)&&void 0!==t&&t,disposed:!1,hidden:null!==(n=r.hidden)&&void 0!==n&&n},o=M.createCore(i);return new Se(o)}bindClassModifiers(e){y(this,"disabled",Me(e,"disabled")),y(this,"hidden",Me(e,"hidden"))}bindDisabled(e){y(this,"disabled",t=>{e.disabled=t})}bindTabIndex(e){y(this,"disabled",t=>{e.tabIndex=t?-1:0})}handleDispose(e){this.value("disposed").emitter.on("change",t=>{t&&e()})}}const Te=v("tbi");class Ve{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Te()),t.viewProps.bindClassModifiers(this.element),y(t.props,"selected",e=>{e?this.element.classList.add(Te(void 0,"sel")):this.element.classList.remove(Te(void 0,"sel"))});const n=e.createElement("button");n.classList.add(Te("b")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const r=e.createElement("div");r.classList.add(Te("t")),_(t.props.value("title"),r),this.buttonElement.appendChild(r),this.titleElement=r}}class je{constructor(e,t){this.emitter=new d,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new Ve(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Oe{constructor(e,t){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new je(e,{props:t.itemProps,viewProps:Se.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new ve(e,{blade:Q(),viewProps:Se.create()}),this.props=t.props,y(this.props,"selected",e=>{this.itemController.props.set("selected",e),this.contentController.viewProps.set("hidden",!e)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class De{constructor(e,t){this.controller_=e,this.rackApi_=t}get title(){var e;return null!==(e=this.controller_.itemController.props.get("title"))&&void 0!==e?e:""}set title(e){this.controller_.itemController.props.set("title",e)}get selected(){return this.controller_.props.get("selected")}set selected(e){this.controller_.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addSeparator(e){return this.rackApi_.addSeparator(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addInput(e,t,n){return this.rackApi_.addInput(e,t,n)}addMonitor(e,t,n){return this.rackApi_.addMonitor(e,t,n)}addBlade(e){return this.rackApi_.addBlade(e)}}class Le extends ee{constructor(e,t){super(e,new ue(e.rackController,t)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onSelect_=this.onSelect_.bind(this),this.emitter_=new d,this.pageApiMap_=new Map,this.rackApi_.on("change",e=>{this.emitter_.emit("change",{event:e})}),this.rackApi_.on("update",e=>{this.emitter_.emit("update",{event:e})}),this.controller_.tab.selectedIndex.emitter.on("change",this.onSelect_),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(e=>{this.setUpPageApi_(e)})}get pages(){return this.controller_.pageSet.items.map(e=>{const t=this.pageApiMap_.get(e);if(!t)throw p.shouldNeverHappen();return t})}addPage(e){const t=new Oe(this.controller_.view.element.ownerDocument,{itemProps:M.fromObject({selected:!1,title:e.title}),props:M.fromObject({selected:!1})});this.controller_.add(t,e.index);const n=this.pageApiMap_.get(t);if(!n)throw p.shouldNeverHappen();return n}removePage(e){this.controller_.remove(e)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,e=>{n(e.event)}),this}setUpPageApi_(e){const t=this.rackApi_.apiSet_.find(t=>t.controller_===e.contentController);if(!t)throw p.shouldNeverHappen();const n=new De(e,t);this.pageApiMap_.set(e,n)}onPageAdd_(e){this.setUpPageApi_(e.item)}onPageRemove_(e){if(!this.pageApiMap_.get(e.item))throw p.shouldNeverHappen();this.pageApiMap_.delete(e.item)}onSelect_(e){this.emitter_.emit("select",{event:new a(this,e.rawValue)})}}const Re=-1;class Ie{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=P(!0),this.selectedIndex=P(Re),this.items_=[]}add(e,t){this.items_.splice(null!=t?t:this.items_.length,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(0===this.items_.length)return this.selectedIndex.rawValue=Re,void(this.empty.rawValue=!0);const e=this.items_.findIndex(e=>e.rawValue);e<0?(this.items_.forEach((e,t)=>{e.rawValue=0===t}),this.selectedIndex.rawValue=0):(this.items_.forEach((t,n)=>{t.rawValue=n===e}),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex(t=>t===e.sender);this.items_.forEach((e,n)=>{e.rawValue=n===t}),this.selectedIndex.rawValue=t}else this.keepSelection_()}}const Be=v("tab");class Fe{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Be(),be()),t.viewProps.bindClassModifiers(this.element),g(t.empty,w(this.element,Be(void 0,"nop")));const n=e.createElement("div");n.classList.add(Be("i")),this.element.appendChild(n),this.itemsElement=n;const r=t.contentsElement;r.classList.add(Be("c")),this.element.appendChild(r),this.contentsElement=r}}class ze extends pe{constructor(e,t){const n=new ve(e,{blade:t.blade,viewProps:t.viewProps}),r=new Ie;super({blade:t.blade,rackController:n,view:new Fe(e,{contentsElement:n.view.element,empty:r.empty,viewProps:t.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.pageSet_=new te(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.tab=r}get pageSet(){return this.pageSet_}add(e,t){this.pageSet_.add(e,t)}remove(e){this.pageSet_.remove(this.pageSet_.items[e])}onPageAdd_(e){const t=e.item;U(this.view.itemsElement,t.itemController.view.element,e.index),this.rackController.rack.add(t.contentController,e.index),this.tab.add(t.props.value("selected"))}onPageRemove_(e){const t=e.item;N(t.itemController.view.element),this.rackController.rack.remove(t.contentController),this.tab.remove(t.props.value("selected"))}}const Ue={id:"tab",type:"blade",accept(e){const t=V,n=j(e,{pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")});return n&&0!==n.pages.length?{params:n}:null},controller(e){const t=new ze(e.document,{blade:e.blade,viewProps:e.viewProps});return e.params.pages.forEach(n=>{const r=new Oe(e.document,{itemProps:M.fromObject({selected:!1,title:n.title}),props:M.fromObject({selected:!1})});t.add(r)}),t},api:e=>e.controller instanceof ze?new Le(e.controller,e.pool):null};class Ne{constructor(){this.disabled=!1,this.emitter=new d}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class qe{constructor(e,t){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=e,this.emitter=new d,this.interval_=t,this.setTimer_()}get disabled(){return this.disabled_}set disabled(e){this.disabled_=e,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(null===this.timerId_)return;const e=this.doc_.defaultView;e&&e.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const e=this.doc_.defaultView;e&&(this.timerId_=e.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class He{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce((e,t)=>t.constrain(e),e)}}function Ke(e,t){if(e instanceof t)return e;if(e instanceof He){const n=e.constraints.reduce((e,n)=>e||(n instanceof t?n:null),null);if(n)return n}return null}class Ge{constructor(e){this.options=e}constrain(e){const t=this.options;return 0===t.length?e:t.filter(t=>t.value===e).length>0?e:t[0].value}}class $e{constructor(e){this.maxValue=e.max,this.minValue=e.min}constrain(e){let t=e;return l(this.minValue)||(t=Math.max(t,this.minValue)),l(this.maxValue)||(t=Math.min(t,this.maxValue)),t}}class We{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step;return t+Math.round((e-t)/this.step)*this.step}}const Ye=v("lst");class Qe{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(Ye()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("select");n.classList.add(Ye("s")),y(this.props_,"options",t=>{q(n),t.forEach((t,r)=>{const i=e.createElement("option");i.dataset.index=String(r),i.textContent=t.text,i.value=String(t.value),n.appendChild(i)})}),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.selectElement=n;const r=e.createElement("div");r.classList.add(Ye("m")),r.appendChild(z(e,"dropdown")),this.element.appendChild(r),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class Xe{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new Qe(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=s(e.currentTarget).selectedOptions.item(0);if(!t)return;const n=Number(t.dataset.index);this.value.rawValue=this.props.get("options")[n].value}}const Je=v("pop");class Ze{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Je()),t.viewProps.bindClassModifiers(this.element),g(t.shows,w(this.element,Je(void 0,"v")))}}class et{constructor(e,t){this.shows=P(!1),this.viewProps=t.viewProps,this.view=new Ze(e,{shows:this.shows,viewProps:this.viewProps})}}const tt=v("txt");class nt{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(tt()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const n=e.createElement("input");n.classList.add(tt("i")),n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}}class rt{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new nt(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=s(e.currentTarget),n=this.parser_(t.value);l(n)||(this.value.rawValue=n),this.view.refresh()}}function it(e){return"false"!==e&&!!e}function ot(e){return function(e){return String(e)}(e)}class at{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}}const st={"**":(e,t)=>Math.pow(e,t),"*":(e,t)=>e*t,"/":(e,t)=>e/t,"%":(e,t)=>e%t,"+":(e,t)=>e+t,"-":(e,t)=>e-t,"<<":(e,t)=>e<<t,">>":(e,t)=>e>>t,">>>":(e,t)=>e>>>t,"&":(e,t)=>e&t,"^":(e,t)=>e^t,"|":(e,t)=>e|t};class lt{constructor(e,t,n){this.left=t,this.operator=e,this.right=n}evaluate(){const e=st[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const ut={"+":e=>e,"-":e=>-e,"~":e=>~e};class ct{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=ut[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function pt(e){return(t,n)=>{for(let r=0;r<e.length;r++){const i=e[r](t,n);if(""!==i)return i}return""}}function ht(e,t){var n;const r=e.substr(t).match(/^\s+/);return null!==(n=r&&r[0])&&void 0!==n?n:""}function ft(e,t){var n;const r=e.substr(t).match(/^[0-9]+/);return null!==(n=r&&r[0])&&void 0!==n?n:""}function dt(e,t){const n=e.substr(t,1);if(t+=1,"e"!==n.toLowerCase())return"";const r=function(e,t){const n=ft(e,t);if(""!==n)return n;const r=e.substr(t,1);if("-"!==r&&"+"!==r)return"";const i=ft(e,t+=1);return""===i?"":r+i}(e,t);return""===r?"":n+r}function mt(e,t){const n=e.substr(t,1);if("0"===n)return n;const r=function(e,t){const n=e.substr(t,1);return n.match(/^[1-9]$/)?n:""}(e,t);return t+=r.length,""===r?"":r+ft(e,t)}const vt=pt([function(e,t){const n=mt(e,t);if(""===n)return"";const r=e.substr(t+=n.length,1);if("."!==r)return"";const i=ft(e,t+=r.length);return n+r+i+dt(e,t+=i.length)},function(e,t){const n=e.substr(t,1);if("."!==n)return"";const r=ft(e,t+=n.length);return t+=r.length,""===r?"":n+r+dt(e,t)},function(e,t){const n=mt(e,t);return t+=n.length,""===n?"":n+dt(e,t)}]),bt=pt([function(e,t){const n=e.substr(t,2);if(t+=n.length,"0b"!==n.toLowerCase())return"";const r=function(e,t){var n;const r=e.substr(t).match(/^[01]+/);return null!==(n=r&&r[0])&&void 0!==n?n:""}(e,t);return""===r?"":n+r},function(e,t){const n=e.substr(t,2);if(t+=n.length,"0o"!==n.toLowerCase())return"";const r=function(e,t){var n;const r=e.substr(t).match(/^[0-7]+/);return null!==(n=r&&r[0])&&void 0!==n?n:""}(e,t);return""===r?"":n+r},function(e,t){const n=e.substr(t,2);if(t+=n.length,"0x"!==n.toLowerCase())return"";const r=function(e,t){var n;const r=e.substr(t).match(/^[0-9a-f]+/i);return null!==(n=r&&r[0])&&void 0!==n?n:""}(e,t);return""===r?"":n+r}]),gt=pt([bt,vt]);function yt(e,t){var n;return null!==(n=function(e,t){const n=gt(e,t);return t+=n.length,""===n?null:{evaluable:new at(n),cursor:t}}(e,t))&&void 0!==n?n:function(e,t){const n=e.substr(t,1);if("("!==n)return null;const r=xt(e,t+=n.length);if(!r)return null;t=r.cursor,t+=ht(e,t).length;const i=e.substr(t,1);return t+=i.length,")"!==i?null:{evaluable:r.evaluable,cursor:t}}(e,t)}function wt(e,t,n){n+=ht(t,n).length;const r=e.filter(e=>t.startsWith(e,n))[0];return r?(n+=r.length,{cursor:n+=ht(t,n).length,operator:r}):null}const _t=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((e,t)=>(function(e,t){return(n,r)=>{const i=e(n,r);if(!i)return null;r=i.cursor;let o=i.evaluable;for(;;){const i=wt(t,n,r);if(!i)break;const a=e(n,r=i.cursor);if(!a)return null;r=a.cursor,o=new lt(i.operator,o,a.evaluable)}return o?{cursor:r,evaluable:o}:null}})(e,t),function e(t,n){const r=yt(t,n);if(r)return r;const i=t.substr(n,1);if("+"!==i&&"-"!==i&&"~"!==i)return null;const o=e(t,n+=i.length);return o?{cursor:n=o.cursor,evaluable:new ct(i,o.evaluable)}:null});function xt(e,t){return t+=ht(e,t).length,_t(e,t)}function kt(e){var t;const n=function(e){const t=xt(e,0);return t?t.cursor+ht(e,t.cursor).length!==e.length?null:t.evaluable:null}(e);return null!==(t=null==n?void 0:n.evaluate())&&void 0!==t?t:null}function Ct(e){if("number"==typeof e)return e;if("string"==typeof e){const t=kt(e);if(!l(t))return t}return 0}function Et(e){return String(e)}function At(e){return t=>t.toFixed(Math.max(Math.min(e,20),0))}const Pt=At(0);function Mt(e){return Pt(e)+"%"}function St(e){return String(e)}function Tt(e){return e}function Vt(e,t){for(;e.length<t;)e.push(void 0)}function jt(e){const t=[];return Vt(t,e),P(t)}function Ot(e){const t=e.indexOf(void 0);return s(t<0?e:e.slice(0,t))}function Dt({primary:e,secondary:t,forward:n,backward:r}){let i=!1;function o(e){i||(i=!0,e(),i=!1)}e.emitter.on("change",r=>{o(()=>{t.setRawValue(n(e,t),r.options)})}),t.emitter.on("change",i=>{o(()=>{e.setRawValue(r(e,t),i.options)}),o(()=>{t.setRawValue(n(e,t),i.options)})}),o(()=>{t.setRawValue(n(e,t),{forceEmit:!1,last:!0})})}function Lt(e,t){const n=e*(t.altKey?.1:1)*(t.shiftKey?10:1);return t.upKey?+n:t.downKey?-n:0}function Rt(e){return{altKey:e.altKey,downKey:"ArrowDown"===e.key,shiftKey:e.shiftKey,upKey:"ArrowUp"===e.key}}function It(e){return{altKey:e.altKey,downKey:"ArrowLeft"===e.key,shiftKey:e.shiftKey,upKey:"ArrowRight"===e.key}}function Bt(e){return function(e){return"ArrowUp"===e||"ArrowDown"===e}(e)||"ArrowLeft"===e||"ArrowRight"===e}function Ft(e,t){var n,r;const i=t.ownerDocument.defaultView,o=t.getBoundingClientRect();return{x:e.pageX-((null!==(n=i&&i.scrollX)&&void 0!==n?n:0)+o.left),y:e.pageY-((null!==(r=i&&i.scrollY)&&void 0!==r?r:0)+o.top)}}class zt{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new d,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),null===(t=e.currentTarget)||void 0===t||t.focus();const n=this.elem_.ownerDocument;n.addEventListener("mousemove",this.onDocumentMouseMove_),n.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(Ft(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(Ft(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(Ft(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-n.left,y:t.clientY-n.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-n.left,y:t.clientY-n.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const n=null!==(t=e.targetTouches.item(0))&&void 0!==t?t:this.lastTouch_,r=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(n?{x:n.clientX-r.left,y:n.clientY-r.top}:void 0),sender:this,shiftKey:e.shiftKey})}}function Ut(e,t,n,r,i){return r+(e-t)/(n-t)*(i-r)}function Nt(e){return String(e.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function qt(e,t,n){return Math.min(Math.max(e,t),n)}function Ht(e,t){return(e%t+t)%t}const Kt=v("txt");class Gt{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Kt(),Kt(void 0,"num")),t.arrayPosition&&this.element.classList.add(Kt(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("input");n.classList.add(Kt("i")),n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Kt()),this.inputElement.classList.add(Kt("i"));const r=e.createElement("div");r.classList.add(Kt("k")),this.element.appendChild(r),this.knobElement=r;const i=e.createElementNS(R,"svg");i.classList.add(Kt("g")),this.knobElement.appendChild(i);const o=e.createElementNS(R,"path");o.classList.add(Kt("gb")),i.appendChild(o),this.guideBodyElem_=o;const a=e.createElementNS(R,"path");a.classList.add(Kt("gh")),i.appendChild(a),this.guideHeadElem_=a;const s=e.createElement("div");s.classList.add(v("tt")()),this.knobElement.appendChild(s),this.tooltipElem_=s,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(null===e.rawValue)return void this.element.classList.remove(Kt(void 0,"drg"));this.element.classList.add(Kt(void 0,"drg"));const t=e.rawValue/this.props_.get("draggingScale"),n=t+(t>0?-1:t<0?1:0),r=qt(-n,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${n+r},0 L${n},4 L${n+r},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const i=this.props_.get("formatter");this.tooltipElem_.textContent=i(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}}class $t{constructor(e,t){var n;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=t.baseStep,this.parser_=t.parser,this.props=t.props,this.sliderProps_=null!==(n=t.sliderProps)&&void 0!==n?n:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=P(null),this.view=new Gt(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const r=new zt(this.view.knobElement);r.emitter.on("down",this.onPointerDown_),r.emitter.on("move",this.onPointerMove_),r.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,n;const r=null===(t=this.sliderProps_)||void 0===t?void 0:t.get("minValue"),i=null===(n=this.sliderProps_)||void 0===n?void 0:n.get("maxValue");let o=e;return void 0!==r&&(o=Math.max(o,r)),void 0!==i&&(o=Math.min(o,i)),o}onInputChange_(e){const t=s(e.currentTarget),n=this.parser_(t.value);l(n)||(this.value.rawValue=this.constrainValue_(n)),this.view.refresh()}onInputKeyDown_(e){const t=Lt(this.baseStep_,Rt(e));0!==t&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){0!==Lt(this.baseStep_,Rt(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;return this.constrainValue_(this.originRawValue_+(e.point.x-e.bounds.width/2)*this.props.get("draggingScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);null!==t&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);null!==t&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const Wt=v("sld");class Yt{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Wt()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(Wt("t")),t.viewProps.bindTabIndex(n),this.element.appendChild(n),this.trackElement=n;const r=e.createElement("div");r.classList.add(Wt("k")),this.trackElement.appendChild(r),this.knobElement=r,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=qt(Ut(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}}class Qt{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=t.baseStep,this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new Yt(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new zt(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue(Ut(qt(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Lt(this.baseStep_,It(e));0!==t&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){0!==Lt(this.baseStep_,It(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Xt=v("sldtxt");class Jt{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Xt());const n=e.createElement("div");n.classList.add(Xt("s")),this.sliderView_=t.sliderView,n.appendChild(this.sliderView_.element),this.element.appendChild(n);const r=e.createElement("div");r.classList.add(Xt("t")),this.textView_=t.textView,r.appendChild(this.textView_.element),this.element.appendChild(r)}}class Zt{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new Qt(e,{baseStep:t.baseStep,props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new $t(e,{baseStep:t.baseStep,parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new Jt(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function en(e,t){e.write(t)}function tn(e){const t=V;return Array.isArray(e)?t.required.array(t.required.object({text:t.required.string,value:t.required.raw}))(e).value:"object"==typeof e?t.required.raw(e).value:void 0}function nn(e){if("inline"===e||"popup"===e)return e}function rn(e){return V.required.object({max:V.optional.number,min:V.optional.number,step:V.optional.number})(e).value}function on(e){if(Array.isArray(e))return e;const t=[];return Object.keys(e).forEach(n=>{t.push({text:n,value:e[n]})}),t}function an(e){return l(e)?null:new Ge(on(s(e)))}function sn(e){const t=e?Ke(e,Ge):null;return t?t.options:null}function ln(e,t){const n=e&&Ke(e,We);return n?Nt(n.step):Math.max(Nt(t),2)}function un(e){const t=function(e){const t=e?Ke(e,We):null;return t?t.step:null}(e);return null!=t?t:1}function cn(e,t){var n;const r=e&&Ke(e,We),i=Math.abs(null!==(n=null==r?void 0:r.step)&&void 0!==n?n:t);return 0===i?.1:Math.pow(10,Math.floor(Math.log10(i))-1)}const pn=v("ckb");class hn{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(pn()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("label");n.classList.add(pn("l")),this.element.appendChild(n);const r=e.createElement("input");r.classList.add(pn("i")),r.type="checkbox",n.appendChild(r),this.inputElement=r,t.viewProps.bindDisabled(this.inputElement);const i=e.createElement("div");i.classList.add(pn("w")),n.appendChild(i);const o=z(e,"check");i.appendChild(o),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class fn{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new hn(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=s(e.currentTarget);this.value.rawValue=t.checked}}const dn={id:"input-bool",type:"input",accept:(e,t)=>{if("boolean"!=typeof e)return null;const n=j(t,{options:V.optional.custom(tn)});return n?{initialValue:e,params:n}:null},binding:{reader:e=>it,constraint:e=>(function(e){const t=[],n=an(e.options);return n&&t.push(n),new He(t)})(e.params),writer:e=>en},controller:e=>{var t;const n=e.document,r=e.value,i=e.constraint;return i&&Ke(i,Ge)?new Xe(n,{props:M.fromObject({options:null!==(t=sn(i))&&void 0!==t?t:[]}),value:r,viewProps:e.viewProps}):new fn(n,{value:r,viewProps:e.viewProps})}},mn=v("col");class vn{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(mn()),t.foldable.bindExpandedClass(this.element,mn(void 0,"expanded")),y(t.foldable,"completed",w(this.element,mn(void 0,"cpl")));const n=e.createElement("div");n.classList.add(mn("h")),this.element.appendChild(n);const r=e.createElement("div");r.classList.add(mn("s")),n.appendChild(r),this.swatchElement=r;const i=e.createElement("div");if(i.classList.add(mn("t")),n.appendChild(i),this.textElement=i,"inline"===t.pickerLayout){const t=e.createElement("div");t.classList.add(mn("p")),this.element.appendChild(t),this.pickerElement=t}else this.pickerElement=null}}function bn(e,t,n){const r=Ht(e,360),i=qt(t/100,0,1),o=qt(n/100,0,1),a=o*i,s=a*(1-Math.abs(r/60%2-1)),l=o-a;let u,c,p;return[u,c,p]=r>=0&&r<60?[a,s,0]:r>=60&&r<120?[s,a,0]:r>=120&&r<180?[0,a,s]:r>=180&&r<240?[0,s,a]:r>=240&&r<300?[s,0,a]:[a,0,s],[255*(u+l),255*(c+l),255*(p+l)]}function gn(e){return[e[0],e[1],e[2]]}function yn(e,t){return[e[0],e[1],e[2],t]}const wn={hsl:{hsl:(e,t,n)=>[e,t,n],hsv:function(e,t,n){const r=n+t*(100-Math.abs(2*n-100))/200;return[e,0!==r?t*(100-Math.abs(2*n-100))/r:0,n+t*(100-Math.abs(2*n-100))/200]},rgb:function(e,t,n){const r=(e%360+360)%360,i=qt(t/100,0,1),o=qt(n/100,0,1),a=(1-Math.abs(2*o-1))*i,s=a*(1-Math.abs(r/60%2-1)),l=o-a/2;let u,c,p;return[u,c,p]=r>=0&&r<60?[a,s,0]:r>=60&&r<120?[s,a,0]:r>=120&&r<180?[0,a,s]:r>=180&&r<240?[0,s,a]:r>=240&&r<300?[s,0,a]:[a,0,s],[255*(u+l),255*(c+l),255*(p+l)]}},hsv:{hsl:function(e,t,n){const r=100-Math.abs(n*(200-t)/100-100);return[e,0!==r?t*n/r:0,n*(200-t)/200]},hsv:(e,t,n)=>[e,t,n],rgb:bn},rgb:{hsl:function(e,t,n){const r=qt(e/255,0,1),i=qt(t/255,0,1),o=qt(n/255,0,1),a=Math.max(r,i,o),s=Math.min(r,i,o),l=a-s;let u=0,c=0;const p=(s+a)/2;return 0!==l&&(c=l/(1-Math.abs(a+s-1)),u=(u=r===a?(i-o)/l:i===a?2+(o-r)/l:4+(r-i)/l)/6+(u<0?1:0)),[360*u,100*c,100*p]},hsv:function(e,t,n){const r=qt(e/255,0,1),i=qt(t/255,0,1),o=qt(n/255,0,1),a=Math.max(r,i,o),s=a-Math.min(r,i,o);let l;return[l=0===s?0:a===r?((i-o)/s%6+6)%6*60:a===i?60*((o-r)/s+2):60*((r-i)/s+4),100*(0===a?0:s/a),100*a]},rgb:(e,t,n)=>[e,t,n]}};function _n(e,t){return["float"===t?1:"rgb"===e?255:360,"float"===t?1:"rgb"===e?255:100,"float"===t?1:"rgb"===e?255:100]}function xn(e,t,n,r){const i=_n(t,n),o=_n(t,r);return e.map((e,t)=>e/i[t]*o[t])}function kn(e,t){return"object"==typeof e&&!l(e)&&(t in e&&"number"==typeof e[t])}class Cn{constructor(e,t,n="int"){this.mode=t,this.type=n,this.comps_=function(e,t,n){var r;const i=_n(t,n);return["rgb"===t?qt(e[0],0,i[0]):Ht(e[0],i[0]),qt(e[1],0,i[1]),qt(e[2],0,i[2]),qt(null!==(r=e[3])&&void 0!==r?r:1,0,1)]}(e,t,n)}static black(e="int"){return new Cn([0,0,0],"rgb",e)}static fromObject(e,t="int"){return new Cn("a"in e?[e.r,e.g,e.b,e.a]:[e.r,e.g,e.b],"rgb",t)}static toRgbaObject(e,t="int"){return e.toRgbaObject(t)}static isRgbColorObject(e){return kn(e,"r")&&kn(e,"g")&&kn(e,"b")}static isRgbaColorObject(e){return this.isRgbColorObject(e)&&kn(e,"a")}static isColorObject(e){return this.isRgbColorObject(e)}static equals(e,t){if(e.mode!==t.mode)return!1;const n=e.comps_,r=t.comps_;for(let e=0;e<n.length;e++)if(n[e]!==r[e])return!1;return!0}getComponents(e,t="int"){return yn(function(e,t,n){const r=xn(e,t.mode,t.type,"int");return xn(wn[t.mode][n.mode](...r),n.mode,"int",n.type)}(gn(this.comps_),{mode:this.mode,type:this.type},{mode:null!=e?e:this.mode,type:t}),this.comps_[3])}toRgbaObject(e="int"){const t=this.getComponents("rgb",e);return{r:t[0],g:t[1],b:t[2],a:t[3]}}}const En=v("colp");class An{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(En());const n=e.createElement("div");n.classList.add(En("hsv"));const r=e.createElement("div");r.classList.add(En("sv")),this.svPaletteView_=t.svPaletteView,r.appendChild(this.svPaletteView_.element),n.appendChild(r);const i=e.createElement("div");i.classList.add(En("h")),this.hPaletteView_=t.hPaletteView,i.appendChild(this.hPaletteView_.element),n.appendChild(i),this.element.appendChild(n);const o=e.createElement("div");if(o.classList.add(En("rgb")),this.textView_=t.textView,o.appendChild(this.textView_.element),this.element.appendChild(o),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const n=e.createElement("div");n.classList.add(En("a"));const r=e.createElement("div");r.classList.add(En("ap")),r.appendChild(this.alphaViews_.palette.element),n.appendChild(r);const i=e.createElement("div");i.classList.add(En("at")),i.appendChild(this.alphaViews_.text.element),n.appendChild(i),this.element.appendChild(n)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(e=>e.inputElement)];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}}function Pn(e){return"int"===e?"int":"float"===e?"float":void 0}function Mn(e){const t=V;return j(e,{alpha:t.optional.boolean,color:t.optional.object({alpha:t.optional.boolean,type:t.optional.custom(Pn)}),expanded:t.optional.boolean,picker:t.optional.custom(nn)})}function Sn(e){return e?.1:1}function Tn(e){var t;return null===(t=e.color)||void 0===t?void 0:t.type}function Vn(e,t){const n=e.match(/^(.+)%$/);return n?Math.min(.01*parseFloat(n[1])*t,t):Math.min(parseFloat(e),t)}const jn={deg:e=>e,grad:e=>360*e/400,rad:e=>360*e/(2*Math.PI),turn:e=>360*e};function On(e){const t=e.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!t)return parseFloat(e);const n=parseFloat(t[1]);return jn[t[2]](n)}function Dn(e){const t=e.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[Vn(t[1],255),Vn(t[2],255),Vn(t[3],255)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function Ln(e){return t=>{const n=Dn(t);return n?new Cn(n,"rgb",e):null}}function Rn(e){const t=e.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[Vn(t[1],255),Vn(t[2],255),Vn(t[3],255),Vn(t[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function In(e){return t=>{const n=Rn(t);return n?new Cn(n,"rgb",e):null}}function Bn(e){const t=e.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[On(t[1]),Vn(t[2],100),Vn(t[3],100)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function Fn(e){return t=>{const n=Bn(t);return n?new Cn(n,"hsl",e):null}}function zn(e){const t=e.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[On(t[1]),Vn(t[2],100),Vn(t[3],100),Vn(t[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function Un(e){return t=>{const n=zn(t);return n?new Cn(n,"hsl",e):null}}function Nn(e){const t=e.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)];const n=e.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)]:null}function qn(e){const t=e.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),Ut(parseInt(t[4]+t[4],16),0,255,0,1)];const n=e.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16),Ut(parseInt(n[4],16),0,255,0,1)]:null}function Hn(e){const t=e.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!t)return null;const n=[parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function Kn(e){return t=>{const n=Hn(t);return n?new Cn(n,"rgb",e):null}}function Gn(e){const t=e.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!t)return null;const n=[parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]),parseFloat(t[4])];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function $n(e){return t=>{const n=Gn(t);return n?new Cn(n,"rgb",e):null}}const Wn=[{parser:Nn,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:qn,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:Dn,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:Rn,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:Bn,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:zn,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:Hn,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:Gn,result:{alpha:!0,mode:"rgb",notation:"object"}}];function Yn(e,t="int"){const n=function(e){return Wn.reduce((t,{parser:n,result:r})=>t||(n(e)?r:null),null)}(e);return n?"hex"===n.notation&&"float"!==t?Object.assign(Object.assign({},n),{type:"int"}):"func"===n.notation?Object.assign(Object.assign({},n),{type:t}):null:null}const Qn={int:[function(e){const t=Nn(e);return t?new Cn(t,"rgb","int"):null},function(e){const t=qn(e);return t?new Cn(t,"rgb","int"):null},Ln("int"),In("int"),Fn("int"),Un("int"),Kn("int"),$n("int")],float:[Ln("float"),In("float"),Fn("float"),Un("float"),Kn("float"),$n("float")]};function Xn(e){const t=Qn[e];return e=>t.reduce((t,n)=>t||n(e),null)}function Jn(e){const t=qt(Math.floor(e),0,255).toString(16);return 1===t.length?`0${t}`:t}function Zn(e,t="#"){return`${t}${gn(e.getComponents("rgb")).map(Jn).join("")}`}function er(e,t="#"){const n=e.getComponents("rgb");return`${t}${[n[0],n[1],n[2],255*n[3]].map(Jn).join("")}`}function tr(e,t){const n=At("float"===t?2:0);return`rgb(${gn(e.getComponents("rgb",t)).map(e=>n(e)).join(", ")})`}function nr(e){return t=>tr(t,e)}function rr(e,t){const n=At(2),r=At("float"===t?2:0);return`rgba(${e.getComponents("rgb",t).map((e,t)=>{return(3===t?n:r)(e)}).join(", ")})`}function ir(e){return t=>rr(t,e)}function or(e,t){const n=At("float"===t?2:0),r=["r","g","b"];return`{${gn(e.getComponents("rgb",t)).map((e,t)=>`${r[t]}: ${n(e)}`).join(", ")}}`}function ar(e){return t=>or(t,e)}function sr(e,t){const n=At(2),r=At("float"===t?2:0),i=["r","g","b","a"];return`{${e.getComponents("rgb",t).map((e,t)=>{return`${i[t]}: ${(3===t?n:r)(e)}`}).join(", ")}}`}function lr(e){return t=>sr(t,e)}const ur=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:Zn},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:er},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:function(e){const t=[At(0),Mt,Mt];return`hsl(${gn(e.getComponents("hsl")).map((e,n)=>t[n](e)).join(", ")})`}},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:function(e){const t=[At(0),Mt,Mt,At(2)];return`hsla(${e.getComponents("hsl").map((e,n)=>t[n](e)).join(", ")})`}},...["int","float"].reduce((e,t)=>[...e,{format:{alpha:!1,mode:"rgb",notation:"func",type:t},stringifier:nr(t)},{format:{alpha:!0,mode:"rgb",notation:"func",type:t},stringifier:ir(t)},{format:{alpha:!1,mode:"rgb",notation:"object",type:t},stringifier:ar(t)},{format:{alpha:!0,mode:"rgb",notation:"object",type:t},stringifier:lr(t)}],[])];function cr(e){return ur.reduce((t,n)=>t||(function(e,t){return e.alpha===t.alpha&&e.mode===t.mode&&e.notation===t.notation&&e.type===t.type}(n.format,e)?n.stringifier:null),null)}const pr=v("apl");class hr{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(pr()),t.viewProps.bindTabIndex(this.element);const n=e.createElement("div");n.classList.add(pr("b")),this.element.appendChild(n);const r=e.createElement("div");r.classList.add(pr("c")),n.appendChild(r),this.colorElem_=r;const i=e.createElement("div");i.classList.add(pr("m")),this.element.appendChild(i),this.markerElem_=i;const o=e.createElement("div");o.classList.add(pr("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),n=new Cn([t[0],t[1],t[2],0],"rgb"),r=new Cn([t[0],t[1],t[2],255],"rgb"),i=["to right",rr(n),rr(r)];this.colorElem_.style.background=`linear-gradient(${i.join(",")})`,this.previewElem_.style.backgroundColor=rr(e);const o=Ut(t[3],0,1,0,100);this.markerElem_.style.left=`${o}%`}onValueChange_(){this.update_()}}class fr{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new hr(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new zt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=e.point.x/e.bounds.width,r=this.value.rawValue,[i,o,a]=r.getComponents("hsv");this.value.setRawValue(new Cn([i,o,a,n],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Lt(Sn(!0),It(e));if(0===t)return;const n=this.value.rawValue,[r,i,o,a]=n.getComponents("hsv");this.value.setRawValue(new Cn([r,i,o,a+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){0!==Lt(Sn(!0),It(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const dr=v("coltxt");class mr{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(dr());const n=e.createElement("div");n.classList.add(dr("m")),this.modeElem_=function(e){const t=e.createElement("select");return t.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}].reduce((t,n)=>{const r=e.createElement("option");return r.textContent=n.text,r.value=n.value,t.appendChild(r),t},e.createDocumentFragment())),t}(e),this.modeElem_.classList.add(dr("ms")),n.appendChild(this.modeSelectElement);const r=e.createElement("div");r.classList.add(dr("mm")),r.appendChild(z(e,"dropdown")),n.appendChild(r),this.element.appendChild(n);const i=e.createElement("div");i.classList.add(dr("w")),this.element.appendChild(i),this.textsElem_=i,this.textViews_=t.textViews,this.applyTextViews_(),g(t.colorMode,e=>{this.modeElem_.value=e})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(e){this.textViews_=e,this.applyTextViews_()}applyTextViews_(){q(this.textsElem_);const e=this.element.ownerDocument;this.textViews_.forEach(t=>{const n=e.createElement("div");n.classList.add(dr("c")),n.appendChild(t.element),this.textsElem_.appendChild(n)})}}function vr(e,t,n){const r=_n(e,t)[n];return new $e({min:0,max:r})}function br(e,t,n){return new $t(e,{arrayPosition:0===n?"fst":2===n?"lst":"mid",baseStep:Sn(!1),parser:t.parser,props:M.fromObject({draggingScale:"float"===t.colorType?.01:1,formatter:(r=t.colorType,At("float"===r?2:0))}),value:P(0,{constraint:vr(t.colorMode,t.colorType,n)}),viewProps:t.viewProps});var r}class gr{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.parser_=t.parser,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=P(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new mr(e,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t={colorMode:this.colorMode.rawValue,colorType:this.colorType_,parser:this.parser_,viewProps:this.viewProps},n=[br(e,t,0),br(e,t,1),br(e,t,2)];return n.forEach((e,t)=>{Dt({primary:this.value,secondary:e.value,forward:e=>e.rawValue.getComponents(this.colorMode.rawValue,this.colorType_)[t],backward:(e,n)=>{const r=this.colorMode.rawValue,i=e.rawValue.getComponents(r,this.colorType_);return i[t]=n.rawValue,new Cn(yn(gn(i),i[3]),r,this.colorType_)}})}),n}onModeSelectChange_(e){this.colorMode.rawValue=e.currentTarget.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const yr=v("hpl");class wr{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(yr()),t.viewProps.bindTabIndex(this.element);const n=e.createElement("div");n.classList.add(yr("c")),this.element.appendChild(n);const r=e.createElement("div");r.classList.add(yr("m")),this.element.appendChild(r),this.markerElem_=r,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=tr(new Cn([t,100,100],"hsv"));const n=Ut(t,0,360,0,100);this.markerElem_.style.left=`${n}%`}onValueChange_(){this.update_()}}class _r{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new wr(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new zt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=Ut(qt(e.point.x,0,e.bounds.width),0,e.bounds.width,0,359),r=this.value.rawValue,[,i,o,a]=r.getComponents("hsv");this.value.setRawValue(new Cn([n,i,o,a],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Lt(Sn(!1),It(e));if(0===t)return;const n=this.value.rawValue,[r,i,o,a]=n.getComponents("hsv");this.value.setRawValue(new Cn([r+t,i,o,a],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){0!==Lt(Sn(!1),It(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const xr=v("svp"),kr=64;class Cr{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(xr()),t.viewProps.bindTabIndex(this.element);const n=e.createElement("canvas");n.height=kr,n.width=kr,n.classList.add(xr("c")),this.element.appendChild(n),this.canvasElement=n;const r=e.createElement("div");r.classList.add(xr("m")),this.element.appendChild(r),this.markerElem_=r,this.update_()}update_(){const e=function(e){const t=e.ownerDocument.defaultView;return t&&"document"in t?e.getContext("2d"):null}(this.canvasElement);if(!e)return;const t=this.value.rawValue.getComponents("hsv"),n=this.canvasElement.width,r=this.canvasElement.height,i=e.getImageData(0,0,n,r),o=i.data;for(let e=0;e<r;e++)for(let i=0;i<n;i++){const a=Ut(i,0,n,0,100),s=Ut(e,0,r,100,0),l=bn(t[0],a,s),u=4*(e*n+i);o[u]=l[0],o[u+1]=l[1],o[u+2]=l[2],o[u+3]=255}e.putImageData(i,0,0);const a=Ut(t[1],0,100,0,100);this.markerElem_.style.left=`${a}%`;const s=Ut(t[2],0,100,100,0);this.markerElem_.style.top=`${s}%`}onValueChange_(){this.update_()}}class Er{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Cr(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new zt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=Ut(e.point.x,0,e.bounds.width,0,100),r=Ut(e.point.y,0,e.bounds.height,100,0),[i,,,o]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new Cn([i,n,r,o],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){Bt(e.key)&&e.preventDefault();const[t,n,r,i]=this.value.rawValue.getComponents("hsv"),o=Sn(!1),a=Lt(o,It(e)),s=Lt(o,Rt(e));0===a&&0===s||this.value.setRawValue(new Cn([t,n+a,r+s,i],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=Sn(!1),n=Lt(t,It(e)),r=Lt(t,Rt(e));0===n&&0===r||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Ar{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new _r(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new Er(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new fr(e,{value:this.value,viewProps:this.viewProps}),text:new $t(e,{parser:kt,baseStep:.1,props:M.fromObject({draggingScale:.01,formatter:At(2)}),value:P(0,{constraint:new $e({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Dt({primary:this.value,secondary:this.alphaIcs_.text.value,forward:e=>e.rawValue.getComponents()[3],backward:(e,t)=>{const n=e.rawValue.getComponents();return n[3]=t.rawValue,new Cn(n,e.rawValue.mode)}}),this.textC_=new gr(e,{colorType:t.colorType,parser:kt,value:this.value,viewProps:this.viewProps}),this.view=new An(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view})}get textController(){return this.textC_}}const Pr=v("colsw");class Mr{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(Pr()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(Pr("sw")),this.element.appendChild(n),this.swatchElem_=n;const r=e.createElement("button");r.classList.add(Pr("b")),t.viewProps.bindDisabled(r),this.element.appendChild(r),this.buttonElement=r,this.update_()}update_(){this.swatchElem_.style.backgroundColor=er(this.value.rawValue)}onValueChange_(){this.update_()}}class Sr{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new Mr(e,{value:this.value,viewProps:this.viewProps})}}class Tr{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=X.create(t.expanded),this.swatchC_=new Sr(e,{value:this.value,viewProps:this.viewProps});const n=this.swatchC_.view.buttonElement;n.addEventListener("blur",this.onButtonBlur_),n.addEventListener("click",this.onButtonClick_),this.textC_=new rt(e,{parser:t.parser,props:M.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new vn(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_="popup"===t.pickerLayout?new et(e,{viewProps:this.viewProps}):null;const r=new Ar(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});r.view.allFocusableElements.forEach(e=>{e.addEventListener("blur",this.onPopupChildBlur_),e.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=r,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(r.view.element),Dt({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:e=>e.rawValue,backward:(e,t)=>t.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Z(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,n=s(e.relatedTarget);n&&t.contains(n)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,n=H(e);n&&t.contains(n)||n&&n===this.swatchC_.view.buttonElement&&!I(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?"Escape"===e.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===e.key&&this.swatchC_.view.buttonElement.focus()}}function Vr(e){return gn(e.getComponents("rgb")).reduce((e,t)=>e<<8|255&Math.floor(t),0)}function jr(e){return e.getComponents("rgb").reduce((e,t,n)=>{return e<<8|255&Math.floor(3===n?255*t:t)},0)>>>0}function Or(e){return"number"!=typeof e?Cn.black():new Cn([(t=e)>>16&255,t>>8&255,255&t],"rgb");var t}function Dr(e){return"number"!=typeof e?Cn.black():new Cn([(t=e)>>24&255,t>>16&255,t>>8&255,Ut(255&t,0,255,0,1)],"rgb");var t}function Lr(e){var t;return!!((null==e?void 0:e.alpha)||(null===(t=null==e?void 0:e.color)||void 0===t?void 0:t.alpha))}function Rr(e){return e?e=>er(e,"0x"):e=>Zn(e,"0x")}const Ir={id:"input-color-number",type:"input",accept:(e,t)=>{if("number"!=typeof e)return null;if(!function(e){return"color"in e||"view"in e&&"color"===e.view}(t))return null;const n=Mn(t);return n?{initialValue:e,params:n}:null},binding:{reader:e=>Lr(e.params)?Dr:Or,equals:Cn.equals,writer:e=>(function(e){const t=e?jr:Vr;return(e,n)=>{en(e,t(n))}})(Lr(e.params))},controller:e=>{const t=Lr(e.params),n="expanded"in e.params?e.params.expanded:void 0,r="picker"in e.params?e.params.picker:void 0;return new Tr(e.document,{colorType:"int",expanded:null!=n&&n,formatter:Rr(t),parser:Xn("int"),pickerLayout:null!=r?r:"popup",supportsAlpha:t,value:e.value,viewProps:e.viewProps})}};function Br(e){return t=>(function(e,t){return Cn.isColorObject(e)?Cn.fromObject(e,t):Cn.black(t)})(t,e)}function Fr(e,t){return n=>e?sr(n,t):or(n,t)}const zr={id:"input-color-object",type:"input",accept:(e,t)=>{if(!Cn.isColorObject(e))return null;const n=Mn(t);return n?{initialValue:e,params:n}:null},binding:{reader:e=>Br(Tn(e.params)),equals:Cn.equals,writer:e=>(function(e,t){return(n,r)=>{e?function(e,t,n){const r=t.toRgbaObject(n);e.writeProperty("r",r.r),e.writeProperty("g",r.g),e.writeProperty("b",r.b),e.writeProperty("a",r.a)}(n,r,t):function(e,t,n){const r=t.toRgbaObject(n);e.writeProperty("r",r.r),e.writeProperty("g",r.g),e.writeProperty("b",r.b)}(n,r,t)}})(function(e){return Cn.isRgbaColorObject(e)}(e.initialValue),Tn(e.params))},controller:e=>{var t;const n=Cn.isRgbaColorObject(e.initialValue),r="expanded"in e.params?e.params.expanded:void 0,i="picker"in e.params?e.params.picker:void 0,o=null!==(t=Tn(e.params))&&void 0!==t?t:"int";return new Tr(e.document,{colorType:o,expanded:null!=r&&r,formatter:Fr(n,o),parser:Xn(o),pickerLayout:null!=i?i:"popup",supportsAlpha:n,value:e.value,viewProps:e.viewProps})}},Ur={id:"input-color-string",type:"input",accept:(e,t)=>{if("string"!=typeof e)return null;if("view"in t&&"text"===t.view)return null;const n=Yn(e,Tn(t));if(!n)return null;if(!cr(n))return null;const r=Mn(t);return r?{initialValue:e,params:r}:null},binding:{reader:e=>{var t;return function(e){const t=Qn[e];return n=>{if("string"!=typeof n)return Cn.black(e);const r=t.reduce((e,t)=>e||t(n),null);return null!=r?r:Cn.black(e)}}(null!==(t=Tn(e.params))&&void 0!==t?t:"int")},equals:Cn.equals,writer:e=>{const t=Yn(e.initialValue,Tn(e.params));if(!t)throw p.shouldNeverHappen();const n=function(e){const t=cr(e);return t?(e,n)=>{en(e,t(n))}:null}(t);if(!n)throw p.notBindable();return n}},controller:e=>{const t=Yn(e.initialValue,Tn(e.params));if(!t)throw p.shouldNeverHappen();const n=cr(t);if(!n)throw p.shouldNeverHappen();const r="expanded"in e.params?e.params.expanded:void 0,i="picker"in e.params?e.params.picker:void 0;return new Tr(e.document,{colorType:t.type,expanded:null!=r&&r,formatter:n,parser:Xn(t.type),pickerLayout:null!=i?i:"popup",supportsAlpha:t.alpha,value:e.value,viewProps:e.viewProps})}};class Nr{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map((e,t)=>{var n,r;return null!==(r=null===(n=this.components[t])||void 0===n?void 0:n.constrain(e))&&void 0!==r?r:e});return this.asm_.fromComponents(t)}}const qr=v("pndtxt");class Hr{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(qr()),this.textViews.forEach(t=>{const n=e.createElement("div");n.classList.add(qr("a")),n.appendChild(t.element),this.element.appendChild(n)})}}class Kr{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map((n,r)=>(function(e,t,n){return new $t(e,{arrayPosition:0===n?"fst":n===t.axes.length-1?"lst":"mid",baseStep:t.axes[n].baseStep,parser:t.parser,props:t.axes[n].textProps,value:P(0,{constraint:t.axes[n].constraint}),viewProps:t.viewProps})})(e,t,r)),this.acs_.forEach((e,n)=>{Dt({primary:this.value,secondary:e.value,forward:e=>t.assembly.toComponents(e.rawValue)[n],backward:(e,r)=>{const i=t.assembly.toComponents(e.rawValue);return i[n]=r.rawValue,t.assembly.fromComponents(i)}})}),this.view=new Hr(e,{textViews:this.acs_.map(e=>e.view)})}}function Gr(e,t){return"step"in e&&!l(e.step)?new We(e.step,t):null}function $r(e){return"max"in e&&!l(e.max)||"min"in e&&!l(e.min)?new $e({max:e.max,min:e.min}):null}function Wr(e){const[t,n]=function(e){const t=e?Ke(e,$e):null;return t?[t.minValue,t.maxValue]:[void 0,void 0]}(e);return[null!=t?t:0,null!=n?n:100]}const Yr={id:"input-number",type:"input",accept:(e,t)=>{if("number"!=typeof e)return null;const n=V,r=j(t,{format:n.optional.function,max:n.optional.number,min:n.optional.number,options:n.optional.custom(tn),step:n.optional.number});return r?{initialValue:e,params:r}:null},binding:{reader:e=>Ct,constraint:e=>(function(e,t){const n=[],r=Gr(e,t);r&&n.push(r);const i=$r(e);i&&n.push(i);const o=an(e.options);return o&&n.push(o),new He(n)})(e.params,e.initialValue),writer:e=>en},controller:e=>{var t,n;const r=e.value,i=e.constraint;if(i&&Ke(i,Ge))return new Xe(e.document,{props:M.fromObject({options:null!==(t=sn(i))&&void 0!==t?t:[]}),value:r,viewProps:e.viewProps});const o=null!==(n="format"in e.params?e.params.format:void 0)&&void 0!==n?n:At(ln(i,r.rawValue));if(i&&Ke(i,$e)){const[t,n]=Wr(i);return new Zt(e.document,{baseStep:un(i),parser:kt,sliderProps:M.fromObject({maxValue:n,minValue:t}),textProps:M.fromObject({draggingScale:cn(i,r.rawValue),formatter:o}),value:r,viewProps:e.viewProps})}return new $t(e.document,{baseStep:un(i),parser:kt,props:M.fromObject({draggingScale:cn(i,r.rawValue),formatter:o}),value:r,viewProps:e.viewProps})}};class Qr{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(l(e))return!1;return"number"==typeof e.x&&"number"==typeof e.y}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}}const Xr={toComponents:e=>e.getComponents(),fromComponents:e=>new Qr(...e)},Jr=v("p2d");class Zr{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Jr()),t.viewProps.bindClassModifiers(this.element),g(t.expanded,w(this.element,Jr(void 0,"expanded")));const n=e.createElement("div");n.classList.add(Jr("h")),this.element.appendChild(n);const r=e.createElement("button");r.classList.add(Jr("b")),r.appendChild(z(e,"p2dpad")),t.viewProps.bindDisabled(r),n.appendChild(r),this.buttonElement=r;const i=e.createElement("div");if(i.classList.add(Jr("t")),n.appendChild(i),this.textElement=i,"inline"===t.pickerLayout){const t=e.createElement("div");t.classList.add(Jr("p")),this.element.appendChild(t),this.pickerElement=t}else this.pickerElement=null}}const ei=v("p2dp");class ti{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=t.invertsY,this.maxValue_=t.maxValue,this.element=e.createElement("div"),this.element.classList.add(ei()),"popup"===t.layout&&this.element.classList.add(ei(void 0,"p"));const n=e.createElement("div");n.classList.add(ei("p")),t.viewProps.bindTabIndex(n),this.element.appendChild(n),this.padElement=n;const r=e.createElementNS(R,"svg");r.classList.add(ei("g")),this.padElement.appendChild(r),this.svgElem_=r;const i=e.createElementNS(R,"line");i.classList.add(ei("ax")),i.setAttributeNS(null,"x1","0"),i.setAttributeNS(null,"y1","50%"),i.setAttributeNS(null,"x2","100%"),i.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(i);const o=e.createElementNS(R,"line");o.classList.add(ei("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);const a=e.createElementNS(R,"line");a.classList.add(ei("l")),a.setAttributeNS(null,"x1","50%"),a.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(a),this.lineElem_=a;const s=e.createElement("div");s.classList.add(ei("m")),this.padElement.appendChild(s),this.markerElem_=s,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),n=this.maxValue_,r=Ut(e,-n,+n,0,100),i=Ut(t,-n,+n,0,100),o=this.invertsY_?100-i:i;this.lineElem_.setAttributeNS(null,"x2",`${r}%`),this.lineElem_.setAttributeNS(null,"y2",`${o}%`),this.markerElem_.style.left=`${r}%`,this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function ni(e,t,n){return[Lt(t[0],It(e)),Lt(t[1],Rt(e))*(n?1:-1)]}class ri{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.baseSteps_=t.baseSteps,this.maxValue_=t.maxValue,this.invertsY_=t.invertsY,this.view=new ti(e,{invertsY:this.invertsY_,layout:t.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new zt(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=this.maxValue_,r=Ut(e.point.x,0,e.bounds.width,-n,+n),i=Ut(this.invertsY_?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-n,+n);this.value.setRawValue(new Qr(r,i),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){Bt(e.key)&&e.preventDefault();const[t,n]=ni(e,this.baseSteps_,this.invertsY_);0===t&&0===n||this.value.setRawValue(new Qr(this.value.rawValue.x+t,this.value.rawValue.y+n),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,n]=ni(e,this.baseSteps_,this.invertsY_);0===t&&0===n||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class ii{constructor(e,t){var n,r;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=X.create(t.expanded),this.popC_="popup"===t.pickerLayout?new et(e,{viewProps:this.viewProps}):null;const i=new ri(e,{baseSteps:[t.axes[0].baseStep,t.axes[1].baseStep],invertsY:t.invertsY,layout:t.pickerLayout,maxValue:t.maxValue,value:this.value,viewProps:this.viewProps});i.view.allFocusableElements.forEach(e=>{e.addEventListener("blur",this.onPopupChildBlur_),e.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=i,this.textC_=new Kr(e,{assembly:Xr,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new Zr(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),null===(n=this.view.buttonElement)||void 0===n||n.addEventListener("blur",this.onPadButtonBlur_),null===(r=this.view.buttonElement)||void 0===r||r.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Dt({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:e=>e.rawValue,backward:(e,t)=>t.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Z(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,n=s(e.relatedTarget);n&&t.contains(n)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,n=H(e);n&&t.contains(n)||n&&n===this.view.buttonElement&&!I(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?"Escape"===e.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===e.key&&this.view.buttonElement.focus()}}function oi(e,t){if(!e)return;const n=[],r=Gr(e,t);r&&n.push(r);const i=$r(e);return i&&n.push(i),new He(n)}function ai(e,t){var n,r;const i=e&&Ke(e,$e);if(i)return Math.max(Math.abs(null!==(n=i.minValue)&&void 0!==n?n:0),Math.abs(null!==(r=i.maxValue)&&void 0!==r?r:0));const o=un(e);return Math.max(10*Math.abs(o),10*Math.abs(t))}function si(e,t){const n=t instanceof Nr?t.components[1]:void 0,r=ai(t instanceof Nr?t.components[0]:void 0,e.x),i=ai(n,e.y);return Math.max(r,i)}function li(e,t){return{baseStep:un(t),constraint:t,textProps:M.fromObject({draggingScale:cn(t,e),formatter:At(ln(t,e))})}}function ui(e){if(!("y"in e))return!1;const t=e.y;return!!t&&("inverted"in t&&!!t.inverted)}const ci={id:"input-point2d",type:"input",accept:(e,t)=>{if(!Qr.isObject(e))return null;const n=V,r=j(t,{expanded:n.optional.boolean,picker:n.optional.custom(nn),x:n.optional.custom(rn),y:n.optional.object({inverted:n.optional.boolean,max:n.optional.number,min:n.optional.number,step:n.optional.number})});return r?{initialValue:e,params:r}:null},binding:{reader:e=>(function(e){return Qr.isObject(e)?new Qr(e.x,e.y):new Qr}),constraint:e=>(function(e,t){return new Nr({assembly:Xr,components:[oi("x"in e?e.x:void 0,t.x),oi("y"in e?e.y:void 0,t.y)]})})(e.params,e.initialValue),equals:Qr.equals,writer:e=>(function(e,t){e.writeProperty("x",t.x),e.writeProperty("y",t.y)})},controller:e=>{const t=e.document,n=e.value,r=e.constraint;if(!(r instanceof Nr))throw p.shouldNeverHappen();const i="expanded"in e.params?e.params.expanded:void 0,o="picker"in e.params?e.params.picker:void 0;return new ii(t,{axes:[li(n.rawValue.x,r.components[0]),li(n.rawValue.y,r.components[1])],expanded:null!=i&&i,invertsY:ui(e.params),maxValue:si(n.rawValue,r),parser:kt,pickerLayout:null!=o?o:"popup",value:n,viewProps:e.viewProps})}};class pi{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(l(e))return!1;return"number"==typeof e.x&&"number"==typeof e.y&&"number"==typeof e.z}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const hi={toComponents:e=>e.getComponents(),fromComponents:e=>new pi(...e)};function fi(e,t){return{baseStep:un(t),constraint:t,textProps:M.fromObject({draggingScale:cn(t,e),formatter:At(ln(t,e))})}}const di={id:"input-point3d",type:"input",accept:(e,t)=>{if(!pi.isObject(e))return null;const n=V,r=j(t,{x:n.optional.custom(rn),y:n.optional.custom(rn),z:n.optional.custom(rn)});return r?{initialValue:e,params:r}:null},binding:{reader:e=>(function(e){return pi.isObject(e)?new pi(e.x,e.y,e.z):new pi}),constraint:e=>(function(e,t){return new Nr({assembly:hi,components:[oi("x"in e?e.x:void 0,t.x),oi("y"in e?e.y:void 0,t.y),oi("z"in e?e.z:void 0,t.z)]})})(e.params,e.initialValue),equals:pi.equals,writer:e=>(function(e,t){e.writeProperty("x",t.x),e.writeProperty("y",t.y),e.writeProperty("z",t.z)})},controller:e=>{const t=e.value,n=e.constraint;if(!(n instanceof Nr))throw p.shouldNeverHappen();return new Kr(e.document,{assembly:hi,axes:[fi(t.rawValue.x,n.components[0]),fi(t.rawValue.y,n.components[1]),fi(t.rawValue.z,n.components[2])],parser:kt,value:t,viewProps:e.viewProps})}};class mi{constructor(e=0,t=0,n=0,r=0){this.x=e,this.y=t,this.z=n,this.w=r}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(l(e))return!1;return"number"==typeof e.x&&"number"==typeof e.y&&"number"==typeof e.z&&"number"==typeof e.w}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const vi={toComponents:e=>e.getComponents(),fromComponents:e=>new mi(...e)},bi={id:"input-point4d",type:"input",accept:(e,t)=>{if(!mi.isObject(e))return null;const n=V,r=j(t,{x:n.optional.custom(rn),y:n.optional.custom(rn),z:n.optional.custom(rn),w:n.optional.custom(rn)});return r?{initialValue:e,params:r}:null},binding:{reader:e=>(function(e){return mi.isObject(e)?new mi(e.x,e.y,e.z,e.w):new mi}),constraint:e=>(function(e,t){return new Nr({assembly:vi,components:[oi("x"in e?e.x:void 0,t.x),oi("y"in e?e.y:void 0,t.y),oi("z"in e?e.z:void 0,t.z),oi("w"in e?e.w:void 0,t.w)]})})(e.params,e.initialValue),equals:mi.equals,writer:e=>(function(e,t){e.writeProperty("x",t.x),e.writeProperty("y",t.y),e.writeProperty("z",t.z),e.writeProperty("w",t.w)})},controller:e=>{const t=e.value,n=e.constraint;if(!(n instanceof Nr))throw p.shouldNeverHappen();return new Kr(e.document,{assembly:vi,axes:t.rawValue.getComponents().map((e,t)=>(function(e,t){return{baseStep:un(t),constraint:t,textProps:M.fromObject({draggingScale:cn(t,e),formatter:At(ln(t,e))})}})(e,n.components[t])),parser:kt,value:t,viewProps:e.viewProps})}},gi={id:"input-string",type:"input",accept:(e,t)=>{if("string"!=typeof e)return null;const n=j(t,{options:V.optional.custom(tn)});return n?{initialValue:e,params:n}:null},binding:{reader:e=>St,constraint:e=>(function(e){const t=[],n=an(e.options);return n&&t.push(n),new He(t)})(e.params),writer:e=>en},controller:e=>{var t;const n=e.document,r=e.value,i=e.constraint;return i&&Ke(i,Ge)?new Xe(n,{props:M.fromObject({options:null!==(t=sn(i))&&void 0!==t?t:[]}),value:r,viewProps:e.viewProps}):new rt(n,{parser:e=>e,props:M.fromObject({formatter:Tt}),value:r,viewProps:e.viewProps})}},yi={monitor:{defaultInterval:200,defaultLineCount:3}},wi=v("mll");class _i{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(wi()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("textarea");n.classList.add(wi("i")),n.style.height=`calc(var(--bld-us) * ${t.lineCount})`,n.readOnly=!0,t.viewProps.bindDisabled(n),this.element.appendChild(n),this.textareaElem_=n,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,n=[];this.value.rawValue.forEach(e=>{void 0!==e&&n.push(this.formatter_(e))}),e.textContent=n.join("\n"),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}}class xi{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new _i(e,{formatter:t.formatter,lineCount:t.lineCount,value:this.value,viewProps:this.viewProps})}}const ki=v("sgl");class Ci{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(ki()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("input");n.classList.add(ki("i")),n.readOnly=!0,n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=void 0!==t?this.formatter_(t):""}onValueUpdate_(){this.update_()}}class Ei{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new Ci(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}}const Ai={id:"monitor-bool",type:"monitor",accept:(e,t)=>{if("boolean"!=typeof e)return null;const n=j(t,{lineCount:V.optional.number});return n?{initialValue:e,params:n}:null},binding:{reader:e=>it},controller:e=>{var t;return 1===e.value.rawValue.length?new Ei(e.document,{formatter:ot,value:e.value,viewProps:e.viewProps}):new xi(e.document,{formatter:ot,lineCount:null!==(t=e.params.lineCount)&&void 0!==t?t:yi.monitor.defaultLineCount,value:e.value,viewProps:e.viewProps})}},Pi=v("grl");class Mi{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Pi()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const n=e.createElementNS(R,"svg");n.classList.add(Pi("g")),n.style.height=`calc(var(--bld-us) * ${t.lineCount})`,this.element.appendChild(n),this.svgElem_=n;const r=e.createElementNS(R,"polyline");this.svgElem_.appendChild(r),this.lineElem_=r;const i=e.createElement("div");i.classList.add(Pi("t"),v("tt")()),this.element.appendChild(i),this.tooltipElem_=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const e=this.svgElem_.getBoundingClientRect(),t=this.value.rawValue.length-1,n=this.props_.get("minValue"),r=this.props_.get("maxValue"),i=[];this.value.rawValue.forEach((o,a)=>{if(void 0===o)return;const s=Ut(a,0,t,0,e.width),l=Ut(o,n,r,e.height,0);i.push([s,l].join(","))}),this.lineElem_.setAttributeNS(null,"points",i.join(" "));const o=this.tooltipElem_,a=this.value.rawValue[this.cursor_.rawValue];if(void 0===a)return void o.classList.remove(Pi("t","a"));const s=Ut(this.cursor_.rawValue,0,t,0,e.width),l=Ut(a,n,r,e.height,0);o.style.left=`${s}px`,o.style.top=`${l}px`,o.textContent=`${this.formatter_(a)}`,o.classList.contains(Pi("t","a"))||(o.classList.add(Pi("t","a"),Pi("t","in")),o.classList.remove(Pi("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class Si{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props_=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=P(-1),this.view=new Mi(e,{cursor:this.cursor_,formatter:t.formatter,lineCount:t.lineCount,props:this.props_,value:this.value,viewProps:this.viewProps}),I(e)){const e=new zt(this.view.element);e.emitter.on("down",this.onGraphPointerDown_),e.emitter.on("move",this.onGraphPointerMove_),e.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const t=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(Ut(e.offsetX,0,t.width,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){this.cursor_.rawValue=e.data.point?Math.floor(Ut(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length)):-1}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function Ti(e){return"format"in e&&!l(e.format)?e.format:At(2)}function Vi(e){return"view"in e&&"graph"===e.view}const ji={id:"monitor-number",type:"monitor",accept:(e,t)=>{if("number"!=typeof e)return null;const n=j(t,{format:V.optional.function,lineCount:V.optional.number,max:V.optional.number,min:V.optional.number,view:V.optional.string});return n?{initialValue:e,params:n}:null},binding:{defaultBufferSize:e=>Vi(e)?64:1,reader:e=>Ct},controller:e=>Vi(e.params)?function(e){var t,n,r;return new Si(e.document,{formatter:Ti(e.params),lineCount:null!==(t=e.params.lineCount)&&void 0!==t?t:yi.monitor.defaultLineCount,props:M.fromObject({maxValue:null!==(n="max"in e.params?e.params.max:null)&&void 0!==n?n:100,minValue:null!==(r="min"in e.params?e.params.min:null)&&void 0!==r?r:0}),value:e.value,viewProps:e.viewProps})}(e):function(e){var t;return 1===e.value.rawValue.length?new Ei(e.document,{formatter:Ti(e.params),value:e.value,viewProps:e.viewProps}):new xi(e.document,{formatter:Ti(e.params),lineCount:null!==(t=e.params.lineCount)&&void 0!==t?t:yi.monitor.defaultLineCount,value:e.value,viewProps:e.viewProps})}(e)},Oi={id:"monitor-string",type:"monitor",accept:(e,t)=>{if("string"!=typeof e)return null;const n=j(t,{lineCount:V.optional.number,multiline:V.optional.boolean});return n?{initialValue:e,params:n}:null},binding:{reader:e=>St},controller:e=>{var t;const n=e.value;return n.rawValue.length>1||"multiline"in e.params&&e.params.multiline?new xi(e.document,{formatter:Tt,lineCount:null!==(t=e.params.lineCount)&&void 0!==t?t:yi.monitor.defaultLineCount,value:n,viewProps:e.viewProps}):new Ei(e.document,{formatter:Tt,value:n,viewProps:e.viewProps})}};class Di{constructor(e){this.onValueChange_=this.onValueChange_.bind(this),this.reader=e.reader,this.writer=e.writer,this.emitter=new d,this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.target=e.target,this.read()}read(){const e=this.target.read();void 0!==e&&(this.value.rawValue=this.reader(e))}write_(e){this.writer(this.target,e)}onValueChange_(e){this.write_(e.rawValue),this.emitter.emit("change",{options:e.options,rawValue:e.rawValue,sender:this})}}class Li{constructor(e){this.onTick_=this.onTick_.bind(this),this.reader_=e.reader,this.target=e.target,this.emitter=new d,this.value=e.value,this.ticker=e.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const e=this.target.read();if(void 0===e)return;const t=this.value.rawValue,n=this.reader_(e);this.value.rawValue=function(e,t){const n=[...Ot(e),t];return n.length>e.length?n.splice(0,n.length-e.length):Vt(n,e.length),n}(t,n),this.emitter.emit("update",{rawValue:n,sender:this})}onTick_(e){this.read()}}function Ri(e,t){return 0===t?new Ne:new qe(e,null!=t?t:yi.monitor.defaultInterval)}class Ii{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(e){"blade"===e.type?this.pluginsMap_.blades.unshift(e):"input"===e.type?this.pluginsMap_.inputs.unshift(e):"monitor"===e.type&&this.pluginsMap_.monitors.unshift(e)}createInput(e,t,n){if(l(t.read()))throw new p({context:{key:t.key},type:"nomatchingcontroller"});const r=this.pluginsMap_.inputs.reduce((r,i)=>null!=r?r:function(e,t){const n=e.accept(t.target.read(),t.params);if(l(n))return null;const r=V,i={target:t.target,initialValue:n.initialValue,params:n.params},o=e.binding.reader(i),a=e.binding.constraint?e.binding.constraint(i):void 0,s=P(o(n.initialValue),{constraint:a,equals:e.binding.equals}),u=new Di({reader:o,target:t.target,value:s,writer:e.binding.writer(i)}),c=r.optional.boolean(t.params.disabled).value,p=r.optional.boolean(t.params.hidden).value,h=e.controller({constraint:a,document:t.document,initialValue:n.initialValue,params:n.params,value:u.value,viewProps:Se.create({disabled:c,hidden:p})}),f=r.optional.string(t.params.label).value;return new re(t.document,{binding:u,blade:Q(),props:M.fromObject({label:null!=f?f:t.target.key}),valueController:h})}(i,{document:e,target:t,params:n}),null);if(r)return r;throw new p({context:{key:t.key},type:"nomatchingcontroller"})}createMonitor(e,t,n){const r=this.pluginsMap_.monitors.reduce((r,i)=>null!=r?r:function(e,t){var n,r,i;const o=V,a=e.accept(t.target.read(),t.params);if(l(a))return null;const s=e.binding.reader({target:t.target,initialValue:a.initialValue,params:a.params}),u=null!==(r=null!==(n=o.optional.number(t.params.bufferSize).value)&&void 0!==n?n:e.binding.defaultBufferSize&&e.binding.defaultBufferSize(a.params))&&void 0!==r?r:1,c=o.optional.number(t.params.interval).value,p=new Li({reader:s,target:t.target,ticker:Ri(t.document,c),value:jt(u)}),h=o.optional.boolean(t.params.disabled).value,f=o.optional.boolean(t.params.hidden).value,d=e.controller({document:t.document,params:a.params,value:p.value,viewProps:Se.create({disabled:h,hidden:f})}),m=null!==(i=o.optional.string(t.params.label).value)&&void 0!==i?i:t.target.key;return new oe(t.document,{binding:p,blade:Q(),props:M.fromObject({label:m}),valueController:d})}(i,{document:e,params:n,target:t}),null);if(r)return r;throw new p({context:{key:t.key},type:"nomatchingcontroller"})}createBlade(e,t){const n=this.pluginsMap_.blades.reduce((n,r)=>null!=n?n:function(e,t){const n=e.accept(t.params);if(!n)return null;const r=V.optional.boolean(t.params.disabled).value,i=V.optional.boolean(t.params.hidden).value;return e.controller({blade:Q(),document:t.document,params:s(Object.assign(Object.assign({},n.params),{disabled:r,hidden:i})),viewProps:Se.create({disabled:r,hidden:i})})}(r,{document:e,params:t}),null);if(!n)throw new p({type:"nomatchingview",context:{params:t}});return n}createBladeApi(e){if(e instanceof re)return new ne(e);if(e instanceof oe)return new ie(e);if(e instanceof ve)return new ue(e,this);const t=this.pluginsMap_.blades.reduce((t,n)=>null!=t?t:n.api({controller:e,pool:this}),null);if(!t)throw p.shouldNeverHappen();return t}}class Bi extends t{constructor(e){super(e),this.emitter_=new d,this.controller_.valueController.value.emitter.on("change",e=>{this.emitter_.emit("change",{event:new r(this,e.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get options(){return this.controller_.valueController.props.get("options")}set options(e){this.controller_.valueController.props.set("options",e)}get value(){return this.controller_.valueController.value.rawValue}set value(e){this.controller_.valueController.value.rawValue=e}on(e,t){const n=t.bind(this);return this.emitter_.on(e,e=>{n(e.event)}),this}}class Fi extends t{constructor(e){super(e),this.emitter_=new d,this.controller_.valueController.value.emitter.on("change",e=>{this.emitter_.emit("change",{event:new r(this,e.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(e){this.controller_.valueController.sliderController.props.set("maxValue",e)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(e){this.controller_.valueController.sliderController.props.set("minValue",e)}get value(){return this.controller_.valueController.value.rawValue}set value(e){this.controller_.valueController.value.rawValue=e}on(e,t){const n=t.bind(this);return this.emitter_.on(e,e=>{n(e.event)}),this}}class zi extends t{constructor(e){super(e),this.emitter_=new d,this.controller_.valueController.value.emitter.on("change",e=>{this.emitter_.emit("change",{event:new r(this,e.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(e){this.controller_.valueController.props.set("formatter",e)}get value(){return this.controller_.valueController.value.rawValue}set value(e){this.controller_.valueController.value.rawValue=e}on(e,t){const n=t.bind(this);return this.emitter_.on(e,e=>{n(e.event)}),this}}const Ui={id:"list",type:"blade",accept(e){const t=V,n=j(e,{options:t.required.custom(tn),value:t.required.raw,view:t.required.constant("list"),label:t.optional.string});return n?{params:n}:null},controller(e){const t=new Xe(e.document,{props:M.fromObject({options:on(e.params.options)}),value:P(e.params.value),viewProps:e.viewProps});return new _e(e.document,{blade:e.blade,props:M.fromObject({label:e.params.label}),valueController:t})},api:e=>e.controller instanceof _e&&e.controller.valueController instanceof Xe?new Bi(e.controller):null};class Ni extends ce{constructor(e,t){super(e,t)}get element(){return this.controller_.view.element}importPreset(e){!function(e,t){e.forEach(e=>{const n=t[e.presetKey];void 0!==n&&e.write(n)})}(this.controller_.rackController.rack.find(re).map(e=>e.binding.target),e),this.refresh()}exportPreset(){return function(e){return e.reduce((e,t)=>Object.assign(e,{[t.presetKey]:t.read()}),{})}(this.controller_.rackController.rack.find(re).map(e=>e.binding.target))}refresh(){this.controller_.rackController.rack.find(re).forEach(e=>{e.binding.read()}),this.controller_.rackController.rack.find(oe).forEach(e=>{e.binding.read()})}}class qi extends ye{constructor(e,t){super(e,{expanded:t.expanded,blade:t.blade,props:t.props,root:!0,viewProps:t.viewProps})}}const Hi={id:"slider",type:"blade",accept(e){const t=V,n=j(e,{max:t.required.number,min:t.required.number,view:t.required.constant("slider"),format:t.optional.function,label:t.optional.string,value:t.optional.number});return n?{params:n}:null},controller(e){var t,n;const r=null!==(t=e.params.value)&&void 0!==t?t:0,i=new Zt(e.document,{baseStep:1,parser:kt,sliderProps:M.fromObject({maxValue:e.params.max,minValue:e.params.min}),textProps:M.fromObject({draggingScale:cn(void 0,r),formatter:null!==(n=e.params.format)&&void 0!==n?n:Et}),value:P(r),viewProps:e.viewProps});return new _e(e.document,{blade:e.blade,props:M.fromObject({label:e.params.label}),valueController:i})},api:e=>e.controller instanceof _e&&e.controller.valueController instanceof Zt?new Fi(e.controller):null},Ki={id:"text",type:"blade",accept(e){const t=V,n=j(e,{parse:t.required.function,value:t.required.raw,view:t.required.constant("text"),format:t.optional.function,label:t.optional.string});return n?{params:n}:null},controller(e){var t;const n=new rt(e.document,{parser:e.params.parse,props:M.fromObject({formatter:null!==(t=e.params.format)&&void 0!==t?t:e=>String(e)}),value:P(e.params.value),viewProps:e.viewProps});return new _e(e.document,{blade:e.blade,props:M.fromObject({label:e.params.label}),valueController:n})},api:e=>e.controller instanceof _e&&e.controller.valueController instanceof rt?new zi(e.controller):null};function Gi(e,t,n){if(e.querySelector(`style[data-tp-style=${t}]`))return;const r=e.createElement("style");r.dataset.tpStyle=t,r.textContent=n,e.head.appendChild(r)}const $i=new class{constructor(e){const[t,n]=e.split("-"),r=t.split(".");this.major=parseInt(r[0],10),this.minor=parseInt(r[1],10),this.patch=parseInt(r[2],10),this.prerelease=null!=n?n:null}toString(){const e=[this.major,this.minor,this.patch].join(".");return null!==this.prerelease?[e,this.prerelease].join("-"):e}}("3.1.0");e.BladeApi=t,e.ButtonApi=f,e.FolderApi=ce,e.InputBindingApi=ne,e.ListApi=Bi,e.MonitorBindingApi=ie,e.Pane=class extends Ni{constructor(e){var t,n;const r=null!=e?e:{},i=null!==(t=r.document)&&void 0!==t?t:B(),o=function(){const e=new Ii;return[ci,di,bi,gi,Yr,Ur,zr,Ir,dn,Ai,Oi,ji,W,we,Ae,Ue].forEach(t=>{e.register(t)}),e}();super(new qi(i,{expanded:r.expanded,blade:Q(),props:M.fromObject({title:r.title}),viewProps:Se.create()}),o),this.pool_=o,this.containerElem_=null!==(n=r.container)&&void 0!==n?n:function(e){const t=e.createElement("div");return t.classList.add(v("dfw")()),e.body&&e.body.appendChild(t),t}(i),this.containerElem_.appendChild(this.element),this.doc_=i,this.usesDefaultWrapper_=!r.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw p.alreadyDisposed();return this.doc_}dispose(){const e=this.containerElem_;if(!e)throw p.alreadyDisposed();if(this.usesDefaultWrapper_){const t=e.parentElement;t&&t.removeChild(e)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(e){("plugin"in e?[e.plugin]:"plugins"in e?e.plugins:[]).forEach(e=>{this.pool_.register(e),this.embedPluginStyle_(e)})}embedPluginStyle_(e){e.css&&Gi(this.document,`plugin-${e.id}`,e.css)}setUpDefaultPlugins_(){Gi(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor transparent;scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:transparent}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:transparent solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, #28292e);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, #adafb8);--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, #28292e);--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, #bbbcc4);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, #bbbcc4);--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_i,.tp-fldv_c>.tp-tabv>.tp-tabv_i{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a:before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_c{border-left:var(--cnt-bg) solid 4px}.tp-fldv_b:hover+.tp-fldv_c{border-left-color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_c{border-left-color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_c{border-left-color:var(--cnt-bg-a)}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv.tp-v-disabled{opacity:.5}.tp-tabv_i{align-items:flex-end;display:flex;overflow:hidden}.tp-tabv.tp-tabv-nop .tp-tabv_i{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_i::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{border-left:var(--cnt-bg) solid 4px;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p)}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:-2px;position:absolute;width:2px}.tp-tbiv_b{background-color:var(--cnt-bg);display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);width:100%}.tp-tbiv_b:hover{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active{background-color:var(--cnt-bg-a)}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) transparent transparent transparent;border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c,.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_i{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(e=>{this.embedPluginStyle_(e)}),this.registerPlugin({plugins:[Hi,Ui,Ue,Ki]})}},e.SeparatorApi=xe,e.SliderApi=Fi,e.TabApi=Le,e.TabPageApi=De,e.TextApi=zi,e.TpChangeEvent=r,e.VERSION=$i,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof n&&void 0!==t?i(n):"function"==typeof define&&define.amd?define(["exports"],i):i((r="undefined"!=typeof globalThis?globalThis:r||self).Tweakpane={})},{}],5:[function(e,t,n){t.exports=function(e){var t=0,n=0,r=0,i=0;return e.map(function(e){var o=(e=e.slice())[0],a=o.toUpperCase();if(o!=a)switch(e[0]=a,o){case"a":e[6]+=r,e[7]+=i;break;case"v":e[1]+=i;break;case"h":e[1]+=r;break;default:for(var s=1;s<e.length;)e[s++]+=r,e[s++]+=i}switch(a){case"Z":r=t,i=n;break;case"H":r=e[1];break;case"V":i=e[1];break;case"M":r=t=e[1],i=n=e[2];break;default:r=e[e.length-2],i=e[e.length-1]}return e})}},{}],6:[function(e,t,n){function r(e){return[e[0],e[1]]}function i(e,t){return[e,t]}t.exports=function(e){var t="number"==typeof(e=e||{}).recursion?e.recursion:8,n="number"==typeof e.epsilon?e.epsilon:1.1920929e-7,o="number"==typeof e.pathEpsilon?e.pathEpsilon:1,a="number"==typeof e.angleEpsilon?e.angleEpsilon:.01,s=e.angleTolerance||0,l=e.cuspLimit||0;return function(e,u,c,p,h,f){f||(f=[]);var d=o/(h="number"==typeof h?h:1);return function(e,o,u,c,p,h){p.push(r(e)),function e(r,o,u,c,p,h,f,d,m,v,b){if(b>t)return;var g=Math.PI;var y=(r+u)/2;var w=(o+c)/2;var _=(u+p)/2;var x=(c+h)/2;var k=(p+f)/2;var C=(h+d)/2;var E=(y+_)/2;var A=(w+x)/2;var P=(_+k)/2;var M=(x+C)/2;var S=(E+P)/2;var T=(A+M)/2;if(b>0){var V,j,O=f-r,D=d-o,L=Math.abs((u-f)*D-(c-d)*O),R=Math.abs((p-f)*D-(h-d)*O);if(L>n&&R>n){if((L+R)*(L+R)<=v*(O*O+D*D)){if(s<a)return void m.push(i(S,T));var I=Math.atan2(h-c,p-u);if(V=Math.abs(I-Math.atan2(c-o,u-r)),j=Math.abs(Math.atan2(d-h,f-p)-I),V>=g&&(V=2*g-V),j>=g&&(j=2*g-j),V+j<s)return void m.push(i(S,T));if(0!==l){if(V>l)return void m.push(i(u,c));if(j>l)return void m.push(i(p,h))}}}else if(L>n){if(L*L<=v*(O*O+D*D)){if(s<a)return void m.push(i(S,T));if((V=Math.abs(Math.atan2(h-c,p-u)-Math.atan2(c-o,u-r)))>=g&&(V=2*g-V),V<s)return m.push(i(u,c)),void m.push(i(p,h));if(0!==l&&V>l)return void m.push(i(u,c))}}else if(R>n){if(R*R<=v*(O*O+D*D)){if(s<a)return void m.push(i(S,T));if((V=Math.abs(Math.atan2(d-h,f-p)-Math.atan2(h-c,p-u)))>=g&&(V=2*g-V),V<s)return m.push(i(u,c)),void m.push(i(p,h));if(0!==l&&V>l)return void m.push(i(p,h))}}else if((O=S-(r+f)/2)*O+(D=T-(o+d)/2)*D<=v)return void m.push(i(S,T))}e(r,o,y,w,E,A,S,T,m,v,b+1);e(S,T,P,M,k,C,f,d,m,v,b+1)}(e[0],e[1],o[0],o[1],u[0],u[1],c[0],c[1],p,h,0),p.push(r(c))}(e,u,c,p,f,d*=d),f}}},{}],7:[function(e,t,n){t.exports=e("./function")()},{"./function":6}],8:[function(e,t,n){"use strict";var r=Math.abs,i=Math.min;function o(e,t,n,a){var s=r(e-t);return null==n&&(n=o.DBL_EPSILON),null==a&&(a=n),s<=n||(s<=a*i(r(e),r(t))||e===t)}o.FLT_EPSILON=1.1920929e-7,o.DBL_EPSILON=2.220446049250313e-16,t.exports=o},{}],9:[function(e,t,n){var r=Object.prototype.toString;t.exports=function(e){return e.BYTES_PER_ELEMENT&&"[object ArrayBuffer]"===r.call(e.buffer)||Array.isArray(e)}},{}],10:[function(e,t,n){var r=e("an-array"),i=e("almost-equal");t.exports=function(e,t,n,o){return!!(e&&t&&r(e)&&r(t))&&(e.length===t.length&&("number"!=typeof n&&(n=i.FLT_EPSILON),"number"!=typeof o&&(o=n),Array.prototype.slice.call(e).every(function(e,r){var a=t[r];return e===a||i(e,a,n,o)})))}},{"almost-equal":11,"an-array":9}],11:[function(e,t,n){"use strict";var r=Math.abs,i=Math.min;function o(e,t,n,o){var a=r(e-t);return a<=n||(a<=o*i(r(e),r(t))||e===t)}o.FLT_EPSILON=1.1920929e-7,o.DBL_EPSILON=2.220446049250313e-16,t.exports=o},{}],12:[function(e,t,n){var r=e("./lib/css-color"),i=e("./lib/css-color-names.json"),o=e("./lib/relative-luminance"),a=e("./lib/hsl"),s=e("./lib/hex-to-rgba"),l=e("./lib/rgba-to-hex");t.exports.parse=r.parse,t.exports.style=r.style,t.exports.names=i,t.exports.relativeLuminance=function(e){var n=t.exports.parse(e);return n?o(n.rgb):null},t.exports.contrastRatio=function(e,n){var r=t.exports.relativeLuminance(e),i=t.exports.relativeLuminance(n);return null==r||null==i?null:(Math.max(r,i)+.05)/(Math.min(r,i)+.05)},t.exports.offsetHSL=function(e,n,r,i){var o=t.exports.parse(e);return o?(o.hsla[0]+=n||0,o.hsla[1]=Math.max(0,Math.min(100,o.hsla[1]+(r||0))),o.hsla[2]=Math.max(0,Math.min(100,o.hsla[2]+(i||0))),t.exports.parse({hsla:o.hsla})):null},t.exports.blend=function(e,n,r){var i=t.exports.parse(e),o=t.exports.parse(n);if(null==i||null==o)return null;var a=i.rgba,s=o.rgba,l=(r="number"==typeof r&&isFinite(r)?r:1)*s[3];if(l>=1)return o;for(var u=0;u<3;u++)s[u]=s[u]*l+a[u]*(a[3]*(1-l));return s[3]=Math.max(0,Math.min(1,l+a[3]*(1-l))),t.exports.parse(s)},t.exports.hexToRGBA=s,t.exports.RGBAToHex=l,t.exports.RGBAToHSLA=a.RGBAToHSLA,t.exports.HSLAToRGBA=a.HSLAToRGBA},{"./lib/css-color":18,"./lib/css-color-names.json":17,"./lib/hex-to-rgba":19,"./lib/hsl":20,"./lib/relative-luminance":22,"./lib/rgba-to-hex":23}],13:[function(e,t,n){var r=e("lineclip"),i=e("almost-equal"),o=e("array-almost-equal"),a=e("clone"),s=e("./lib/vec2").squaredDistance;t.exports.arePointsCollinear=function(e,t,n){var r=e[0],o=e[1];return i((o-t[1])*(r-n[0]),(o-n[1])*(r-t[0]))},t.exports.removeDuplicatePoints=function(e){for(var t,n=[],r=0;r<e.length;r++){var i=e[r];t&&o(t,i)||(n.push(i),t=i)}return a(n)},t.exports.removeCollinearPoints=function(e){for(var n=[],r=a(e);r.length>=3;){var i=r[0],o=r[1],l=r[2],u=t.exports.arePointsCollinear(i,o,l);if(u)s(i,o)>s(i,l)&&(u=!1);if(u)r.splice(1,1);else for(var c=0;c<1;c++)n.push(r.shift())}for(;r.length;)n.push(r.shift());return n},t.exports.clipSegmentToCircle=e("./lib/clip/clip-segment-to-circle"),t.exports.clipLineToCircle=e("./lib/clip/clip-line-to-circle"),t.exports.clipPolylinesToBox=function(e,t,n,i){if(!Array.isArray(t)||2!==t.length&&4!==t.length)throw new Error("Expected box to either be format [ minPoint, maxPoint ] or [ minX, minY, maxX, maxY ]");if(2===t.length){var o=t[0],a=t[1];t=[o[0],o[1],a[0],a[1]]}return i=!1!==i,(n=Boolean(n))?e.map(function(e){var n=r.polygon(e,t);return i&&n.length>2&&n.push(n[0]),n}).filter(function(e){return e.length>0}):e.map(function(e){return r.polyline(e,t)}).reduce(function(e,t){return e.concat(t)},[])},t.exports.createHatchLines=function(e,t,n,r){if(!Array.isArray(e)||2!==e.length&&4!==e.length)throw new Error("Expected box to either be format [ minPoint, maxPoint ] or [ minX, minY, maxX, maxY ]");if(2===e.length){var i=e[0],o=e[1];e=[i[0],i[1],o[0],o[1]]}null==t&&(t=-Math.PI/4);null==n&&(n=.5);null==r&&(r=[]);if(0===(n=Math.abs(n)))throw new Error("cannot use a spacing of zero as it will run an infinite loop!");var a=e[0],s=e[1],l=e[2],u=e[3],c=l-a,p=u-s;if(0===c||0===p)return r;var h=Math.sqrt(c*c+p*p)/2,f=Math.PI/2-t,d=Math.cos(f),m=Math.sin(f),v=a+c/2,b=s+p/2,g=-h;for(;g<=h;){var y=v+g*d+h*m,w=b+g*m-h*d,_=v+g*d-h*m,x=b+g*m+h*d;g+=n,y<a&&_<a||y>l&&_>l||(w<s&&x<s||w>u&&x>u||r.push([[y,w],[_,x]]))}return r},t.exports.getBounds=function(e){var t=e.length;if(0===t)throw new Error("Expected points to be a non-empty array");for(var n=e[0].length,r=e[0].slice(),i=e[0].slice(),o=1;o<t;++o)for(var a=e[o],s=0;s<n;++s){var l=a[s];r[s]=Math.min(r[s],l),i[s]=Math.max(i[s],l)}return[r,i]}},{"./lib/clip/clip-line-to-circle":15,"./lib/clip/clip-segment-to-circle":16,"./lib/vec2":24,"almost-equal":8,"array-almost-equal":10,clone:34,lineclip:41}],14:[function(e,t,n){t.exports={random:e("./random"),math:e("./math"),penplot:e("./penplot.js"),geometry:e("./geometry.js"),shader:e("./shader.js"),color:e("./color.js")}},{"./color.js":12,"./geometry.js":13,"./math":26,"./penplot.js":30,"./random":31,"./shader.js":32}],15:[function(e,t,n){var r=e("almost-equal");function i(e){return e*e}t.exports=function(e,t,n,o,a){null==a&&(a=[]);var s,l=i(t[0]-e[0])+i(t[1]-e[1]),u=2*((t[0]-e[0])*(e[0]-n[0])+(t[1]-e[1])*(e[1]-n[1])),c=i(n[0])+i(n[1])+i(e[0])+i(e[1])-2*(n[0]*e[0]+n[1]*e[1])-i(o),p=u*u-4*l*c;if(p<0)return!1;if(r(p,0))return a.push([e[0]+(s=-u/(2*l))*(t[0]-e[0]),e[1]+s*(t[1]-e[1])]),!0;if(p>0){var h=Math.sqrt(p);return a.push([e[0]+(s=(-u+h)/(2*l))*(t[0]-e[0]),e[1]+s*(t[1]-e[1])]),a.push([e[0]+(s=(-u-h)/(2*l))*(t[0]-e[0]),e[1]+s*(t[1]-e[1])]),!0}return null}},{"almost-equal":8}],16:[function(e,t,n){var r=e("almost-equal");function i(e,t,n,r,i){return(o=n-e)*o+(a=r-t)*a<=i*i;var o,a}function o(e,t,n,r){var i=e-n,o=t-r;return Math.sqrt(i*i+o*o)}function a(e,t,n,r,i){var a=i/o(e,t,n,r);return[e+a*(n-e),t+a*(r-t)]}t.exports=function(e,t,n,s,l){return function(e,t,n,s,l,u,c,p){null==p&&(p=[]);var h,f,d,m,v,b=i(e,t,l,u,c),g=i(n,s,l,u,c);if(b&&g)return p.push([e,t]),p.push([n,s]),!0;if(b||g){d=function(e,t,n,r,i,o){var a=n-e,s=r-t,l=(a*(i-e)+s*(o-t))/(a*a+s*s);return[e+l*a,t+l*s]}(e,t,n,s,l,u),h=o(m=d[0],v=d[1],l,u),f=Math.sqrt(c*c-h*h);var y=b?[e,t]:[n,s],w=b?a(m,v,n,s,f):a(m,v,e,t,f);return r(y[0],w[0])&&r(y[1],w[1])?(p.push(y),!0):(p.push(y),p.push(w),!0)}return d=function(e,t,n,r,i,o){var a=n-e,s=r-t,l=a*(i-e)+s*(o-t);if(l<=0)return[e,t];var u=a*a+s*s;if(u<=l)return[n,r];var c=l/u;return[e+c*a,t+c*s]}(e,t,n,s,l,u),v=d[1],!(r(e,m=d[0])&&r(t,v)||r(n,m)&&r(s,v))&&(!((h=o(m,v,l,u))>c)&&(r(h,c)?(p.push([m,v]),!0):r(h,0)?(p.push(a(l,u,e,t,c)),p.push(a(l,u,n,s,c)),!0):(f=Math.sqrt(c*c-h*h),p.push(a(m,v,e,t,f)),p.push(a(m,v,n,s,f)),!0)))}(e[0],e[1],t[0],t[1],n[0],n[1],s,l)}},{"almost-equal":8}],17:[function(e,t,n){t.exports={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"}},{}],18:[function(e,t,n){var r=e("./css-color-names.json"),i=e("./hsl"),o=e("./hex-to-rgba"),a=e("./rgba-to-hex"),s=e("./wrap");function l(e){if("string"!=typeof e)throw new TypeError("Color parsing must be performed on a string parameter");var t,n,l;if((e=e.toLowerCase())in r?e=r[e]:"transparent"===e&&(e="#00000000"),/^#[a-f0-9]+$/.test(e))t=o(e),l=a(t),n=i.RGBAToHSLA(t);else{var u=/^((?:rgb|hsl)a?)\s*\(([^)]*)\)/.exec(e);if(!u)return null;var c=u[1].replace(/a$/,""),p=u[2].replace(/^\s+|\s+$/g,"").split(/\s*,\s*/).map(function(e,t){return t<=2?Math.round(parseFloat(e)||0):("number"==typeof(e=parseFloat(e))&&isFinite(e)||(e=1),e)});void 0!==p[3]&&isFinite(p[3])||(p[3]=1),"rgb"===c?(n=i.RGBAToHSLA(p),t=p):"hsl"===c&&(t=i.HSLAToRGBA(p),p[0]=s(p[0],0,360),n=p),l=a(t)}return t||l||n?{hex:l,alpha:t[3],rgb:t.slice(0,3),rgba:t,hsl:n.slice(0,3),hsla:n}:null}function u(e,t,n,r){return e=Math.max(0,Math.min(255,Math.round(e))),t=Math.max(0,Math.min(255,Math.round(t))),n=Math.max(0,Math.min(255,Math.round(n))),1!==r&&isFinite(r)&&void 0!==r?"rgba("+[e,t,n,r=Math.max(0,Math.min(1,r))].join(", ")+")":"rgb("+[e,t,n].join(", ")+")"}function c(e,t,n,r){return e=s(e,0,360),e=Math.max(0,Math.min(360,Math.round(e))),t=Math.max(0,Math.min(100,Math.round(t))),n=Math.max(0,Math.min(100,Math.round(n))),1!==r&&isFinite(r)&&void 0!==r?"hsla("+[e,t,n,r=Math.max(0,Math.min(1,r))].join(", ")+")":"hsl("+[e,t,n].join(", ")+")"}t.exports.parse=function(e){if("string"==typeof e)return l(e);if(Array.isArray(e)&&e.length>=3){var t=u(e[0],e[1],e[2],e[3]);return l(t)}var n;if(e&&"object"==typeof e&&(e.hex?n=e.hex:e.rgba?n=u(e.rgba[0],e.rgba[1],e.rgba[2],e.rgba[3]):e.hsla?n=c(e.hsla[0],e.hsla[1],e.hsla[2],e.hsla[3]):e.rgb?n=u(e.rgb[0],e.rgb[1],e.rgb[2]):e.hsl&&(n=c(e.hsl[0],e.hsl[1],e.hsl[2])),n))return l(n);return null},t.exports.style=function(e){var n=t.exports.parse(e);if(n){var r=n.rgba;return u(r[0],r[1],r[2],r[3])}return null}},{"./css-color-names.json":17,"./hex-to-rgba":19,"./hsl":20,"./rgba-to-hex":23,"./wrap":25}],19:[function(e,t,n){t.exports=function(e){if("string"!=typeof e)throw new TypeError("Hex code parsing must be performed on a string parameter");if(e=e.toLowerCase(),!/^#[a-f0-9]+$/.test(e))return null;var t=e.replace(/^#/,""),n=1;8===t.length&&(n=parseInt(t.slice(6,8),16)/255,t=t.slice(0,6));4===t.length&&(n=parseInt(t.slice(3,4).repeat(2),16)/255,t=t.slice(0,3));3===t.length&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]);var r=parseInt(t,16);return[r>>16,r>>8&255,255&r,n]}},{}],20:[function(e,t,n){var r=e("float-hsl2rgb"),i=e("float-rgb2hsl"),o=e("./wrap");t.exports.RGBAToHSLA=function(e){var t=i([e[0]/255,e[1]/255,e[2]/255]);return[Math.max(0,Math.min(360,Math.round(360*t[0]))),Math.max(0,Math.min(100,Math.round(100*t[1]))),Math.max(0,Math.min(100,Math.round(100*t[2]))),e[3]]},t.exports.HSLAToRGBA=function(e){var t=o(e[0],0,360),n=r([t/360,e[1]/100,e[2]/100]);return[Math.max(0,Math.min(255,Math.round(255*n[0]))),Math.max(0,Math.min(255,Math.round(255*n[1]))),Math.max(0,Math.min(255,Math.round(255*n[2]))),e[3]]}},{"./wrap":25,"float-hsl2rgb":39,"float-rgb2hsl":40}],21:[function(e,t,n){var r=e("clone"),i=e("./vec2").squaredDistance;function o(e,t,n){var r=Math.min(t,n),i=Math.max(t,n),o=(e=e.slice())[r].concat(e[i].slice(1));return e.splice(i,1),e.splice(r,1,o),e}t.exports.sort=function(e){if(!(e=r(e)).length)return e;var t=[];for(t.push(e[0]),e=e.slice(1);e.length;){var n=t[t.length-1],o=n[n.length-1],a=e.reduce(function(e,t,n){var r=t[t.length-1],a=i(o,t[0]),s=i(o,r);return e?a<e.distance?{idx:n,distance:a,reverse:!1}:s<e.distance?{idx:n,distance:s,reverse:!0}:e:{idx:n,distance:Math.min(a,s),reverse:s<a}},null),s=a.reverse,l=e.splice(a.idx,1)[0].slice();s&&l.reverse(),t.push(l)}return t},t.exports.merge=function(e,t){var n=(t=null!=t?t:.05)*t;e=r(e);for(var a=1;a<e.length;a++){var s=e[a-1];i(e[a][0],s[s.length-1])<n&&(e=o(e,a-1,a),a-=1)}return e}},{"./vec2":24,clone:34}],22:[function(e,t,n){var r=.2126,i=.7152,o=.0722,a=1/12.92;function s(e){return Math.pow((e+.055)/1.055,2.4)}t.exports=function(e){var t=e[0]/255,n=e[1]/255,l=e[2]/255,u=t<=.03928?t*a:s(t),c=n<=.03928?n*a:s(n),p=l<=.03928?l*a:s(l);return u*r+c*i+p*o}},{}],23:[function(e,t,n){t.exports=function(e){if(!e||!Array.isArray(e))throw new TypeError("Must specify an array to convert into a hex code");var t=Math.max(0,Math.min(255,Math.round(e[0]||0))),n=Math.max(0,Math.min(255,Math.round(e[1]||0))),r=Math.max(0,Math.min(255,Math.round(e[2]||0))),i=e[3];void 0!==i&&isFinite(i)||(i=1);var o=Math.max(0,Math.min(255,Math.round(255*i))),a=255===o?"":(256|o).toString(16).slice(1);return"#"+((r|n<<8|t<<16|1<<24).toString(16).slice(1)+a)}},{}],24:[function(e,t,n){t.exports.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r}},{}],25:[function(e,t,n){t.exports=function(e,t,n){if("number"!=typeof t||"number"!=typeof n)throw new TypeError('Must specify "to" and "from" arguments as numbers');if(t>n){var r=t;t=n,n=r}var i=n-t;if(0===i)return n;return e-i*Math.floor((e-t)/i)}},{}],26:[function(e,t,n){var r=e("defined"),i=e("./lib/wrap"),o=Number.EPSILON;function a(e,t,n){return t<n?e<t?t:e>n?n:e:e<n?n:e>t?t:e}function s(e,t,n){return e*(1-n)+t*n}function l(e,t,n){return Math.abs(e-t)<o?0:(n-e)/(t-e)}function u(e,t){return t=r(t,0),"number"==typeof e&&isFinite(e)?e:t}function c(e){if("number"!=typeof e)throw new TypeError("Expected dims argument");return function(t,n){var i;n=r(n,0),null==t?i=n:"number"==typeof t&&isFinite(t)&&(i=t);var o,a=[];if(null==i)for(o=0;o<e;o++)a[o]=u(t[o],n);else for(o=0;o<e;o++)a[o]=i;return a}}function p(e,t,n,r){if(r=r||[],e.length!==t.length)throw new TypeError("min and max array are expected to have the same length");for(var i=0;i<e.length;i++)r[i]=s(e[i],t[i],n);return r}function h(e,t){if("number"!=typeof(e=r(e,0)))throw new TypeError("Expected n argument to be a number");for(var n=[],i=0;i<e;i++)n.push(t);return n}function f(e,t){return(e%t+t)%t}function d(e,t,n,r){return s(e,t,1-Math.exp(-n*r))}t.exports={mod:f,fract:function(e){return e-Math.floor(e)},sign:function(e){return e>0?1:e<0?-1:0},degToRad:function(e){return e*Math.PI/180},radToDeg:function(e){return 180*e/Math.PI},wrap:i,pingPong:function(e,t){return e=f(e,2*t),t-Math.abs(e-t)},linspace:function(e,t){if("number"!=typeof(e=r(e,0)))throw new TypeError("Expected n argument to be a number");"boolean"==typeof(t=t||{})&&(t={endpoint:!0});var n=r(t.offset,0);return t.endpoint?h(e).map(function(t,r){return e<=1?0:(r+n)/(e-1)}):h(e).map(function(t,r){return(r+n)/e})},lerp:s,lerpArray:p,inverseLerp:l,lerpFrames:function(e,t,n){t=a(t,0,1);var r=e.length-1,i=t*r,o=Math.floor(i),l=i-o,u=Math.min(o+1,r),c=e[o%e.length],h=e[u%e.length];if("number"==typeof c&&"number"==typeof h)return s(c,h,l);if(Array.isArray(c)&&Array.isArray(h))return p(c,h,l,n);throw new TypeError("Mismatch in value type of two array elements: "+o+" and "+u)},clamp:a,clamp01:function(e){return a(e,0,1)},smoothstep:function(e,t,n){var r=a(l(e,t,n),0,1);return r*r*(3-2*r)},damp:d,dampArray:function(e,t,n,r,i){i=i||[];for(var o=0;o<e.length;o++)i[o]=d(e[o],t[o],n,r);return i},mapRange:function(e,t,n,r,i,a){if(Math.abs(t-n)<o)return r;var s=(e-t)/(n-t)*(i-r)+r;return a&&(i<r?s<i?s=i:s>r&&(s=r):s>i?s=i:s<r&&(s=r)),s},expand2D:c(2),expand3D:c(3),expand4D:c(4)}},{"./lib/wrap":25,defined:38}],27:[function(e,t,n){var r,i;r=this,i=function(e){"use strict";var t=Math.PI,n=2*t,r=n-1e-6;function i(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function o(){return new i}i.prototype=o.prototype={constructor:i,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,r){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+r)},bezierCurveTo:function(e,t,n,r,i,o){this._+="C"+ +e+","+ +t+","+ +n+","+ +r+","+(this._x1=+i)+","+(this._y1=+o)},arcTo:function(e,n,r,i,o){var a=this._x1,s=this._y1,l=(r=+r)-(e=+e),u=(i=+i)-(n=+n),c=a-e,p=s-n,h=c*c+p*p;if((o=+o)<0)throw new Error("negative radius: "+o);if(null===this._x1)this._+="M"+(this._x1=e)+","+(this._y1=n);else if(h>1e-6)if(Math.abs(p*l-u*c)>1e-6&&o){var f=r-a,d=i-s,m=l*l+u*u,v=f*f+d*d,b=Math.sqrt(m),g=Math.sqrt(h),y=o*Math.tan((t-Math.acos((m+h-v)/(2*b*g)))/2),w=y/g,_=y/b;Math.abs(w-1)>1e-6&&(this._+="L"+(e+w*c)+","+(n+w*p)),this._+="A"+o+","+o+",0,0,"+ +(p*f>c*d)+","+(this._x1=e+_*l)+","+(this._y1=n+_*u)}else this._+="L"+(this._x1=e)+","+(this._y1=n);else;},arc:function(e,i,o,a,s,l){e=+e,i=+i,l=!!l;var u=(o=+o)*Math.cos(a),c=o*Math.sin(a),p=e+u,h=i+c,f=1^l,d=l?a-s:s-a;if(o<0)throw new Error("negative radius: "+o);null===this._x1?this._+="M"+p+","+h:(Math.abs(this._x1-p)>1e-6||Math.abs(this._y1-h)>1e-6)&&(this._+="L"+p+","+h),o&&(d<0&&(d=d%n+n),d>r?this._+="A"+o+","+o+",0,1,"+f+","+(e-u)+","+(i-c)+"A"+o+","+o+",0,1,"+f+","+(this._x1=p)+","+(this._y1=h):d>1e-6&&(this._+="A"+o+","+o+",0,"+ +(d>=t)+","+f+","+(this._x1=e+o*Math.cos(s))+","+(this._y1=i+o*Math.sin(s))))},rect:function(e,t,n,r){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +r+"h"+-n+"Z"},toString:function(){return this._}},e.path=o,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof n&&void 0!==t?i(n):"function"==typeof define&&define.amd?define(["exports"],i):i((r=r||self).d3=r.d3||{})},{}],28:[function(e,t,n){var r,i;r=this,i=function(){"use strict";var e=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},t=function(e,t){for(var n=Object.keys(t),r=0;r<n.length;++r)e[n[r]]=t[n[r]];return e},n="\n";function r(e){var t=new Error("(regl) "+e);throw console.error(t),t}function i(e,t){e||r(t)}function o(e){return e?": "+e:""}function a(e,t){switch(t){case"number":return"number"==typeof e;case"object":return"object"==typeof e;case"string":return"string"==typeof e;case"boolean":return"boolean"==typeof e;case"function":return"function"==typeof e;case"undefined":return void 0===e;case"symbol":return"symbol"==typeof e}}function s(e,t,n){t.indexOf(e)<0&&r("invalid value"+o(n)+". must be one of: "+t)}var l=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function u(e,t){for(e+="";e.length<t;)e=" "+e;return e}function c(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function p(e,t){this.number=e,this.line=t,this.errors=[]}function h(e,t,n){this.file=e,this.line=t,this.message=n}function f(){var e=new Error,t=(e.stack||e).toString(),n=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(t);return r?r[1]:"unknown"}function d(){var e=new Error,t=(e.stack||e).toString(),n=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(t);return r?r[1]:"unknown"}function m(e,t){var n,r=e.split("\n"),i=1,o=0,a={unknown:new c,0:new c};a.unknown.name=a[0].name=t||f(),a.unknown.lines.push(new p(0,""));for(var s=0;s<r.length;++s){var l=r[s],u=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(l);if(u)switch(u[1]){case"line":var h=/(\d+)(\s+\d+)?/.exec(u[2]);h&&(i=0|h[1],h[2]&&((o=0|h[2])in a||(a[o]=new c)));break;case"define":var d=/SHADER_NAME(_B64)?\s+(.*)$/.exec(u[2]);d&&(a[o].name=d[1]?(n=d[2],"undefined"!=typeof atob?atob(n):"base64:"+n):d[2])}a[o].lines.push(new p(i++,l))}return Object.keys(a).forEach(function(e){var t=a[e];t.lines.forEach(function(e){t.index[e.number]=e})}),a}function v(e){e._commandRef=f()}function b(e,t){var n=d();r(e+" in command "+(t||f())+("unknown"===n?"":" called from "+n))}function g(e,t,n,r){a(e,t)||b("invalid parameter type"+o(n)+". expected "+t+", got "+typeof e,r||f())}var y=33071,w=9728,_=9984,x=9985,k=9986,C=9987,E=5126,A=32819,P=32820,M=33635,S=34042,T={};function V(e,t){return e===P||e===A||e===M?2:e===S?4:T[e]*t}function j(e){return!(e&e-1||!e)}T[5120]=T[5121]=1,T[5122]=T[5123]=T[36193]=T[M]=T[A]=T[P]=2,T[5124]=T[5125]=T[E]=T[S]=4;var O=t(i,{optional:function(e){e()},raise:r,commandRaise:b,command:function(e,t,n){e||b(t,n||f())},parameter:function(e,t,n){e in t||r("unknown parameter ("+e+")"+o(n)+". possible values: "+Object.keys(t).join())},commandParameter:function(e,t,n,r){e in t||b("unknown parameter ("+e+")"+o(n)+". possible values: "+Object.keys(t).join(),r||f())},constructor:function(e){Object.keys(e).forEach(function(e){l.indexOf(e)<0&&r('invalid regl constructor argument "'+e+'". must be one of '+l)})},type:function(e,t,n){a(e,t)||r("invalid parameter type"+o(n)+". expected "+t+", got "+typeof e)},commandType:g,isTypedArray:function(t,n){e(t)||r("invalid parameter type"+o(n)+". must be a typed array")},nni:function(e,t){e>=0&&(0|e)===e||r("invalid parameter type, ("+e+")"+o(t)+". must be a nonnegative integer")},oneOf:s,shaderError:function(e,t,r,o,a){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){var s=e.getShaderInfoLog(t),l=o===e.FRAGMENT_SHADER?"fragment":"vertex";g(r,"string",l+" shader source must be a string",a);var c=m(r,a),p=function(e){var t=[];return e.split("\n").forEach(function(e){if(!(e.length<5)){var n=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(e);n?t.push(new h(0|n[1],0|n[2],n[3].trim())):e.length>0&&t.push(new h("unknown",0,e))}}),t}(s);!function(e,t){t.forEach(function(t){var n=e[t.file];if(n){var r=n.index[t.line];if(r)return r.errors.push(t),void(n.hasErrors=!0)}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(t)})}(c,p),Object.keys(c).forEach(function(e){var t=c[e];if(t.hasErrors){var r=[""],i=[""];o("file number "+e+": "+t.name+"\n","color:red;text-decoration:underline;font-weight:bold"),t.lines.forEach(function(e){if(e.errors.length>0){o(u(e.number,4)+"|  ","background-color:yellow; font-weight:bold"),o(e.line+n,"color:red; background-color:yellow; font-weight:bold");var t=0;e.errors.forEach(function(r){var i=r.message,a=/^\s*'(.*)'\s*:\s*(.*)$/.exec(i);if(a){var s=a[1];switch(i=a[2],s){case"assign":s="="}t=Math.max(e.line.indexOf(s,t),0)}else t=0;o(u("| ",6)),o(u("^^^",t+3)+n,"font-weight:bold"),o(u("| ",6)),o(i+n,"font-weight:bold")}),o(u("| ",6)+n)}else o(u(e.number,4)+"|  "),o(e.line+n,"color:red")}),"undefined"==typeof document||window.chrome?console.log(r.join("")):(i[0]=r.join("%c"),console.log.apply(console,i))}function o(e,t){r.push(e),i.push(t||"")}}),i.raise("Error compiling "+l+" shader, "+c[0].name)}},linkError:function(e,t,r,o,a){if(!e.getProgramParameter(t,e.LINK_STATUS)){var s=e.getProgramInfoLog(t),l=m(r,a),u='Error linking program with vertex shader, "'+m(o,a)[0].name+'", and fragment shader "'+l[0].name+'"';"undefined"!=typeof document?console.log("%c"+u+n+"%c"+s,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(u+n+s),i.raise(u)}},callSite:d,saveCommandRef:v,saveDrawInfo:function(e,t,n,r){function i(e){return e?r.id(e):0}function o(e,t){Object.keys(t).forEach(function(t){e[r.id(t)]=!0})}v(e),e._fragId=i(e.static.frag),e._vertId=i(e.static.vert);var a=e._uniformSet={};o(a,t.static),o(a,t.dynamic);var s=e._attributeSet={};o(s,n.static),o(s,n.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic},framebufferFormat:function(e,t,n){e.texture?s(e.texture._texture.internalformat,t,"unsupported texture format for attachment"):s(e.renderbuffer._renderbuffer.format,n,"unsupported renderbuffer format for attachment")},guessCommand:f,texture2D:function(e,t,n){var r,o=t.width,a=t.height,s=t.channels;i(o>0&&o<=n.maxTextureSize&&a>0&&a<=n.maxTextureSize,"invalid texture shape"),e.wrapS===y&&e.wrapT===y||i(j(o)&&j(a),"incompatible wrap mode for texture, both width and height must be power of 2"),1===t.mipmask?1!==o&&1!==a&&i(e.minFilter!==_&&e.minFilter!==k&&e.minFilter!==x&&e.minFilter!==C,"min filter requires mipmap"):(i(j(o)&&j(a),"texture must be a square power of 2 to support mipmapping"),i(t.mipmask===(o<<1)-1,"missing or incomplete mipmap data")),t.type===E&&(n.extensions.indexOf("oes_texture_float_linear")<0&&i(e.minFilter===w&&e.magFilter===w,"filter not supported, must enable oes_texture_float_linear"),i(!e.genMipmaps,"mipmap generation not supported with float textures"));var l=t.images;for(r=0;r<16;++r)if(l[r]){var u=o>>r,c=a>>r;i(t.mipmask&1<<r,"missing mipmap data");var p=l[r];if(i(p.width===u&&p.height===c,"invalid shape for mip images"),i(p.format===t.format&&p.internalformat===t.internalformat&&p.type===t.type,"incompatible type for mip image"),p.compressed);else if(p.data){var h=Math.ceil(V(p.type,s)*u/p.unpackAlignment)*p.unpackAlignment;i(p.data.byteLength===h*c,"invalid data for image, buffer size is inconsistent with image format")}}else e.genMipmaps||i(0==(t.mipmask&1<<r),"extra mipmap data");t.compressed&&i(!e.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(e,t,n,r){var o=e.width,a=e.height,s=e.channels;i(o>0&&o<=r.maxTextureSize&&a>0&&a<=r.maxTextureSize,"invalid texture shape"),i(o===a,"cube map must be square"),i(t.wrapS===y&&t.wrapT===y,"wrap mode not supported by cube map");for(var l=0;l<n.length;++l){var u=n[l];i(u.width===o&&u.height===a,"inconsistent cube map face shape"),t.genMipmaps&&(i(!u.compressed,"can not generate mipmap for compressed textures"),i(1===u.mipmask,"can not specify mipmaps and generate mipmaps"));for(var c=u.images,p=0;p<16;++p){var h=c[p];if(h){var f=o>>p,d=a>>p;i(u.mipmask&1<<p,"missing mipmap data"),i(h.width===f&&h.height===d,"invalid shape for mip images"),i(h.format===e.format&&h.internalformat===e.internalformat&&h.type===e.type,"incompatible type for mip image"),h.compressed||h.data&&i(h.data.byteLength===f*d*Math.max(V(h.type,s),h.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format")}}}}}),D=0,L=0,R=5,I=6;function B(e,t){this.id=D++,this.type=e,this.data=t}function F(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function z(e){return"["+function e(t){if(0===t.length)return[];var n=t.charAt(0),r=t.charAt(t.length-1);if(t.length>1&&n===r&&('"'===n||"'"===n))return['"'+F(t.substr(1,t.length-2))+'"'];var i=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(t);if(i)return e(t.substr(0,i.index)).concat(e(i[1])).concat(e(t.substr(i.index+i[0].length)));var o=t.split(".");if(1===o.length)return['"'+F(t)+'"'];for(var a=[],s=0;s<o.length;++s)a=a.concat(e(o[s]));return a}(e).join("][")+"]"}var U={DynamicVariable:B,define:function(e,t){return new B(e,z(t+""))},isDynamic:function(e){return"function"==typeof e&&!e._reglType||e instanceof B},unbox:function e(t,n){return"function"==typeof t?new B(L,t):"number"==typeof t||"boolean"==typeof t?new B(R,t):Array.isArray(t)?new B(I,t.map((t,r)=>e(t,n+"["+r+"]"))):t instanceof B?t:void O(!1,"invalid option type in uniform "+n)},accessor:z},N={next:"function"==typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:"function"==typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout},q="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function H(e){return"string"==typeof e?e.split():(O(Array.isArray(e),"invalid extension array"),e)}function K(e){return"string"==typeof e?(O("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(e)):e}function G(e){var n,r,i,o,a,s=e||{},l={},u=[],c=[],p="undefined"==typeof window?1:window.devicePixelRatio,h=!1,f=function(e){e&&O.raise(e)},d=function(){};if("string"==typeof s?(O("undefined"!=typeof document,"selector queries only supported in DOM enviroments"),n=document.querySelector(s),O(n,"invalid query string for element")):"object"==typeof s?"string"==typeof(a=s).nodeName&&"function"==typeof a.appendChild&&"function"==typeof a.getBoundingClientRect?n=s:!function(e){return"function"==typeof e.drawArrays||"function"==typeof e.drawElements}(s)?(O.constructor(s),"gl"in s?o=s.gl:"canvas"in s?i=K(s.canvas):"container"in s&&(r=K(s.container)),"attributes"in s&&O.type(l=s.attributes,"object","invalid context attributes"),"extensions"in s&&(u=H(s.extensions)),"optionalExtensions"in s&&(c=H(s.optionalExtensions)),"onDone"in s&&(O.type(s.onDone,"function","invalid or missing onDone callback"),f=s.onDone),"profile"in s&&(h=!!s.profile),"pixelRatio"in s&&O((p=+s.pixelRatio)>0,"invalid pixel ratio")):i=(o=s).canvas:O.raise("invalid arguments to regl"),n&&("canvas"===n.nodeName.toLowerCase()?i=n:r=n),!o){if(!i){O("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var m=function(e,n,r){var i,o=document.createElement("canvas");function a(){var n=window.innerWidth,i=window.innerHeight;if(e!==document.body){var a=e.getBoundingClientRect();n=a.right-a.left,i=a.bottom-a.top}o.width=r*n,o.height=r*i,t(o.style,{width:n+"px",height:i+"px"})}return t(o.style,{border:0,margin:0,padding:0,top:0,left:0}),e.appendChild(o),e===document.body&&(o.style.position="absolute",t(e.style,{margin:0,padding:0})),e!==document.body&&"function"==typeof ResizeObserver?(i=new ResizeObserver(function(){setTimeout(a)})).observe(e):window.addEventListener("resize",a,!1),a(),{canvas:o,onDestroy:function(){i?i.disconnect():window.removeEventListener("resize",a),e.removeChild(o)}}}(r||document.body,0,p);if(!m)return null;i=m.canvas,d=m.onDestroy}void 0===l.premultipliedAlpha&&(l.premultipliedAlpha=!0),o=function(e,t){function n(n){try{return e.getContext(n,t)}catch(e){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}(i,l)}return o?{gl:o,canvas:i,container:r,extensions:u,optionalExtensions:c,pixelRatio:p,profile:h,onDone:f,onDestroy:d}:(d(),f("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function $(e,t){for(var n=Array(e),r=0;r<e;++r)n[r]=t(r);return n}var W=5120,Y=5121,Q=5122,X=5123,J=5124,Z=5125,ee=5126;function te(e){var t,n;return t=(e>65535)<<4,t|=n=((e>>>=t)>255)<<3,t|=n=((e>>>=n)>15)<<2,(t|=n=((e>>>=n)>3)<<1)|(e>>>=n)>>1}function ne(){var e=$(8,function(){return[]});function t(t){var n=function(e){for(var t=16;t<=1<<28;t*=16)if(e<=t)return t;return 0}(t),r=e[te(n)>>2];return r.length>0?r.pop():new ArrayBuffer(n)}function n(t){e[te(t.byteLength)>>2].push(t)}return{alloc:t,free:n,allocType:function(e,n){var r=null;switch(e){case W:r=new Int8Array(t(n),0,n);break;case Y:r=new Uint8Array(t(n),0,n);break;case Q:r=new Int16Array(t(2*n),0,n);break;case X:r=new Uint16Array(t(2*n),0,n);break;case J:r=new Int32Array(t(4*n),0,n);break;case Z:r=new Uint32Array(t(4*n),0,n);break;case ee:r=new Float32Array(t(4*n),0,n);break;default:return null}return r.length!==n?r.subarray(0,n):r},freeType:function(e){n(e.buffer)}}}var re=ne();re.zero=ne();var ie=function(e,t){var n=1;t.ext_texture_filter_anisotropic&&(n=e.getParameter(34047));var r=1,i=1;t.webgl_draw_buffers&&(r=e.getParameter(34852),i=e.getParameter(36063));var o=!!t.oes_texture_float;if(o){var a=e.createTexture();e.bindTexture(3553,a),e.texImage2D(3553,0,6408,1,1,0,6408,5126,null);var s=e.createFramebuffer();if(e.bindFramebuffer(36160,s),e.framebufferTexture2D(36160,36064,3553,a,0),e.bindTexture(3553,null),36053!==e.checkFramebufferStatus(36160))o=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(16384);var l=re.allocType(5126,4);e.readPixels(0,0,1,1,6408,5126,l),e.getError()?o=!1:(e.deleteFramebuffer(s),e.deleteTexture(a),o=1===l[0]),re.freeType(l)}}var u=!0;if(!("undefined"!=typeof navigator&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)))){var c=e.createTexture(),p=re.allocType(5121,36);e.activeTexture(33984),e.bindTexture(34067,c),e.texImage2D(34069,0,6408,3,3,0,6408,5121,p),re.freeType(p),e.bindTexture(34067,null),e.deleteTexture(c),u=!e.getError()}return{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(t).filter(function(e){return!!t[e]}),maxAnisotropic:n,maxDrawbuffers:r,maxColorAttachments:i,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938),readFloat:o,npotTextureCube:u}};function oe(t){return!!t&&"object"==typeof t&&Array.isArray(t.shape)&&Array.isArray(t.stride)&&"number"==typeof t.offset&&t.shape.length===t.stride.length&&(Array.isArray(t.data)||e(t.data))}var ae=function(e){return Object.keys(e).map(function(t){return e[t]})},se={shape:function(e){for(var t=[],n=e;n.length;n=n[0])t.push(n.length);return t},flatten:function(e,t,n,r){var i=1;if(t.length)for(var o=0;o<t.length;++o)i*=t[o];else i=0;var a=r||re.allocType(n,i);switch(t.length){case 0:break;case 1:!function(e,t,n){for(var r=0;r<t;++r)n[r]=e[r]}(e,t[0],a);break;case 2:!function(e,t,n,r){for(var i=0,o=0;o<t;++o)for(var a=e[o],s=0;s<n;++s)r[i++]=a[s]}(e,t[0],t[1],a);break;case 3:le(e,t[0],t[1],t[2],a,0);break;default:!function e(t,n,r,i,o){var a=1;for(var s=r+1;s<n.length;++s)a*=n[s];var l=n[r];if(n.length-r==4){var u=n[r+1],c=n[r+2],p=n[r+3];for(s=0;s<l;++s)le(t[s],u,c,p,i,o),o+=a}else for(s=0;s<l;++s)e(t[s],n,r+1,i,o),o+=a}(e,t,0,a,0)}return a}};function le(e,t,n,r,i,o){for(var a=o,s=0;s<t;++s)for(var l=e[s],u=0;u<n;++u)for(var c=l[u],p=0;p<r;++p)i[a++]=c[p]}var ue={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},ce={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},pe={dynamic:35048,stream:35040,static:35044},he=se.flatten,fe=se.shape,de=35044,me=35040,ve=5121,be=5126,ge=[];function ye(e){return 0|ue[Object.prototype.toString.call(e)]}function we(e,t){for(var n=0;n<t.length;++n)e[n]=t[n]}function _e(e,t,n,r,i,o,a){for(var s=0,l=0;l<n;++l)for(var u=0;u<r;++u)e[s++]=t[i*l+o*u+a]}ge[5120]=1,ge[5122]=2,ge[5124]=4,ge[5121]=1,ge[5123]=2,ge[5125]=4,ge[5126]=4;var xe={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},ke=0,Ce=1,Ee=4,Ae=5120,Pe=5121,Me=5122,Se=5123,Te=5124,Ve=5125,je=34963,Oe=35040,De=35044,Le=new Float32Array(1),Re=new Uint32Array(Le.buffer),Ie=5123;function Be(e){for(var t=re.allocType(Ie,e.length),n=0;n<e.length;++n)if(isNaN(e[n]))t[n]=65535;else if(Infinity===e[n])t[n]=31744;else if(-Infinity===e[n])t[n]=64512;else{Le[0]=e[n];var r=Re[0],i=r>>>31<<15,o=(r<<1>>>24)-127,a=r>>13&1023;if(o<-24)t[n]=i;else if(o<-14){t[n]=i+(a+1024>>-14-o)}else t[n]=o>15?i+31744:i+(o+15<<10)+a}return t}function Fe(t){return Array.isArray(t)||e(t)}var ze=function(e){return!(e&e-1||!e)},Ue=34467,Ne=3553,qe=34067,He=34069,Ke=6408,Ge=6406,$e=6407,We=6409,Ye=6410,Qe=32854,Xe=32855,Je=36194,Ze=32819,et=32820,tt=33635,nt=34042,rt=6402,it=34041,ot=35904,at=35906,st=36193,lt=33776,ut=33777,ct=33778,pt=33779,ht=35986,ft=35987,dt=34798,mt=35840,vt=35841,bt=35842,gt=35843,yt=36196,wt=5121,_t=5123,xt=5125,kt=5126,Ct=10242,Et=10243,At=10497,Pt=33071,Mt=33648,St=10240,Tt=10241,Vt=9728,jt=9729,Ot=9984,Dt=9985,Lt=9986,Rt=9987,It=33170,Bt=4352,Ft=4353,zt=4354,Ut=34046,Nt=3317,qt=37440,Ht=37441,Kt=37443,Gt=37444,$t=33984,Wt=[Ot,Lt,Dt,Rt],Yt=[0,We,Ye,$e,Ke],Qt={};function Xt(e){return"[object "+e+"]"}Qt[We]=Qt[Ge]=Qt[rt]=1,Qt[it]=Qt[Ye]=2,Qt[$e]=Qt[ot]=3,Qt[Ke]=Qt[at]=4;var Jt=Xt("HTMLCanvasElement"),Zt=Xt("OffscreenCanvas"),en=Xt("CanvasRenderingContext2D"),tn=Xt("ImageBitmap"),nn=Xt("HTMLImageElement"),rn=Xt("HTMLVideoElement"),on=Object.keys(ue).concat([Jt,Zt,en,tn,nn,rn]),an=[];an[wt]=1,an[kt]=4,an[st]=2,an[_t]=2,an[xt]=4;var sn=[];function ln(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function un(e){return!!Array.isArray(e)&&!(0===e.length||!Fe(e[0]))}function cn(e){return Object.prototype.toString.call(e)}function pn(e){return cn(e)===Jt}function hn(e){return cn(e)===Zt}function fn(e){if(!e)return!1;var t=cn(e);return on.indexOf(t)>=0||(ln(e)||un(e)||oe(e))}function dn(e){return 0|ue[Object.prototype.toString.call(e)]}function mn(e,t){return re.allocType(e.type===st?kt:e.type,t)}function vn(e,t){e.type===st?(e.data=Be(t),re.freeType(t)):e.data=t}function bn(e,t,n,r,i,o){var a;if(a=void 0!==sn[e]?sn[e]:Qt[e]*an[t],o&&(a*=6),i){for(var s=0,l=n;l>=1;)s+=a*l*l,l/=2;return s}return a*n*r}function gn(n,r,i,o,a,s,l){var u={"don't care":Bt,"dont care":Bt,nice:zt,fast:Ft},c={repeat:At,clamp:Pt,mirror:Mt},p={nearest:Vt,linear:jt},h=t({mipmap:Rt,"nearest mipmap nearest":Ot,"linear mipmap nearest":Dt,"nearest mipmap linear":Lt,"linear mipmap linear":Rt},p),f={none:0,browser:Gt},d={uint8:wt,rgba4:Ze,rgb565:tt,"rgb5 a1":et},m={alpha:Ge,luminance:We,"luminance alpha":Ye,rgb:$e,rgba:Ke,rgba4:Qe,"rgb5 a1":Xe,rgb565:Je},v={};r.ext_srgb&&(m.srgb=ot,m.srgba=at),r.oes_texture_float&&(d.float32=d.float=kt),r.oes_texture_half_float&&(d.float16=d["half float"]=st),r.webgl_depth_texture&&(t(m,{depth:rt,"depth stencil":it}),t(d,{uint16:_t,uint32:xt,"depth stencil":nt})),r.webgl_compressed_texture_s3tc&&t(v,{"rgb s3tc dxt1":lt,"rgba s3tc dxt1":ut,"rgba s3tc dxt3":ct,"rgba s3tc dxt5":pt}),r.webgl_compressed_texture_atc&&t(v,{"rgb atc":ht,"rgba atc explicit alpha":ft,"rgba atc interpolated alpha":dt}),r.webgl_compressed_texture_pvrtc&&t(v,{"rgb pvrtc 4bppv1":mt,"rgb pvrtc 2bppv1":vt,"rgba pvrtc 4bppv1":bt,"rgba pvrtc 2bppv1":gt}),r.webgl_compressed_texture_etc1&&(v["rgb etc1"]=yt);var b=Array.prototype.slice.call(n.getParameter(Ue));Object.keys(v).forEach(function(e){var t=v[e];b.indexOf(t)>=0&&(m[e]=t)});var g=Object.keys(m);i.textureFormats=g;var y=[];Object.keys(m).forEach(function(e){y[m[e]]=e});var w=[];Object.keys(d).forEach(function(e){w[d[e]]=e});var _=[];Object.keys(p).forEach(function(e){_[p[e]]=e});var x=[];Object.keys(h).forEach(function(e){x[h[e]]=e});var k=[];Object.keys(c).forEach(function(e){k[c[e]]=e});var C=g.reduce(function(e,t){var n=m[t];return e[n]=n===We||n===Ge||n===We||n===Ye||n===rt||n===it||r.ext_srgb&&(n===ot||n===at)?n:n===Xe||t.indexOf("rgba")>=0?Ke:$e,e},{});function E(){this.internalformat=Ke,this.format=Ke,this.type=wt,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Gt,this.width=0,this.height=0,this.channels=0}function A(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function P(e,t){if("object"==typeof t&&t){if("premultiplyAlpha"in t&&(O.type(t.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),e.premultiplyAlpha=t.premultiplyAlpha),"flipY"in t&&(O.type(t.flipY,"boolean","invalid texture flip"),e.flipY=t.flipY),"alignment"in t&&(O.oneOf(t.alignment,[1,2,4,8],"invalid texture unpack alignment"),e.unpackAlignment=t.alignment),"colorSpace"in t&&(O.parameter(t.colorSpace,f,"invalid colorSpace"),e.colorSpace=f[t.colorSpace]),"type"in t){var n=t.type;O(r.oes_texture_float||!("float"===n||"float32"===n),"you must enable the OES_texture_float extension in order to use floating point textures."),O(r.oes_texture_half_float||!("half float"===n||"float16"===n),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),O(r.webgl_depth_texture||!("uint16"===n||"uint32"===n||"depth stencil"===n),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),O.parameter(n,d,"invalid texture type"),e.type=d[n]}var o=e.width,a=e.height,s=e.channels,l=!1;"shape"in t?(O(Array.isArray(t.shape)&&t.shape.length>=2,"shape must be an array"),o=t.shape[0],a=t.shape[1],3===t.shape.length&&(O((s=t.shape[2])>0&&s<=4,"invalid number of channels"),l=!0),O(o>=0&&o<=i.maxTextureSize,"invalid width"),O(a>=0&&a<=i.maxTextureSize,"invalid height")):("radius"in t&&(o=a=t.radius,O(o>=0&&o<=i.maxTextureSize,"invalid radius")),"width"in t&&O((o=t.width)>=0&&o<=i.maxTextureSize,"invalid width"),"height"in t&&O((a=t.height)>=0&&a<=i.maxTextureSize,"invalid height"),"channels"in t&&(O((s=t.channels)>0&&s<=4,"invalid number of channels"),l=!0)),e.width=0|o,e.height=0|a,e.channels=0|s;var u=!1;if("format"in t){var c=t.format;O(r.webgl_depth_texture||!("depth"===c||"depth stencil"===c),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),O.parameter(c,m,"invalid texture format");var p=e.internalformat=m[c];e.format=C[p],c in d&&("type"in t||(e.type=d[c])),c in v&&(e.compressed=!0),u=!0}!l&&u?e.channels=Qt[e.format]:l&&!u?e.channels!==Yt[e.format]&&(e.format=e.internalformat=Yt[e.channels]):u&&l&&O(e.channels===Qt[e.format],"number of channels inconsistent with specified format")}}function M(e){n.pixelStorei(qt,e.flipY),n.pixelStorei(Ht,e.premultiplyAlpha),n.pixelStorei(Kt,e.colorSpace),n.pixelStorei(Nt,e.unpackAlignment)}function S(){E.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function T(t,n){var r=null;if(fn(n)?r=n:n&&(O.type(n,"object","invalid pixel data type"),P(t,n),"x"in n&&(t.xOffset=0|n.x),"y"in n&&(t.yOffset=0|n.y),fn(n.data)&&(r=n.data)),O(!t.compressed||r instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),n.copy){O(!r,"can not specify copy and data field for the same texture");var o=a.viewportWidth,s=a.viewportHeight;t.width=t.width||o-t.xOffset,t.height=t.height||s-t.yOffset,t.needsCopy=!0,O(t.xOffset>=0&&t.xOffset<o&&t.yOffset>=0&&t.yOffset<s&&t.width>0&&t.width<=o&&t.height>0&&t.height<=s,"copy texture read out of bounds")}else if(r){if(e(r))t.channels=t.channels||4,t.data=r,"type"in n||t.type!==wt||(t.type=dn(r));else if(ln(r))t.channels=t.channels||4,function(e,t){var n=t.length;switch(e.type){case wt:case _t:case xt:case kt:var r=re.allocType(e.type,n);r.set(t),e.data=r;break;case st:e.data=Be(t);break;default:O.raise("unsupported texture type, must specify a typed array")}}(t,r),t.alignment=1,t.needsFree=!0;else if(oe(r)){var l=r.data;Array.isArray(l)||t.type!==wt||(t.type=dn(l));var u,c,p,h,f,d,m=r.shape,v=r.stride;3===m.length?(p=m[2],d=v[2]):(O(2===m.length,"invalid ndarray pixel data, must be 2 or 3D"),p=1,d=1),u=m[0],c=m[1],h=v[0],f=v[1],t.alignment=1,t.width=u,t.height=c,t.channels=p,t.format=t.internalformat=Yt[p],t.needsFree=!0,function(e,t,n,r,i,o){for(var a=e.width,s=e.height,l=e.channels,u=mn(e,a*s*l),c=0,p=0;p<s;++p)for(var h=0;h<a;++h)for(var f=0;f<l;++f)u[c++]=t[n*h+r*p+i*f+o];vn(e,u)}(t,l,h,f,d,r.offset)}else if(pn(r)||hn(r)||cn(r)===en)t.element=pn(r)||hn(r)?r:r.canvas,t.width=t.element.width,t.height=t.element.height,t.channels=4;else if(function(e){return cn(e)===tn}(r))t.element=r,t.width=r.width,t.height=r.height,t.channels=4;else if(function(e){return cn(e)===nn}(r))t.element=r,t.width=r.naturalWidth,t.height=r.naturalHeight,t.channels=4;else if(function(e){return cn(e)===rn}(r))t.element=r,t.width=r.videoWidth,t.height=r.videoHeight,t.channels=4;else if(un(r)){var b=t.width||r[0].length,g=t.height||r.length,y=t.channels;y=Fe(r[0][0])?y||r[0][0].length:y||1;for(var w=se.shape(r),_=1,x=0;x<w.length;++x)_*=w[x];var k=mn(t,_);se.flatten(r,w,"",k),vn(t,k),t.alignment=1,t.width=b,t.height=g,t.channels=y,t.format=t.internalformat=Yt[y],t.needsFree=!0}}else t.width=t.width||1,t.height=t.height||1,t.channels=t.channels||4;t.type===kt?O(i.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):t.type===st&&O(i.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function V(e,t,r){var i=e.element,a=e.data,s=e.internalformat,l=e.format,u=e.type,c=e.width,p=e.height;M(e),i?n.texImage2D(t,r,l,l,u,i):e.compressed?n.compressedTexImage2D(t,r,s,c,p,0,a):e.needsCopy?(o(),n.copyTexImage2D(t,r,l,e.xOffset,e.yOffset,c,p,0)):n.texImage2D(t,r,l,c,p,0,l,u,a||null)}function j(e,t,r,i,a){var s=e.element,l=e.data,u=e.internalformat,c=e.format,p=e.type,h=e.width,f=e.height;M(e),s?n.texSubImage2D(t,a,r,i,c,p,s):e.compressed?n.compressedTexSubImage2D(t,a,r,i,u,h,f,l):e.needsCopy?(o(),n.copyTexSubImage2D(t,a,r,i,e.xOffset,e.yOffset,h,f)):n.texSubImage2D(t,a,r,i,h,f,c,p,l)}var D=[];function L(){return D.pop()||new S}function R(e){e.needsFree&&re.freeType(e.data),S.call(e),D.push(e)}function I(){E.call(this),this.genMipmaps=!1,this.mipmapHint=Bt,this.mipmask=0,this.images=Array(16)}function B(e,t,n){var r=e.images[0]=L();e.mipmask=1,r.width=e.width=t,r.height=e.height=n,r.channels=e.channels=4}function F(e,t){var n=null;if(fn(t))A(n=e.images[0]=L(),e),T(n,t),e.mipmask=1;else if(P(e,t),Array.isArray(t.mipmap))for(var r=t.mipmap,i=0;i<r.length;++i)A(n=e.images[i]=L(),e),n.width>>=i,n.height>>=i,T(n,r[i]),e.mipmask|=1<<i;else A(n=e.images[0]=L(),e),T(n,t),e.mipmask=1;A(e,e.images[0]),!e.compressed||e.internalformat!==lt&&e.internalformat!==ut&&e.internalformat!==ct&&e.internalformat!==pt||O(e.width%4==0&&e.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function z(e,t){for(var n=e.images,r=0;r<n.length;++r){if(!n[r])return;V(n[r],t,r)}}var U=[];function N(){var e=U.pop()||new I;E.call(e),e.mipmask=0;for(var t=0;t<16;++t)e.images[t]=null;return e}function q(e){for(var t=e.images,n=0;n<t.length;++n)t[n]&&R(t[n]),t[n]=null;U.push(e)}function H(){this.minFilter=Vt,this.magFilter=Vt,this.wrapS=Pt,this.wrapT=Pt,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Bt}function K(e,t){if("min"in t){var n=t.min;O.parameter(n,h),e.minFilter=h[n],Wt.indexOf(e.minFilter)>=0&&!("faces"in t)&&(e.genMipmaps=!0)}if("mag"in t){var r=t.mag;O.parameter(r,p),e.magFilter=p[r]}var o=e.wrapS,a=e.wrapT;if("wrap"in t){var s=t.wrap;"string"==typeof s?(O.parameter(s,c),o=a=c[s]):Array.isArray(s)&&(O.parameter(s[0],c),O.parameter(s[1],c),o=c[s[0]],a=c[s[1]])}else{if("wrapS"in t){var l=t.wrapS;O.parameter(l,c),o=c[l]}if("wrapT"in t){var f=t.wrapT;O.parameter(f,c),a=c[f]}}if(e.wrapS=o,e.wrapT=a,"anisotropic"in t){var d=t.anisotropic;O("number"==typeof d&&d>=1&&d<=i.maxAnisotropic,"aniso samples must be between 1 and "),e.anisotropic=t.anisotropic}if("mipmap"in t){var m=!1;switch(typeof t.mipmap){case"string":O.parameter(t.mipmap,u,"invalid mipmap hint"),e.mipmapHint=u[t.mipmap],e.genMipmaps=!0,m=!0;break;case"boolean":m=e.genMipmaps=t.mipmap;break;case"object":O(Array.isArray(t.mipmap),"invalid mipmap type"),e.genMipmaps=!1,m=!0;break;default:O.raise("invalid mipmap type")}!m||"min"in t||(e.minFilter=Ot)}}function G(e,t){n.texParameteri(t,Tt,e.minFilter),n.texParameteri(t,St,e.magFilter),n.texParameteri(t,Ct,e.wrapS),n.texParameteri(t,Et,e.wrapT),r.ext_texture_filter_anisotropic&&n.texParameteri(t,Ut,e.anisotropic),e.genMipmaps&&(n.hint(It,e.mipmapHint),n.generateMipmap(t))}var $=0,W={},Y=i.maxTextureUnits,Q=Array(Y).map(function(){return null});function X(e){E.call(this),this.mipmask=0,this.internalformat=Ke,this.id=$++,this.refCount=1,this.target=e,this.texture=n.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new H,l.profile&&(this.stats={size:0})}function J(e){n.activeTexture($t),n.bindTexture(e.target,e.texture)}function Z(){var e=Q[0];e?n.bindTexture(e.target,e.texture):n.bindTexture(Ne,null)}function ee(e){var t=e.texture;O(t,"must not double destroy texture");var r=e.unit,i=e.target;r>=0&&(n.activeTexture($t+r),n.bindTexture(i,null),Q[r]=null),n.deleteTexture(t),e.texture=null,e.params=null,e.pixels=null,e.refCount=0,delete W[e.id],s.textureCount--}return t(X.prototype,{bind:function(){this.bindCount+=1;var e=this.unit;if(e<0){for(var t=0;t<Y;++t){var r=Q[t];if(r){if(r.bindCount>0)continue;r.unit=-1}Q[t]=this,e=t;break}e>=Y&&O.raise("insufficient number of texture units"),l.profile&&s.maxTextureUnits<e+1&&(s.maxTextureUnits=e+1),this.unit=e,n.activeTexture($t+e),n.bindTexture(this.target,this.texture)}return e},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&ee(this)}}),l.profile&&(s.getTotalTextureSize=function(){var e=0;return Object.keys(W).forEach(function(t){e+=W[t].stats.size}),e}),{create2D:function(e,t){var r=new X(Ne);function o(e,t){var n=r.texInfo;H.call(n);var a=N();return"number"==typeof e?B(a,0|e,"number"==typeof t?0|t:0|e):e?(O.type(e,"object","invalid arguments to regl.texture"),K(n,e),F(a,e)):B(a,1,1),n.genMipmaps&&(a.mipmask=(a.width<<1)-1),r.mipmask=a.mipmask,A(r,a),O.texture2D(n,a,i),r.internalformat=a.internalformat,o.width=a.width,o.height=a.height,J(r),z(a,Ne),G(n,Ne),Z(),q(a),l.profile&&(r.stats.size=bn(r.internalformat,r.type,a.width,a.height,n.genMipmaps,!1)),o.format=y[r.internalformat],o.type=w[r.type],o.mag=_[n.magFilter],o.min=x[n.minFilter],o.wrapS=k[n.wrapS],o.wrapT=k[n.wrapT],o}return W[r.id]=r,s.textureCount++,o(e,t),o.subimage=function(e,t,n,i){O(!!e,"must specify image data");var a=0|t,s=0|n,l=0|i,u=L();return A(u,r),u.width=0,u.height=0,T(u,e),u.width=u.width||(r.width>>l)-a,u.height=u.height||(r.height>>l)-s,O(r.type===u.type&&r.format===u.format&&r.internalformat===u.internalformat,"incompatible format for texture.subimage"),O(a>=0&&s>=0&&a+u.width<=r.width&&s+u.height<=r.height,"texture.subimage write out of bounds"),O(r.mipmask&1<<l,"missing mipmap data"),O(u.data||u.element||u.needsCopy,"missing image data"),J(r),j(u,Ne,a,s,l),Z(),R(u),o},o.resize=function(e,t){var i=0|e,a=0|t||i;if(i===r.width&&a===r.height)return o;o.width=r.width=i,o.height=r.height=a,J(r);for(var s=0;r.mipmask>>s;++s){var u=i>>s,c=a>>s;if(!u||!c)break;n.texImage2D(Ne,s,r.format,u,c,0,r.format,r.type,null)}return Z(),l.profile&&(r.stats.size=bn(r.internalformat,r.type,i,a,!1,!1)),o},o._reglType="texture2d",o._texture=r,l.profile&&(o.stats=r.stats),o.destroy=function(){r.decRef()},o},createCube:function(e,t,r,o,a,u){var c=new X(qe);W[c.id]=c,s.cubeCount++;var p=new Array(6);function h(e,t,n,r,o,a){var s,u=c.texInfo;for(H.call(u),s=0;s<6;++s)p[s]=N();if("number"!=typeof e&&e)if("object"==typeof e)if(t)F(p[0],e),F(p[1],t),F(p[2],n),F(p[3],r),F(p[4],o),F(p[5],a);else if(K(u,e),P(c,e),"faces"in e){var f=e.faces;for(O(Array.isArray(f)&&6===f.length,"cube faces must be a length 6 array"),s=0;s<6;++s)O("object"==typeof f[s]&&!!f[s],"invalid input for cube map face"),A(p[s],c),F(p[s],f[s])}else for(s=0;s<6;++s)F(p[s],e);else O.raise("invalid arguments to cube map");else{var d=0|e||1;for(s=0;s<6;++s)B(p[s],d,d)}for(A(c,p[0]),i.npotTextureCube||O(ze(c.width)&&ze(c.height),"your browser does not support non power or two texture dimensions"),c.mipmask=u.genMipmaps?(p[0].width<<1)-1:p[0].mipmask,O.textureCube(c,u,p,i),c.internalformat=p[0].internalformat,h.width=p[0].width,h.height=p[0].height,J(c),s=0;s<6;++s)z(p[s],He+s);for(G(u,qe),Z(),l.profile&&(c.stats.size=bn(c.internalformat,c.type,h.width,h.height,u.genMipmaps,!0)),h.format=y[c.internalformat],h.type=w[c.type],h.mag=_[u.magFilter],h.min=x[u.minFilter],h.wrapS=k[u.wrapS],h.wrapT=k[u.wrapT],s=0;s<6;++s)q(p[s]);return h}return h(e,t,r,o,a,u),h.subimage=function(e,t,n,r,i){O(!!t,"must specify image data"),O("number"==typeof e&&e===(0|e)&&e>=0&&e<6,"invalid face");var o=0|n,a=0|r,s=0|i,l=L();return A(l,c),l.width=0,l.height=0,T(l,t),l.width=l.width||(c.width>>s)-o,l.height=l.height||(c.height>>s)-a,O(c.type===l.type&&c.format===l.format&&c.internalformat===l.internalformat,"incompatible format for texture.subimage"),O(o>=0&&a>=0&&o+l.width<=c.width&&a+l.height<=c.height,"texture.subimage write out of bounds"),O(c.mipmask&1<<s,"missing mipmap data"),O(l.data||l.element||l.needsCopy,"missing image data"),J(c),j(l,He+e,o,a,s),Z(),R(l),h},h.resize=function(e){var t=0|e;if(t!==c.width){h.width=c.width=t,h.height=c.height=t,J(c);for(var r=0;r<6;++r)for(var i=0;c.mipmask>>i;++i)n.texImage2D(He+r,i,c.format,t>>i,t>>i,0,c.format,c.type,null);return Z(),l.profile&&(c.stats.size=bn(c.internalformat,c.type,h.width,h.height,!1,!0)),h}},h._reglType="textureCube",h._texture=c,l.profile&&(h.stats=c.stats),h.destroy=function(){c.decRef()},h},clear:function(){for(var e=0;e<Y;++e)n.activeTexture($t+e),n.bindTexture(Ne,null),Q[e]=null;ae(W).forEach(ee),s.cubeCount=0,s.textureCount=0},getTexture:function(e){return null},restore:function(){for(var e=0;e<Y;++e){var t=Q[e];t&&(t.bindCount=0,t.unit=-1,Q[e]=null)}ae(W).forEach(function(e){e.texture=n.createTexture(),n.bindTexture(e.target,e.texture);for(var t=0;t<32;++t)if(0!=(e.mipmask&1<<t))if(e.target===Ne)n.texImage2D(Ne,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);else for(var r=0;r<6;++r)n.texImage2D(He+r,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);G(e.texInfo,e.target)})},refresh:function(){for(var e=0;e<Y;++e){var t=Q[e];t&&(t.bindCount=0,t.unit=-1,Q[e]=null),n.activeTexture($t+e),n.bindTexture(Ne,null),n.bindTexture(qe,null)}}}}sn[Qe]=2,sn[Xe]=2,sn[Je]=2,sn[it]=4,sn[lt]=.5,sn[ut]=.5,sn[ct]=1,sn[pt]=1,sn[ht]=.5,sn[ft]=1,sn[dt]=1,sn[mt]=.5,sn[vt]=.25,sn[bt]=.5,sn[gt]=.25,sn[yt]=.5;var yn=36161,wn=32854,_n=[];function xn(e,t,n){return _n[e]*t*n}_n[wn]=2,_n[32855]=2,_n[36194]=2,_n[33189]=2,_n[36168]=1,_n[34041]=4,_n[35907]=4,_n[34836]=16,_n[34842]=8,_n[34843]=6;var kn=function(e,t,n,r,i){var o={rgba4:wn,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};t.ext_srgb&&(o.srgba=35907),t.ext_color_buffer_half_float&&(o.rgba16f=34842,o.rgb16f=34843),t.webgl_color_buffer_float&&(o.rgba32f=34836);var a=[];Object.keys(o).forEach(function(e){a[o[e]]=e});var s=0,l={};function u(e){this.id=s++,this.refCount=1,this.renderbuffer=e,this.format=wn,this.width=0,this.height=0,i.profile&&(this.stats={size:0})}function c(t){var n=t.renderbuffer;O(n,"must not double destroy renderbuffer"),e.bindRenderbuffer(yn,null),e.deleteRenderbuffer(n),t.renderbuffer=null,t.refCount=0,delete l[t.id],r.renderbufferCount--}return u.prototype.decRef=function(){--this.refCount<=0&&c(this)},i.profile&&(r.getTotalRenderbufferSize=function(){var e=0;return Object.keys(l).forEach(function(t){e+=l[t].stats.size}),e}),{create:function(t,s){var c=new u(e.createRenderbuffer());function p(t,r){var s=0,l=0,u=wn;if("object"==typeof t&&t){var h=t;if("shape"in h){var f=h.shape;O(Array.isArray(f)&&f.length>=2,"invalid renderbuffer shape"),s=0|f[0],l=0|f[1]}else"radius"in h&&(s=l=0|h.radius),"width"in h&&(s=0|h.width),"height"in h&&(l=0|h.height);"format"in h&&(O.parameter(h.format,o,"invalid renderbuffer format"),u=o[h.format])}else"number"==typeof t?(s=0|t,l="number"==typeof r?0|r:s):t?O.raise("invalid arguments to renderbuffer constructor"):s=l=1;if(O(s>0&&l>0&&s<=n.maxRenderbufferSize&&l<=n.maxRenderbufferSize,"invalid renderbuffer size"),s!==c.width||l!==c.height||u!==c.format)return p.width=c.width=s,p.height=c.height=l,c.format=u,e.bindRenderbuffer(yn,c.renderbuffer),e.renderbufferStorage(yn,u,s,l),O(0===e.getError(),"invalid render buffer format"),i.profile&&(c.stats.size=xn(c.format,c.width,c.height)),p.format=a[c.format],p}return l[c.id]=c,r.renderbufferCount++,p(t,s),p.resize=function(t,r){var o=0|t,a=0|r||o;return o===c.width&&a===c.height?p:(O(o>0&&a>0&&o<=n.maxRenderbufferSize&&a<=n.maxRenderbufferSize,"invalid renderbuffer size"),p.width=c.width=o,p.height=c.height=a,e.bindRenderbuffer(yn,c.renderbuffer),e.renderbufferStorage(yn,c.format,o,a),O(0===e.getError(),"invalid render buffer format"),i.profile&&(c.stats.size=xn(c.format,c.width,c.height)),p)},p._reglType="renderbuffer",p._renderbuffer=c,i.profile&&(p.stats=c.stats),p.destroy=function(){c.decRef()},p},clear:function(){ae(l).forEach(c)},restore:function(){ae(l).forEach(function(t){t.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(yn,t.renderbuffer),e.renderbufferStorage(yn,t.format,t.width,t.height)}),e.bindRenderbuffer(yn,null)}}},Cn=36160,En=36161,An=3553,Pn=34069,Mn=36064,Sn=36096,Tn=36128,Vn=33306,jn=36053,On=6402,Dn=[6407,6408],Ln=[];Ln[6408]=4,Ln[6407]=3;var Rn=[];Rn[5121]=1,Rn[5126]=4,Rn[36193]=2;var In=33189,Bn=36168,Fn=34041,zn=[32854,32855,36194,35907,34842,34843,34836],Un={};Un[jn]="complete",Un[36054]="incomplete attachment",Un[36057]="incomplete dimensions",Un[36055]="incomplete, missing attachment",Un[36061]="unsupported";var Nn=5126,qn=34962;function Hn(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Nn,this.offset=0,this.stride=0,this.divisor=0}var Kn=35632,Gn=35633,$n=35718,Wn=35721,Yn=6408,Qn=5121,Xn=3333,Jn=5126;function Zn(t,n,r,i,o,a,s){function l(l){var u;null===n.next?(O(o.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),u=Qn):(O(null!==n.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),u=n.next.colorAttachments[0].texture._texture.type,a.oes_texture_float?(O(u===Qn||u===Jn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),u===Jn&&O(s.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):O(u===Qn,"Reading from a framebuffer is only allowed for the type 'uint8'"));var c=0,p=0,h=i.framebufferWidth,f=i.framebufferHeight,d=null;e(l)?d=l:l&&(O.type(l,"object","invalid arguments to regl.read()"),p=0|l.y,O((c=0|l.x)>=0&&c<i.framebufferWidth,"invalid x offset for regl.read"),O(p>=0&&p<i.framebufferHeight,"invalid y offset for regl.read"),h=0|(l.width||i.framebufferWidth-c),f=0|(l.height||i.framebufferHeight-p),d=l.data||null),d&&(u===Qn?O(d instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):u===Jn&&O(d instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),O(h>0&&h+c<=i.framebufferWidth,"invalid width for read pixels"),O(f>0&&f+p<=i.framebufferHeight,"invalid height for read pixels"),r();var m=h*f*4;return d||(u===Qn?d=new Uint8Array(m):u===Jn&&(d=d||new Float32Array(m))),O.isTypedArray(d,"data buffer for regl.read() must be a typedarray"),O(d.byteLength>=m,"data buffer for regl.read() too small"),t.pixelStorei(Xn,4),t.readPixels(c,p,h,f,Yn,u,d),d}return function(e){return e&&"framebuffer"in e?function(e){var t;return n.setFBO({framebuffer:e.framebuffer},function(){t=l(e)}),t}(e):l(e)}}function er(e){return Array.prototype.slice.call(e)}function tr(e){return er(e).join("")}var nr="xyzw".split(""),rr=5121,ir=1,or=2,ar=0,sr=1,lr=2,ur=3,cr=4,pr=5,hr=6,fr="dither",dr="blend.enable",mr="blend.color",vr="blend.equation",br="blend.func",gr="depth.enable",yr="depth.func",wr="depth.range",_r="depth.mask",xr="colorMask",kr="cull.enable",Cr="cull.face",Er="frontFace",Ar="lineWidth",Pr="polygonOffset.enable",Mr="polygonOffset.offset",Sr="sample.alpha",Tr="sample.enable",Vr="sample.coverage",jr="stencil.enable",Or="stencil.mask",Dr="stencil.func",Lr="stencil.opFront",Rr="stencil.opBack",Ir="scissor.enable",Br="scissor.box",Fr="viewport",zr="profile",Ur="framebuffer",Nr="vert",qr="frag",Hr="elements",Kr="primitive",Gr="count",$r="offset",Wr="instances",Yr="vao",Qr=Ur+"Width",Xr=Ur+"Height",Jr=Fr+"Width",Zr=Fr+"Height",ei="drawingBufferWidth",ti="drawingBufferHeight",ni=[br,vr,Dr,Lr,Rr,Vr,Fr,Br,Mr],ri=34962,ii=34963,oi=3553,ai=34067,si=2884,li=3042,ui=3024,ci=2960,pi=2929,hi=3089,fi=32823,di=32926,mi=32928,vi=5126,bi=35664,gi=35665,yi=35666,wi=5124,_i=35667,xi=35668,ki=35669,Ci=35670,Ei=35671,Ai=35672,Pi=35673,Mi=35674,Si=35675,Ti=35676,Vi=35678,ji=35680,Oi=4,Di=1028,Li=1029,Ri=2304,Ii=2305,Bi=32775,Fi=32776,zi=519,Ui=7680,Ni=0,qi=1,Hi=32774,Ki=513,Gi=36160,$i=36064,Wi={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Yi=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Qi={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Xi={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Ji={frag:35632,vert:35633},Zi={cw:Ri,ccw:Ii};function eo(t){return Array.isArray(t)||e(t)||oe(t)}function to(e){return e.sort(function(e,t){return e===Fr?-1:t===Fr?1:e<t?-1:1})}function no(e,t,n,r){this.thisDep=e,this.contextDep=t,this.propDep=n,this.append=r}function ro(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function io(e){return new no(!1,!1,!1,e)}function oo(e,t){var n=e.type;if(n===ar){var r=e.data.length;return new no(!0,r>=1,r>=2,t)}if(n===cr){var i=e.data;return new no(i.thisDep,i.contextDep,i.propDep,t)}if(n===pr)return new no(!1,!1,!1,t);if(n===hr){for(var o=!1,a=!1,s=!1,l=0;l<e.data.length;++l){var u=e.data[l];if(u.type===sr)s=!0;else if(u.type===lr)a=!0;else if(u.type===ur)o=!0;else if(u.type===ar){o=!0;var c=u.data;c>=1&&(a=!0),c>=2&&(s=!0)}else u.type===cr&&(o=o||u.data.thisDep,a=a||u.data.contextDep,s=s||u.data.propDep)}return new no(o,a,s,t)}return new no(n===ur,n===lr,n===sr,t)}var ao=new no(!1,!1,!1,function(){});function so(e,n,r,i,o,a,s,l,u,c,p,h,f,d,m){var v=c.Record,b={add:32774,subtract:32778,"reverse subtract":32779};r.ext_blend_minmax&&(b.min=Bi,b.max=Fi);var g=r.angle_instanced_arrays,y=r.webgl_draw_buffers,w={dirty:!0,profile:m.profile},_={},x=[],k={},C={};function E(e){return e.replace(".","_")}function A(e,t,n){var r=E(e);x.push(e),_[r]=w[r]=!!n,k[r]=t}function P(e,t,n){var r=E(e);x.push(e),Array.isArray(n)?(w[r]=n.slice(),_[r]=n.slice()):w[r]=_[r]=n,C[r]=t}A(fr,ui),A(dr,li),P(mr,"blendColor",[0,0,0,0]),P(vr,"blendEquationSeparate",[Hi,Hi]),P(br,"blendFuncSeparate",[qi,Ni,qi,Ni]),A(gr,pi,!0),P(yr,"depthFunc",Ki),P(wr,"depthRange",[0,1]),P(_r,"depthMask",!0),P(xr,xr,[!0,!0,!0,!0]),A(kr,si),P(Cr,"cullFace",Li),P(Er,Er,Ii),P(Ar,Ar,1),A(Pr,fi),P(Mr,"polygonOffset",[0,0]),A(Sr,di),A(Tr,mi),P(Vr,"sampleCoverage",[1,!1]),A(jr,ci),P(Or,"stencilMask",-1),P(Dr,"stencilFunc",[zi,0,-1]),P(Lr,"stencilOpSeparate",[Di,Ui,Ui,Ui]),P(Rr,"stencilOpSeparate",[Li,Ui,Ui,Ui]),A(Ir,hi),P(Br,"scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),P(Fr,Fr,[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var M={gl:e,context:f,strings:n,next:_,current:w,draw:h,elements:a,buffer:o,shader:p,attributes:c.state,vao:c,uniforms:u,framebuffer:l,extensions:r,timer:d,isBufferArgs:eo},S={primTypes:xe,compareFuncs:Qi,blendFuncs:Wi,blendEquations:b,stencilOps:Xi,glTypes:ce,orientationType:Zi};O.optional(function(){M.isArrayLike=Fe}),y&&(S.backBuffer=[Li],S.drawBuffer=$(i.maxDrawbuffers,function(e){return 0===e?[0]:$(e,function(e){return $i+e})}));var T=0;function V(){var e=function(){var e=0,n=[],r=[];function i(){var n=[],r=[];return t(function(){n.push.apply(n,er(arguments))},{def:function(){var t="v"+e++;return r.push(t),arguments.length>0&&(n.push(t,"="),n.push.apply(n,er(arguments)),n.push(";")),t},toString:function(){return tr([r.length>0?"var "+r.join(",")+";":"",tr(n)])}})}function o(){var e=i(),n=i(),r=e.toString,o=n.toString;function a(t,r){n(t,r,"=",e.def(t,r),";")}return t(function(){e.apply(e,er(arguments))},{def:e.def,entry:e,exit:n,save:a,set:function(t,n,r){a(t,n),e(t,n,"=",r,";")},toString:function(){return r()+o()}})}var a=i(),s={};return{global:a,link:function(t){for(var i=0;i<r.length;++i)if(r[i]===t)return n[i];var o="g"+e++;return n.push(o),r.push(t),o},block:i,proc:function(e,n){var r=[];function i(){var e="a"+r.length;return r.push(e),e}n=n||0;for(var a=0;a<n;++a)i();var l=o(),u=l.toString;return s[e]=t(l,{arg:i,toString:function(){return tr(["function(",r.join(),"){",u(),"}"])}})},scope:o,cond:function(){var e=tr(arguments),n=o(),r=o(),i=n.toString,a=r.toString;return t(n,{then:function(){return n.apply(n,er(arguments)),this},else:function(){return r.apply(r,er(arguments)),this},toString:function(){var t=a();return t&&(t="else{"+t+"}"),tr(["if(",e,"){",i(),"}",t])}})},compile:function(){var e=['"use strict";',a,"return {"];Object.keys(s).forEach(function(t){e.push('"',t,'":',s[t].toString(),",")}),e.push("}");var t=tr(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,n.concat(t)).apply(null,r)}}}(),r=e.link,i=e.global;e.id=T++,e.batchId="0";var o=r(M),a=e.shared={props:"a0"};Object.keys(M).forEach(function(e){a[e]=i.def(o,".",e)}),O.optional(function(){e.CHECK=r(O),e.commandStr=O.guessCommand(),e.command=r(e.commandStr),e.assert=function(e,t,n){e("if(!(",t,"))",this.CHECK,".commandRaise(",r(n),",",this.command,");")},S.invalidBlendCombinations=Yi});var s=e.next={},l=e.current={};Object.keys(C).forEach(function(e){Array.isArray(w[e])&&(s[e]=i.def(a.next,".",e),l[e]=i.def(a.current,".",e))});var u=e.constants={};Object.keys(S).forEach(function(e){u[e]=i.def(JSON.stringify(S[e]))}),e.invoke=function(t,n){switch(n.type){case ar:var i=["this",a.context,a.props,e.batchId];return t.def(r(n.data),".call(",i.slice(0,Math.max(n.data.length+1,4)),")");case sr:return t.def(a.props,n.data);case lr:return t.def(a.context,n.data);case ur:return t.def("this",n.data);case cr:return n.data.append(e,t),n.data.ref;case pr:return n.data.toString();case hr:return n.data.map(function(n){return e.invoke(t,n)})}},e.attribCache={};var p={};return e.scopeAttrib=function(e){var t=n.id(e);if(t in p)return p[t];var i=c.scope[t];return i||(i=c.scope[t]=new v),p[t]=r(i)},e}function j(e,t,s,u,h){var f=e.static,d=e.dynamic;O.optional(function(){var e=[Ur,Nr,qr,Hr,Kr,$r,Gr,Wr,zr,Yr].concat(x);function t(t){Object.keys(t).forEach(function(t){O.command(e.indexOf(t)>=0,'unknown parameter "'+t+'"',h.commandStr)})}t(f),t(d)});var m=function(e,t){var n=e.static;if("string"==typeof n[qr]&&"string"==typeof n[Nr]){if(Object.keys(t.dynamic).length>0)return null;var r=t.static,i=Object.keys(r);if(i.length>0&&"number"==typeof r[i[0]]){for(var o=[],a=0;a<i.length;++a)O("number"==typeof r[i[a]],"must specify all vertex attribute locations when using vaos"),o.push([0|r[i[a]],i[a]]);return o}}return null}(e,t),y=function(e,t){var n=e.static,r=e.dynamic;if(Ur in n){var i=n[Ur];return i?(i=l.getFramebuffer(i),O.command(i,"invalid framebuffer object"),io(function(e,t){var n=e.link(i),r=e.shared;t.set(r.framebuffer,".next",n);var o=r.context;return t.set(o,"."+Qr,n+".width"),t.set(o,"."+Xr,n+".height"),n})):io(function(e,t){var n=e.shared;t.set(n.framebuffer,".next","null");var r=n.context;return t.set(r,"."+Qr,r+"."+ei),t.set(r,"."+Xr,r+"."+ti),"null"})}if(Ur in r){var o=r[Ur];return oo(o,function(e,t){var n=e.invoke(t,o),r=e.shared,i=r.framebuffer,a=t.def(i,".getFramebuffer(",n,")");O.optional(function(){e.assert(t,"!"+n+"||"+a,"invalid framebuffer object")}),t.set(i,".next",a);var s=r.context;return t.set(s,"."+Qr,a+"?"+a+".width:"+s+"."+ei),t.set(s,"."+Xr,a+"?"+a+".height:"+s+"."+ti),a})}return null}(e),w=function(e,t,n){var r=e.static,i=e.dynamic;function o(e){if(e in r){var o=r[e];O.commandType(o,"object","invalid "+e,n.commandStr);var a,s,l=!0,u=0|o.x,c=0|o.y;return"width"in o?O.command((a=0|o.width)>=0,"invalid "+e,n.commandStr):l=!1,"height"in o?O.command((s=0|o.height)>=0,"invalid "+e,n.commandStr):l=!1,new no(!l&&t&&t.thisDep,!l&&t&&t.contextDep,!l&&t&&t.propDep,function(e,t){var n=e.shared.context,r=a;"width"in o||(r=t.def(n,".",Qr,"-",u));var i=s;return"height"in o||(i=t.def(n,".",Xr,"-",c)),[u,c,r,i]})}if(e in i){var p=i[e],h=oo(p,function(t,n){var r=t.invoke(n,p);O.optional(function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)});var i=t.shared.context,o=n.def(r,".x|0"),a=n.def(r,".y|0"),s=n.def('"width" in ',r,"?",r,".width|0:","(",i,".",Qr,"-",o,")"),l=n.def('"height" in ',r,"?",r,".height|0:","(",i,".",Xr,"-",a,")");return O.optional(function(){t.assert(n,s+">=0&&"+l+">=0","invalid "+e)}),[o,a,s,l]});return t&&(h.thisDep=h.thisDep||t.thisDep,h.contextDep=h.contextDep||t.contextDep,h.propDep=h.propDep||t.propDep),h}return t?new no(t.thisDep,t.contextDep,t.propDep,function(e,t){var n=e.shared.context;return[0,0,t.def(n,".",Qr),t.def(n,".",Xr)]}):null}var a=o(Fr);if(a){var s=a;a=new no(a.thisDep,a.contextDep,a.propDep,function(e,t){var n=s.append(e,t),r=e.shared.context;return t.set(r,"."+Jr,n[2]),t.set(r,"."+Zr,n[3]),n})}return{viewport:a,scissor_box:o(Br)}}(e,y,h),_=function(e,t){var n=e.static,r=e.dynamic,i=function(){if(Hr in n){var e=n[Hr];eo(e)?e=a.getElements(a.create(e,!0)):e&&(e=a.getElements(e),O.command(e,"invalid elements",t.commandStr));var i=io(function(t,n){if(e){var r=t.link(e);return t.ELEMENTS=r,r}return t.ELEMENTS=null,null});return i.value=e,i}if(Hr in r){var o=r[Hr];return oo(o,function(e,t){var n=e.shared,r=n.isBufferArgs,i=n.elements,a=e.invoke(t,o),s=t.def("null"),l=t.def(r,"(",a,")"),u=e.cond(l).then(s,"=",i,".createStream(",a,");").else(s,"=",i,".getElements(",a,");");return O.optional(function(){e.assert(u.else,"!"+a+"||"+s,"invalid elements")}),t.entry(u),t.exit(e.cond(l).then(i,".destroyStream(",s,");")),e.ELEMENTS=s,s})}return null}();function o(e,o){if(e in n){var a=0|n[e];return O.command(!o||a>=0,"invalid "+e,t.commandStr),io(function(e,t){return o&&(e.OFFSET=a),a})}if(e in r){var s=r[e];return oo(s,function(t,n){var r=t.invoke(n,s);return o&&(t.OFFSET=r,O.optional(function(){t.assert(n,r+">=0","invalid "+e)})),r})}return o&&i?io(function(e,t){return e.OFFSET="0",0}):null}var s=o($r,!0);return{elements:i,primitive:function(){if(Kr in n){var e=n[Kr];return O.commandParameter(e,xe,"invalid primitve",t.commandStr),io(function(t,n){return xe[e]})}if(Kr in r){var o=r[Kr];return oo(o,function(e,t){var n=e.constants.primTypes,r=e.invoke(t,o);return O.optional(function(){e.assert(t,r+" in "+n,"invalid primitive, must be one of "+Object.keys(xe))}),t.def(n,"[",r,"]")})}return i?ro(i)?io(i.value?function(e,t){return t.def(e.ELEMENTS,".primType")}:function(){return Oi}):new no(i.thisDep,i.contextDep,i.propDep,function(e,t){var n=e.ELEMENTS;return t.def(n,"?",n,".primType:",Oi)}):null}(),count:function(){if(Gr in n){var e=0|n[Gr];return O.command("number"==typeof e&&e>=0,"invalid vertex count",t.commandStr),io(function(){return e})}if(Gr in r){var o=r[Gr];return oo(o,function(e,t){var n=e.invoke(t,o);return O.optional(function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">=0&&"+n+"===("+n+"|0)","invalid vertex count")}),n})}if(i){if(ro(i)){if(i)return s?new no(s.thisDep,s.contextDep,s.propDep,function(e,t){var n=t.def(e.ELEMENTS,".vertCount-",e.OFFSET);return O.optional(function(){e.assert(t,n+">=0","invalid vertex offset/element buffer too small")}),n}):io(function(e,t){return t.def(e.ELEMENTS,".vertCount")});var a=io(function(){return-1});return O.optional(function(){a.MISSING=!0}),a}var l=new no(i.thisDep||s.thisDep,i.contextDep||s.contextDep,i.propDep||s.propDep,function(e,t){var n=e.ELEMENTS;return e.OFFSET?t.def(n,"?",n,".vertCount-",e.OFFSET,":-1"):t.def(n,"?",n,".vertCount:-1")});return O.optional(function(){l.DYNAMIC=!0}),l}return null}(),instances:o(Wr,!1),offset:s}}(e,h),k=function(e,t){var n=e.static,r=e.dynamic,o={};return x.forEach(function(e){var a=E(e);function s(t,i){if(e in n){var s=t(n[e]);o[a]=io(function(){return s})}else if(e in r){var l=r[e];o[a]=oo(l,function(e,t){return i(e,t,e.invoke(t,l))})}}switch(e){case kr:case dr:case fr:case jr:case gr:case Ir:case Pr:case Sr:case Tr:case _r:return s(function(n){return O.commandType(n,"boolean",e,t.commandStr),n},function(t,n,r){return O.optional(function(){t.assert(n,"typeof "+r+'==="boolean"',"invalid flag "+e,t.commandStr)}),r});case yr:return s(function(n){return O.commandParameter(n,Qi,"invalid "+e,t.commandStr),Qi[n]},function(t,n,r){var i=t.constants.compareFuncs;return O.optional(function(){t.assert(n,r+" in "+i,"invalid "+e+", must be one of "+Object.keys(Qi))}),n.def(i,"[",r,"]")});case wr:return s(function(e){return O.command(Fe(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&e[0]<=e[1],"depth range is 2d array",t.commandStr),e},function(e,t,n){return O.optional(function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===2&&typeof "+n+'[0]==="number"&&typeof '+n+'[1]==="number"&&'+n+"[0]<="+n+"[1]","depth range must be a 2d array")}),[t.def("+",n,"[0]"),t.def("+",n,"[1]")]});case br:return s(function(e){O.commandType(e,"object","blend.func",t.commandStr);var n="srcRGB"in e?e.srcRGB:e.src,r="srcAlpha"in e?e.srcAlpha:e.src,i="dstRGB"in e?e.dstRGB:e.dst,o="dstAlpha"in e?e.dstAlpha:e.dst;return O.commandParameter(n,Wi,a+".srcRGB",t.commandStr),O.commandParameter(r,Wi,a+".srcAlpha",t.commandStr),O.commandParameter(i,Wi,a+".dstRGB",t.commandStr),O.commandParameter(o,Wi,a+".dstAlpha",t.commandStr),O.command(-1===Yi.indexOf(n+", "+i),"unallowed blending combination (srcRGB, dstRGB) = ("+n+", "+i+")",t.commandStr),[Wi[n],Wi[i],Wi[r],Wi[o]]},function(t,n,r){var i=t.constants.blendFuncs;function o(o,a){var s=n.def('"',o,a,'" in ',r,"?",r,".",o,a,":",r,".",o);return O.optional(function(){t.assert(n,s+" in "+i,"invalid "+e+"."+o+a+", must be one of "+Object.keys(Wi))}),s}O.optional(function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid blend func, must be an object")});var a=o("src","RGB"),s=o("dst","RGB");O.optional(function(){t.assert(n,t.constants.invalidBlendCombinations+".indexOf("+a+'+", "+'+s+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var l=n.def(i,"[",a,"]"),u=n.def(i,"[",o("src","Alpha"),"]");return[l,n.def(i,"[",s,"]"),u,n.def(i,"[",o("dst","Alpha"),"]")]});case vr:return s(function(n){return"string"==typeof n?(O.commandParameter(n,b,"invalid "+e,t.commandStr),[b[n],b[n]]):"object"==typeof n?(O.commandParameter(n.rgb,b,e+".rgb",t.commandStr),O.commandParameter(n.alpha,b,e+".alpha",t.commandStr),[b[n.rgb],b[n.alpha]]):void O.commandRaise("invalid blend.equation",t.commandStr)},function(t,n,r){var i=t.constants.blendEquations,o=n.def(),a=n.def(),s=t.cond("typeof ",r,'==="string"');return O.optional(function(){function n(e,n,r){t.assert(e,r+" in "+i,"invalid "+n+", must be one of "+Object.keys(b))}n(s.then,e,r),t.assert(s.else,r+"&&typeof "+r+'==="object"',"invalid "+e),n(s.else,e+".rgb",r+".rgb"),n(s.else,e+".alpha",r+".alpha")}),s.then(o,"=",a,"=",i,"[",r,"];"),s.else(o,"=",i,"[",r,".rgb];",a,"=",i,"[",r,".alpha];"),n(s),[o,a]});case mr:return s(function(e){return O.command(Fe(e)&&4===e.length,"blend.color must be a 4d array",t.commandStr),$(4,function(t){return+e[t]})},function(e,t,n){return O.optional(function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","blend.color must be a 4d array")}),$(4,function(e){return t.def("+",n,"[",e,"]")})});case Or:return s(function(e){return O.commandType(e,"number",a,t.commandStr),0|e},function(e,t,n){return O.optional(function(){e.assert(t,"typeof "+n+'==="number"',"invalid stencil.mask")}),t.def(n,"|0")});case Dr:return s(function(n){O.commandType(n,"object",a,t.commandStr);var r=n.cmp||"keep",i=n.ref||0,o="mask"in n?n.mask:-1;return O.commandParameter(r,Qi,e+".cmp",t.commandStr),O.commandType(i,"number",e+".ref",t.commandStr),O.commandType(o,"number",e+".mask",t.commandStr),[Qi[r],i,o]},function(e,t,n){var r=e.constants.compareFuncs;return O.optional(function(){function i(){e.assert(t,Array.prototype.join.call(arguments,""),"invalid stencil.func")}i(n+"&&typeof ",n,'==="object"'),i('!("cmp" in ',n,")||(",n,".cmp in ",r,")")}),[t.def('"cmp" in ',n,"?",r,"[",n,".cmp]",":",Ui),t.def(n,".ref|0"),t.def('"mask" in ',n,"?",n,".mask|0:-1")]});case Lr:case Rr:return s(function(n){O.commandType(n,"object",a,t.commandStr);var r=n.fail||"keep",i=n.zfail||"keep",o=n.zpass||"keep";return O.commandParameter(r,Xi,e+".fail",t.commandStr),O.commandParameter(i,Xi,e+".zfail",t.commandStr),O.commandParameter(o,Xi,e+".zpass",t.commandStr),[e===Rr?Li:Di,Xi[r],Xi[i],Xi[o]]},function(t,n,r){var i=t.constants.stencilOps;function o(o){return O.optional(function(){t.assert(n,'!("'+o+'" in '+r+")||("+r+"."+o+" in "+i+")","invalid "+e+"."+o+", must be one of "+Object.keys(Xi))}),n.def('"',o,'" in ',r,"?",i,"[",r,".",o,"]:",Ui)}return O.optional(function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)}),[e===Rr?Li:Di,o("fail"),o("zfail"),o("zpass")]});case Mr:return s(function(e){O.commandType(e,"object",a,t.commandStr);var n=0|e.factor,r=0|e.units;return O.commandType(n,"number",a+".factor",t.commandStr),O.commandType(r,"number",a+".units",t.commandStr),[n,r]},function(t,n,r){return O.optional(function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)}),[n.def(r,".factor|0"),n.def(r,".units|0")]});case Cr:return s(function(e){var n=0;return"front"===e?n=Di:"back"===e&&(n=Li),O.command(!!n,a,t.commandStr),n},function(e,t,n){return O.optional(function(){e.assert(t,n+'==="front"||'+n+'==="back"',"invalid cull.face")}),t.def(n,'==="front"?',Di,":",Li)});case Ar:return s(function(e){return O.command("number"==typeof e&&e>=i.lineWidthDims[0]&&e<=i.lineWidthDims[1],"invalid line width, must be a positive number between "+i.lineWidthDims[0]+" and "+i.lineWidthDims[1],t.commandStr),e},function(e,t,n){return O.optional(function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">="+i.lineWidthDims[0]+"&&"+n+"<="+i.lineWidthDims[1],"invalid line width")}),n});case Er:return s(function(e){return O.commandParameter(e,Zi,a,t.commandStr),Zi[e]},function(e,t,n){return O.optional(function(){e.assert(t,n+'==="cw"||'+n+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),t.def(n+'==="cw"?'+Ri+":"+Ii)});case xr:return s(function(e){return O.command(Fe(e)&&4===e.length,"color.mask must be length 4 array",t.commandStr),e.map(function(e){return!!e})},function(e,t,n){return O.optional(function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","invalid color.mask")}),$(4,function(e){return"!!"+n+"["+e+"]"})});case Vr:return s(function(e){O.command("object"==typeof e&&e,a,t.commandStr);var n="value"in e?e.value:1,r=!!e.invert;return O.command("number"==typeof n&&n>=0&&n<=1,"sample.coverage.value must be a number between 0 and 1",t.commandStr),[n,r]},function(e,t,n){return O.optional(function(){e.assert(t,n+"&&typeof "+n+'==="object"',"invalid sample.coverage")}),[t.def('"value" in ',n,"?+",n,".value:1"),t.def("!!",n,".invert")]})}}),o}(e,h),C=function(e,t,r){var i=e.static,o=e.dynamic;function a(e){if(e in i){var t=n.id(i[e]);O.optional(function(){p.shader(Ji[e],t,O.guessCommand())});var r=io(function(){return t});return r.id=t,r}if(e in o){var a=o[e];return oo(a,function(t,n){var r=t.invoke(n,a),i=n.def(t.shared.strings,".id(",r,")");return O.optional(function(){n(t.shared.shader,".shader(",Ji[e],",",i,",",t.command,");")}),i})}return null}var s,l=a(qr),u=a(Nr),c=null;return ro(l)&&ro(u)?(c=p.program(u.id,l.id,null,r),s=io(function(e,t){return e.link(c)})):s=new no(l&&l.thisDep||u&&u.thisDep,l&&l.contextDep||u&&u.contextDep,l&&l.propDep||u&&u.propDep,function(e,t){var n,r=e.shared.shader;n=l?l.append(e,t):t.def(r,".",qr);var i=r+".program("+(u?u.append(e,t):t.def(r,".",Nr))+","+n;return O.optional(function(){i+=","+e.command}),t.def(i+")")}),{frag:l,vert:u,progVar:s,program:c}}(e,0,m);function A(e){var t=w[e];t&&(k[e]=t)}A(Fr),A(E(Br));var P=Object.keys(k).length>0,M={framebuffer:y,draw:_,shader:C,state:k,dirty:P,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(M.profile=function(e){var t,n=e.static,r=e.dynamic;if(zr in n){var i=!!n[zr];(t=io(function(e,t){return i})).enable=i}else if(zr in r){var o=r[zr];t=oo(o,function(e,t){return e.invoke(t,o)})}return t}(e),M.uniforms=function(e,t){var n=e.static,r=e.dynamic,i={};return Object.keys(n).forEach(function(e){var r,o=n[e];if("number"==typeof o||"boolean"==typeof o)r=io(function(){return o});else if("function"==typeof o){var a=o._reglType;"texture2d"===a||"textureCube"===a?r=io(function(e){return e.link(o)}):"framebuffer"===a||"framebufferCube"===a?(O.command(o.color.length>0,'missing color attachment for framebuffer sent to uniform "'+e+'"',t.commandStr),r=io(function(e){return e.link(o.color[0])})):O.commandRaise('invalid data for uniform "'+e+'"',t.commandStr)}else Fe(o)?r=io(function(t){return t.global.def("[",$(o.length,function(n){return O.command("number"==typeof o[n]||"boolean"==typeof o[n],"invalid uniform "+e,t.commandStr),o[n]}),"]")}):O.commandRaise('invalid or missing data for uniform "'+e+'"',t.commandStr);r.value=o,i[e]=r}),Object.keys(r).forEach(function(e){var t=r[e];i[e]=oo(t,function(e,n){return e.invoke(n,t)})}),i}(s,h),M.drawVAO=M.scopeVAO=function(e,t){var n=e.static,r=e.dynamic;if(Yr in n){var i=n[Yr];return null!==i&&null===c.getVAO(i)&&(i=c.createVAO(i)),io(function(e){return e.link(c.getVAO(i))})}if(Yr in r){var o=r[Yr];return oo(o,function(e,t){var n=e.invoke(t,o);return t.def(e.shared.vao+".getVAO("+n+")")})}return null}(e),!M.drawVAO&&C.program&&!m&&r.angle_instanced_arrays){var S=!0,T=C.program.attributes.map(function(e){var n=t.static[e];return S=S&&!!n,n});if(S&&T.length>0){var V=c.getVAO(c.createVAO(T));M.drawVAO=new no(null,null,null,function(e,t){return e.link(V)}),M.useVAO=!0}}return m?M.useVAO=!0:M.attributes=function(e,t){var r=e.static,i=e.dynamic,a={};return Object.keys(r).forEach(function(e){var i=r[e],s=n.id(e),l=new v;if(eo(i))l.state=ir,l.buffer=o.getBuffer(o.create(i,ri,!1,!0)),l.type=0;else{var u=o.getBuffer(i);if(u)l.state=ir,l.buffer=u,l.type=0;else if(O.command("object"==typeof i&&i,"invalid data for attribute "+e,t.commandStr),"constant"in i){var c=i.constant;l.buffer="null",l.state=or,"number"==typeof c?l.x=c:(O.command(Fe(c)&&c.length>0&&c.length<=4,"invalid constant for attribute "+e,t.commandStr),nr.forEach(function(e,t){t<c.length&&(l[e]=c[t])}))}else{u=eo(i.buffer)?o.getBuffer(o.create(i.buffer,ri,!1,!0)):o.getBuffer(i.buffer),O.command(!!u,'missing buffer for attribute "'+e+'"',t.commandStr);var p=0|i.offset;O.command(p>=0,'invalid offset for attribute "'+e+'"',t.commandStr);var h=0|i.stride;O.command(h>=0&&h<256,'invalid stride for attribute "'+e+'", must be integer betweeen [0, 255]',t.commandStr);var f=0|i.size;O.command(!("size"in i)||f>0&&f<=4,'invalid size for attribute "'+e+'", must be 1,2,3,4',t.commandStr);var d=!!i.normalized,m=0;"type"in i&&(O.commandParameter(i.type,ce,"invalid type for attribute "+e,t.commandStr),m=ce[i.type]);var b=0|i.divisor;"divisor"in i&&(O.command(0===b||g,'cannot specify divisor for attribute "'+e+'", instancing not supported',t.commandStr),O.command(b>=0,'invalid divisor for attribute "'+e+'"',t.commandStr)),O.optional(function(){var n=t.commandStr,r=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(i).forEach(function(t){O.command(r.indexOf(t)>=0,'unknown parameter "'+t+'" for attribute pointer "'+e+'" (valid parameters are '+r+")",n)})}),l.buffer=u,l.state=ir,l.size=f,l.normalized=d,l.type=m||u.dtype,l.offset=p,l.stride=h,l.divisor=b}}a[e]=io(function(e,t){var n=e.attribCache;if(s in n)return n[s];var r={isStream:!1};return Object.keys(l).forEach(function(e){r[e]=l[e]}),l.buffer&&(r.buffer=e.link(l.buffer),r.type=r.type||r.buffer+".dtype"),n[s]=r,r})}),Object.keys(i).forEach(function(e){var t=i[e];a[e]=oo(t,function(n,r){var i=n.invoke(r,t),o=n.shared,a=n.constants,s=o.isBufferArgs,l=o.buffer;O.optional(function(){n.assert(r,i+"&&(typeof "+i+'==="object"||typeof '+i+'==="function")&&('+s+"("+i+")||"+l+".getBuffer("+i+")||"+l+".getBuffer("+i+".buffer)||"+s+"("+i+'.buffer)||("constant" in '+i+"&&(typeof "+i+'.constant==="number"||'+o.isArrayLike+"("+i+".constant))))",'invalid dynamic attribute "'+e+'"')});var u={isStream:r.def(!1)},c=new v;c.state=ir,Object.keys(c).forEach(function(e){u[e]=r.def(""+c[e])});var p=u.buffer,h=u.type;function f(e){r(u[e],"=",i,".",e,"|0;")}return r("if(",s,"(",i,")){",u.isStream,"=true;",p,"=",l,".createStream(",ri,",",i,");",h,"=",p,".dtype;","}else{",p,"=",l,".getBuffer(",i,");","if(",p,"){",h,"=",p,".dtype;",'}else if("constant" in ',i,"){",u.state,"=",or,";","if(typeof "+i+'.constant === "number"){',u[nr[0]],"=",i,".constant;",nr.slice(1).map(function(e){return u[e]}).join("="),"=0;","}else{",nr.map(function(e,t){return u[e]+"="+i+".constant.length>"+t+"?"+i+".constant["+t+"]:0;"}).join(""),"}}else{","if(",s,"(",i,".buffer)){",p,"=",l,".createStream(",ri,",",i,".buffer);","}else{",p,"=",l,".getBuffer(",i,".buffer);","}",h,'="type" in ',i,"?",a.glTypes,"[",i,".type]:",p,".dtype;",u.normalized,"=!!",i,".normalized;"),f("size"),f("offset"),f("stride"),f("divisor"),r("}}"),r.exit("if(",u.isStream,"){",l,".destroyStream(",p,");","}"),u})}),a}(t,h),M.context=function(e){var t=e.static,n=e.dynamic,r={};return Object.keys(t).forEach(function(e){var n=t[e];r[e]=io(function(e,t){return"number"==typeof n||"boolean"==typeof n?""+n:e.link(n)})}),Object.keys(n).forEach(function(e){var t=n[e];r[e]=oo(t,function(e,n){return e.invoke(n,t)})}),r}(u),M}function D(e,t,n){var r=e.shared.context,i=e.scope();Object.keys(n).forEach(function(o){t.save(r,"."+o);var a=n[o].append(e,t);Array.isArray(a)?i(r,".",o,"=[",a.join(),"];"):i(r,".",o,"=",a,";")}),t(i)}function L(e,t,n,r){var i,o=e.shared,a=o.gl,s=o.framebuffer;y&&(i=t.def(o.extensions,".webgl_draw_buffers"));var l,u=e.constants,c=u.drawBuffer,p=u.backBuffer;l=n?n.append(e,t):t.def(s,".next"),r||t("if(",l,"!==",s,".cur){"),t("if(",l,"){",a,".bindFramebuffer(",Gi,",",l,".framebuffer);"),y&&t(i,".drawBuffersWEBGL(",c,"[",l,".colorAttachments.length]);"),t("}else{",a,".bindFramebuffer(",Gi,",null);"),y&&t(i,".drawBuffersWEBGL(",p,");"),t("}",s,".cur=",l,";"),r||t("}")}function R(e,t,n){var r=e.shared,i=r.gl,o=e.current,a=e.next,s=r.current,l=r.next,u=e.cond(s,".dirty");x.forEach(function(t){var r,c,p=E(t);if(!(p in n.state))if(p in a){r=a[p],c=o[p];var h=$(w[p].length,function(e){return u.def(r,"[",e,"]")});u(e.cond(h.map(function(e,t){return e+"!=="+c+"["+t+"]"}).join("||")).then(i,".",C[p],"(",h,");",h.map(function(e,t){return c+"["+t+"]="+e}).join(";"),";"))}else{r=u.def(l,".",p);var f=e.cond(r,"!==",s,".",p);u(f),p in k?f(e.cond(r).then(i,".enable(",k[p],");").else(i,".disable(",k[p],");"),s,".",p,"=",r,";"):f(i,".",C[p],"(",r,");",s,".",p,"=",r,";")}}),0===Object.keys(n.state).length&&u(s,".dirty=false;"),t(u)}function I(e,t,n,r){var i=e.shared,o=e.current,a=i.current,s=i.gl;to(Object.keys(n)).forEach(function(i){var l=n[i];if(!r||r(l)){var u=l.append(e,t);if(k[i]){var c=k[i];ro(l)?t(s,u?".enable(":".disable(",c,");"):t(e.cond(u).then(s,".enable(",c,");").else(s,".disable(",c,");")),t(a,".",i,"=",u,";")}else if(Fe(u)){var p=o[i];t(s,".",C[i],"(",u,");",u.map(function(e,t){return p+"["+t+"]="+e}).join(";"),";")}else t(s,".",C[i],"(",u,");",a,".",i,"=",u,";")}})}function B(e,t){g&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function F(e,t,n,r,i){var o,a,s,l=e.shared,u=e.stats,c=l.current,p=l.timer,h=n.profile;function f(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function m(e){e(o=t.def(),"=",f(),";"),"string"==typeof i?e(u,".count+=",i,";"):e(u,".count++;"),d&&(r?e(a=t.def(),"=",p,".getNumPendingQueries();"):e(p,".beginQuery(",u,");"))}function v(e){e(u,".cpuTime+=",f(),"-",o,";"),d&&(r?e(p,".pushScopeStats(",a,",",p,".getNumPendingQueries(),",u,");"):e(p,".endQuery();"))}function b(e){var n=t.def(c,".profile");t(c,".profile=",e,";"),t.exit(c,".profile=",n,";")}if(h){if(ro(h))return void(h.enable?(m(t),v(t.exit),b("true")):b("false"));b(s=h.append(e,t))}else s=t.def(c,".profile");var g=e.block();m(g),t("if(",s,"){",g,"}");var y=e.block();v(y),t.exit("if(",s,"){",y,"}")}function z(e,t,n,r,i){var o=e.shared;r.forEach(function(r){var a,s=r.name,l=n.attributes[s];if(l){if(!i(l))return;a=l.append(e,t)}else{if(!i(ao))return;var u=e.scopeAttrib(s);O.optional(function(){e.assert(t,u+".state","missing attribute "+s)}),a={},Object.keys(new v).forEach(function(e){a[e]=t.def(u,".",e)})}!function(n,r,i){var a=o.gl,s=t.def(n,".location"),l=t.def(o.attributes,"[",s,"]"),u=i.state,c=i.buffer,p=[i.x,i.y,i.z,i.w],h=["buffer","normalized","offset","stride"];function f(){t("if(!",l,".buffer){",a,".enableVertexAttribArray(",s,");}");var n,o=i.type;if(n=i.size?t.def(i.size,"||",r):r,t("if(",l,".type!==",o,"||",l,".size!==",n,"||",h.map(function(e){return l+"."+e+"!=="+i[e]}).join("||"),"){",a,".bindBuffer(",ri,",",c,".buffer);",a,".vertexAttribPointer(",[s,n,o,i.normalized,i.stride,i.offset],");",l,".type=",o,";",l,".size=",n,";",h.map(function(e){return l+"."+e+"="+i[e]+";"}).join(""),"}"),g){var u=i.divisor;t("if(",l,".divisor!==",u,"){",e.instancing,".vertexAttribDivisorANGLE(",[s,u],");",l,".divisor=",u,";}")}}function d(){t("if(",l,".buffer){",a,".disableVertexAttribArray(",s,");",l,".buffer=null;","}if(",nr.map(function(e,t){return l+"."+e+"!=="+p[t]}).join("||"),"){",a,".vertexAttrib4f(",s,",",p,");",nr.map(function(e,t){return l+"."+e+"="+p[t]+";"}).join(""),"}")}u===ir?f():u===or?d():(t("if(",u,"===",ir,"){"),f(),t("}else{"),d(),t("}"))}(e.link(r),function(e){switch(e){case bi:case _i:case Ei:return 2;case gi:case xi:case Ai:return 3;case yi:case ki:case Pi:return 4;default:return 1}}(r.info.type),a)})}function N(e,t,r,i,o){for(var a,s=e.shared,l=s.gl,u=0;u<i.length;++u){var c,p=i[u],h=p.name,f=p.info.type,d=r.uniforms[h],m=e.link(p)+".location";if(d){if(!o(d))continue;if(ro(d)){var v=d.value;if(O.command(null!=v,'missing uniform "'+h+'"',e.commandStr),f===Vi||f===ji){O.command("function"==typeof v&&(f===Vi&&("texture2d"===v._reglType||"framebuffer"===v._reglType)||f===ji&&("textureCube"===v._reglType||"framebufferCube"===v._reglType)),"invalid texture for uniform "+h,e.commandStr);var b=e.link(v._texture||v.color[0]._texture);t(l,".uniform1i(",m,",",b+".bind());"),t.exit(b,".unbind();")}else if(f===Mi||f===Si||f===Ti){O.optional(function(){O.command(Fe(v),"invalid matrix for uniform "+h,e.commandStr),O.command(f===Mi&&4===v.length||f===Si&&9===v.length||f===Ti&&16===v.length,"invalid length for matrix uniform "+h,e.commandStr)});var g=e.global.def("new Float32Array(["+Array.prototype.slice.call(v)+"])"),y=2;f===Si?y=3:f===Ti&&(y=4),t(l,".uniformMatrix",y,"fv(",m,",false,",g,");")}else{switch(f){case vi:O.commandType(v,"number","uniform "+h,e.commandStr),a="1f";break;case bi:O.command(Fe(v)&&2===v.length,"uniform "+h,e.commandStr),a="2f";break;case gi:O.command(Fe(v)&&3===v.length,"uniform "+h,e.commandStr),a="3f";break;case yi:O.command(Fe(v)&&4===v.length,"uniform "+h,e.commandStr),a="4f";break;case Ci:O.commandType(v,"boolean","uniform "+h,e.commandStr),a="1i";break;case wi:O.commandType(v,"number","uniform "+h,e.commandStr),a="1i";break;case Ei:case _i:O.command(Fe(v)&&2===v.length,"uniform "+h,e.commandStr),a="2i";break;case Ai:case xi:O.command(Fe(v)&&3===v.length,"uniform "+h,e.commandStr),a="3i";break;case Pi:case ki:O.command(Fe(v)&&4===v.length,"uniform "+h,e.commandStr),a="4i"}t(l,".uniform",a,"(",m,",",Fe(v)?Array.prototype.slice.call(v):v,");")}continue}c=d.append(e,t)}else{if(!o(ao))continue;c=t.def(s.uniforms,"[",n.id(h),"]")}f===Vi?(O(!Array.isArray(c),"must specify a scalar prop for textures"),t("if(",c,"&&",c,'._reglType==="framebuffer"){',c,"=",c,".color[0];","}")):f===ji&&(O(!Array.isArray(c),"must specify a scalar prop for cube maps"),t("if(",c,"&&",c,'._reglType==="framebufferCube"){',c,"=",c,".color[0];","}")),O.optional(function(){function n(n,r){e.assert(t,n,'bad data or missing for uniform "'+h+'".  '+r)}function r(e){O(!Array.isArray(c),"must not specify an array type for uniform"),n("typeof "+c+'==="'+e+'"',"invalid type, expected "+e)}function i(e,t){Array.isArray(c)?O(c.length===e,"must have length "+e):n(s.isArrayLike+"("+c+")&&"+c+".length==="+e,"invalid vector, should have length "+e)}function o(e){O(!Array.isArray(c),"must not specify a value type"),n("typeof "+c+'==="function"&&'+c+'._reglType==="texture'+(e===oi?"2d":"Cube")+'"',"invalid texture type")}switch(f){case wi:r("number");break;case _i:i(2);break;case xi:i(3);break;case ki:i(4);break;case vi:r("number");break;case bi:i(2);break;case gi:i(3);break;case yi:i(4);break;case Ci:r("boolean");break;case Ei:i(2);break;case Ai:i(3);break;case Pi:case Mi:i(4);break;case Si:i(9);break;case Ti:i(16);break;case Vi:o(oi);break;case ji:o(ai)}});var w=1;switch(f){case Vi:case ji:var _=t.def(c,"._texture");t(l,".uniform1i(",m,",",_,".bind());"),t.exit(_,".unbind();");continue;case wi:case Ci:a="1i";break;case _i:case Ei:a="2i",w=2;break;case xi:case Ai:a="3i",w=3;break;case ki:case Pi:a="4i",w=4;break;case vi:a="1f";break;case bi:a="2f",w=2;break;case gi:a="3f",w=3;break;case yi:a="4f",w=4;break;case Mi:a="Matrix2fv";break;case Si:a="Matrix3fv";break;case Ti:a="Matrix4fv"}if(t(l,".uniform",a,"(",m,","),"M"===a.charAt(0)){var x=Math.pow(f-Mi+2,2),k=e.global.def("new Float32Array(",x,")");Array.isArray(c)?t("false,(",$(x,function(e){return k+"["+e+"]="+c[e]}),",",k,")"):t("false,(Array.isArray(",c,")||",c," instanceof Float32Array)?",c,":(",$(x,function(e){return k+"["+e+"]="+c+"["+e+"]"}),",",k,")")}else w>1?t($(w,function(e){return Array.isArray(c)?c[e]:c+"["+e+"]"})):(O(!Array.isArray(c),"uniform value must not be an array"),t(c));t(");")}}function q(e,t,n,r){var i=e.shared,o=i.gl,a=i.draw,s=r.draw;var l=function(){var i,l=s.elements,u=t;return l?((l.contextDep&&r.contextDynamic||l.propDep)&&(u=n),i=l.append(e,u)):i=u.def(a,".",Hr),i&&u("if("+i+")"+o+".bindBuffer("+ii+","+i+".buffer.buffer);"),i}();function u(i){var o=s[i];return o?o.append(e,o.contextDep&&r.contextDynamic||o.propDep?n:t):t.def(a,".",i)}var c,p,h=u(Kr),f=u($r),d=function(){var i,o=s.count,l=t;return o?((o.contextDep&&r.contextDynamic||o.propDep)&&(l=n),i=o.append(e,l),O.optional(function(){o.MISSING&&e.assert(t,"false","missing vertex count"),o.DYNAMIC&&e.assert(l,i+">=0","missing vertex count")})):(i=l.def(a,".",Gr),O.optional(function(){e.assert(l,i+">=0","missing vertex count")})),i}();if("number"==typeof d){if(0===d)return}else n("if(",d,"){"),n.exit("}");g&&(c=u(Wr),p=e.instancing);var m=l+".type",v=s.elements&&ro(s.elements);function b(){function e(){n(p,".drawElementsInstancedANGLE(",[h,d,m,f+"<<(("+m+"-"+rr+")>>1)",c],");")}function t(){n(p,".drawArraysInstancedANGLE(",[h,f,d,c],");")}l?v?e():(n("if(",l,"){"),e(),n("}else{"),t(),n("}")):t()}function y(){function e(){n(o+".drawElements("+[h,d,m,f+"<<(("+m+"-"+rr+")>>1)"]+");")}function t(){n(o+".drawArrays("+[h,f,d]+");")}l?v?e():(n("if(",l,"){"),e(),n("}else{"),t(),n("}")):t()}g&&("number"!=typeof c||c>=0)?"string"==typeof c?(n("if(",c,">0){"),b(),n("}else if(",c,"<0){"),y(),n("}")):b():y()}function H(e,t,n,r,i){var o=V(),a=o.proc("body",i);return O.optional(function(){o.commandStr=t.commandStr,o.command=o.link(t.commandStr)}),g&&(o.instancing=a.def(o.shared.extensions,".angle_instanced_arrays")),e(o,a,n,r),o.compile().body}function K(e,t,n,r){B(e,t),n.useVAO?n.drawVAO?t(e.shared.vao,".setVAO(",n.drawVAO.append(e,t),");"):t(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(t(e.shared.vao,".setVAO(null);"),z(e,t,n,r.attributes,function(){return!0})),N(e,t,n,r.uniforms,function(){return!0}),q(e,t,t,n)}function G(e,t,n,r){function i(){return!0}e.batchId="a1",B(e,t),z(e,t,n,r.attributes,i),N(e,t,n,r.uniforms,i),q(e,t,t,n)}function W(e,t,n,r){B(e,t);var i=n.contextDep,o=t.def(),a=t.def();e.shared.props=a,e.batchId=o;var s=e.scope(),l=e.scope();function u(e){return e.contextDep&&i||e.propDep}function c(e){return!u(e)}if(t(s.entry,"for(",o,"=0;",o,"<","a1",";++",o,"){",a,"=","a0","[",o,"];",l,"}",s.exit),n.needsContext&&D(e,l,n.context),n.needsFramebuffer&&L(e,l,n.framebuffer),I(e,l,n.state,u),n.profile&&u(n.profile)&&F(e,l,n,!1,!0),r)n.useVAO?n.drawVAO?u(n.drawVAO)?l(e.shared.vao,".setVAO(",n.drawVAO.append(e,l),");"):s(e.shared.vao,".setVAO(",n.drawVAO.append(e,s),");"):s(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(s(e.shared.vao,".setVAO(null);"),z(e,s,n,r.attributes,c),z(e,l,n,r.attributes,u)),N(e,s,n,r.uniforms,c),N(e,l,n,r.uniforms,u),q(e,s,l,n);else{var p=e.global.def("{}"),h=n.shader.progVar.append(e,l),f=l.def(h,".id"),d=l.def(p,"[",f,"]");l(e.shared.gl,".useProgram(",h,".program);","if(!",d,"){",d,"=",p,"[",f,"]=",e.link(function(t){return H(G,e,n,t,2)}),"(",h,");}",d,".call(this,a0[",o,"],",o,");")}}function Y(e,t,n){var r=t.static[n];if(r&&function(e){if("object"==typeof e&&!Fe(e)){for(var t=Object.keys(e),n=0;n<t.length;++n)if(U.isDynamic(e[t[n]]))return!0;return!1}}(r)){var i=e.global,o=Object.keys(r),a=!1,s=!1,l=!1,u=e.global.def("{}");o.forEach(function(t){var n=r[t];if(U.isDynamic(n)){"function"==typeof n&&(n=r[t]=U.unbox(n));var o=oo(n,null);a=a||o.thisDep,l=l||o.propDep,s=s||o.contextDep}else{switch(i(u,".",t,"="),typeof n){case"number":i(n);break;case"string":i('"',n,'"');break;case"object":Array.isArray(n)&&i("[",n.join(),"]");break;default:i(e.link(n))}i(";")}}),t.dynamic[n]=new U.DynamicVariable(cr,{thisDep:a,contextDep:s,propDep:l,ref:u,append:function(e,t){o.forEach(function(n){var i=r[n];if(U.isDynamic(i)){var o=e.invoke(t,i);t(u,".",n,"=",o,";")}})}}),delete t.static[n]}}return{next:_,current:w,procs:function(){var e=V(),t=e.proc("poll"),n=e.proc("refresh"),o=e.block();t(o),n(o);var a,s=e.shared,l=s.gl,u=s.next,c=s.current;o(c,".dirty=false;"),L(e,t),L(e,n,null,!0),g&&(a=e.link(g)),r.oes_vertex_array_object&&n(e.link(r.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var p=0;p<i.maxAttributes;++p){var h=n.def(s.attributes,"[",p,"]"),f=e.cond(h,".buffer");f.then(l,".enableVertexAttribArray(",p,");",l,".bindBuffer(",ri,",",h,".buffer.buffer);",l,".vertexAttribPointer(",p,",",h,".size,",h,".type,",h,".normalized,",h,".stride,",h,".offset);").else(l,".disableVertexAttribArray(",p,");",l,".vertexAttrib4f(",p,",",h,".x,",h,".y,",h,".z,",h,".w);",h,".buffer=null;"),n(f),g&&n(a,".vertexAttribDivisorANGLE(",p,",",h,".divisor);")}return n(e.shared.vao,".currentVAO=null;",e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"),Object.keys(k).forEach(function(r){var i=k[r],a=o.def(u,".",r),s=e.block();s("if(",a,"){",l,".enable(",i,")}else{",l,".disable(",i,")}",c,".",r,"=",a,";"),n(s),t("if(",a,"!==",c,".",r,"){",s,"}")}),Object.keys(C).forEach(function(r){var i,a,s=C[r],p=w[r],h=e.block();if(h(l,".",s,"("),Fe(p)){var f=p.length;i=e.global.def(u,".",r),a=e.global.def(c,".",r),h($(f,function(e){return i+"["+e+"]"}),");",$(f,function(e){return a+"["+e+"]="+i+"["+e+"];"}).join("")),t("if(",$(f,function(e){return i+"["+e+"]!=="+a+"["+e+"]"}).join("||"),"){",h,"}")}else i=o.def(u,".",r),a=o.def(c,".",r),h(i,");",c,".",r,"=",i,";"),t("if(",i,"!==",a,"){",h,"}");n(h)}),e.compile()}(),compile:function(e,r,i,o,a){var s=V();s.stats=s.link(a),Object.keys(r.static).forEach(function(e){Y(s,r,e)}),ni.forEach(function(t){Y(s,e,t)});var l=j(e,r,i,o,s);return function(e,t){var n=e.proc("draw",1);B(e,n),D(e,n,t.context),L(e,n,t.framebuffer),R(e,n,t),I(e,n,t.state),F(e,n,t,!1,!0);var r=t.shader.progVar.append(e,n);if(n(e.shared.gl,".useProgram(",r,".program);"),t.shader.program)K(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var i=e.global.def("{}"),o=n.def(r,".id"),a=n.def(i,"[",o,"]");n(e.cond(a).then(a,".call(this,a0);").else(a,"=",i,"[",o,"]=",e.link(function(n){return H(K,e,t,n,1)}),"(",r,");",a,".call(this,a0);"))}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;")}(s,l),function(e,t){var r=e.proc("scope",3);e.batchId="a2";var i=e.shared,o=i.current;function a(n){var o=t.shader[n];o&&r.set(i.shader,"."+n,o.append(e,r))}D(e,r,t.context),t.framebuffer&&t.framebuffer.append(e,r),to(Object.keys(t.state)).forEach(function(n){var o=t.state[n].append(e,r);Fe(o)?o.forEach(function(t,i){r.set(e.next[n],"["+i+"]",t)}):r.set(i.next,"."+n,o)}),F(e,r,t,!0,!0),[Hr,$r,Gr,Wr,Kr].forEach(function(n){var o=t.draw[n];o&&r.set(i.draw,"."+n,""+o.append(e,r))}),Object.keys(t.uniforms).forEach(function(o){var a=t.uniforms[o].append(e,r);Array.isArray(a)&&(a="["+a.join()+"]"),r.set(i.uniforms,"["+n.id(o)+"]",a)}),Object.keys(t.attributes).forEach(function(n){var i=t.attributes[n].append(e,r),o=e.scopeAttrib(n);Object.keys(new v).forEach(function(e){r.set(o,"."+e,i[e])})}),t.scopeVAO&&r.set(i.vao,".targetVAO",t.scopeVAO.append(e,r)),a(Nr),a(qr),Object.keys(t.state).length>0&&(r(o,".dirty=true;"),r.exit(o,".dirty=true;")),r("a1(",e.shared.context,",a0,",e.batchId,");")}(s,l),function(e,t){var n=e.proc("batch",2);e.batchId="0",B(e,n);var r=!1,i=!0;Object.keys(t.context).forEach(function(e){r=r||t.context[e].propDep}),r||(D(e,n,t.context),i=!1);var o=t.framebuffer,a=!1;function s(e){return e.contextDep&&r||e.propDep}o?(o.propDep?r=a=!0:o.contextDep&&r&&(a=!0),a||L(e,n,o)):L(e,n,null),t.state.viewport&&t.state.viewport.propDep&&(r=!0),R(e,n,t),I(e,n,t.state,function(e){return!s(e)}),t.profile&&s(t.profile)||F(e,n,t,!1,"a1"),t.contextDep=r,t.needsContext=i,t.needsFramebuffer=a;var l=t.shader.progVar;if(l.contextDep&&r||l.propDep)W(e,n,t,null);else{var u=l.append(e,n);if(n(e.shared.gl,".useProgram(",u,".program);"),t.shader.program)W(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var c=e.global.def("{}"),p=n.def(u,".id"),h=n.def(c,"[",p,"]");n(e.cond(h).then(h,".call(this,a0,a1);").else(h,"=",c,"[",p,"]=",e.link(function(n){return H(W,e,t,n,2)}),"(",u,");",h,".call(this,a0,a1);"))}}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;")}(s,l),t(s.compile(),{destroy:function(){l.shader.program.destroy()}})}}}var lo=34918,uo=34919,co=35007,po=function(e,t){if(!t.ext_disjoint_timer_query)return null;var n=[];function r(e){n.push(e)}var i=[];function o(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var a=[];function s(e){a.push(e)}var l=[];function u(e,t,n){var r=a.pop()||new o;r.startQueryIndex=e,r.endQueryIndex=t,r.sum=0,r.stats=n,l.push(r)}var c=[],p=[];return{beginQuery:function(e){var r=n.pop()||t.ext_disjoint_timer_query.createQueryEXT();t.ext_disjoint_timer_query.beginQueryEXT(co,r),i.push(r),u(i.length-1,i.length,e)},endQuery:function(){t.ext_disjoint_timer_query.endQueryEXT(co)},pushScopeStats:u,update:function(){var e,n,o=i.length;if(0!==o){p.length=Math.max(p.length,o+1),c.length=Math.max(c.length,o+1),c[0]=0,p[0]=0;var a=0;for(e=0,n=0;n<i.length;++n){var u=i[n];t.ext_disjoint_timer_query.getQueryObjectEXT(u,uo)?(a+=t.ext_disjoint_timer_query.getQueryObjectEXT(u,lo),r(u)):i[e++]=u,c[n+1]=a,p[n+1]=e}for(i.length=e,e=0,n=0;n<l.length;++n){var h=l[n],f=h.startQueryIndex,d=h.endQueryIndex;h.sum+=c[d]-c[f];var m=p[f],v=p[d];v===m?(h.stats.gpuTime+=h.sum/1e6,s(h)):(h.startQueryIndex=m,h.endQueryIndex=v,l[e++]=h)}l.length=e}},getNumPendingQueries:function(){return i.length},clear:function(){n.push.apply(n,i);for(var e=0;e<n.length;e++)t.ext_disjoint_timer_query.deleteQueryEXT(n[e]);i.length=0,n.length=0},restore:function(){i.length=0,n.length=0}}},ho=16384,fo=256,mo=1024,vo=34962,bo="webglcontextlost",go="webglcontextrestored",yo=1,wo=2,_o=3;function xo(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}return function(n){var r=G(n);if(!r)return null;var i=r.gl,o=i.getContextAttributes(),a=i.isContextLost(),s=function(e,t){var n={};function r(t){O.type(t,"string","extension name must be string");var r,i=t.toLowerCase();try{r=n[i]=e.getExtension(i)}catch(e){}return!!r}for(var i=0;i<t.extensions.length;++i){var o=t.extensions[i];if(!r(o))return t.onDestroy(),t.onDone('"'+o+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return t.optionalExtensions.forEach(r),{extensions:n,restore:function(){Object.keys(n).forEach(function(e){if(n[e]&&!r(e))throw new Error("(regl): error restoring extension "+e)})}}}(i,r);if(!s)return null;var l,u,c=(l={"":0},u=[""],{id:function(e){var t=l[e];return t||(t=l[e]=u.length,u.push(e),t)},str:function(e){return u[e]}}),p={vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},h=s.extensions,f=po(i,h),d=q(),m=i.drawingBufferWidth,v=i.drawingBufferHeight,b={tick:0,time:0,viewportWidth:m,viewportHeight:v,framebufferWidth:m,framebufferHeight:v,drawingBufferWidth:m,drawingBufferHeight:v,pixelRatio:r.pixelRatio},g=ie(i,h),y=function(t,n,r,i){var o=0,a={};function s(e){this.id=o++,this.buffer=t.createBuffer(),this.type=e,this.usage=de,this.byteLength=0,this.dimension=1,this.dtype=ve,this.persistentData=null,r.profile&&(this.stats={size:0})}s.prototype.bind=function(){t.bindBuffer(this.type,this.buffer)},s.prototype.destroy=function(){p(this)};var l=[];function u(e,n,r){e.byteLength=n.byteLength,t.bufferData(e.type,n,r)}function c(t,n,r,i,o,a){var s,l;if(t.usage=r,Array.isArray(n)){if(t.dtype=i||be,n.length>0)if(Array.isArray(n[0])){s=fe(n);for(var c=1,p=1;p<s.length;++p)c*=s[p];t.dimension=c,u(t,l=he(n,s,t.dtype),r),a?t.persistentData=l:re.freeType(l)}else if("number"==typeof n[0]){t.dimension=o;var h=re.allocType(t.dtype,n.length);we(h,n),u(t,h,r),a?t.persistentData=h:re.freeType(h)}else e(n[0])?(t.dimension=n[0].length,t.dtype=i||ye(n[0])||be,u(t,l=he(n,[n.length,n[0].length],t.dtype),r),a?t.persistentData=l:re.freeType(l)):O.raise("invalid buffer data")}else if(e(n))t.dtype=i||ye(n),t.dimension=o,u(t,n,r),a&&(t.persistentData=new Uint8Array(new Uint8Array(n.buffer)));else if(oe(n)){var f=n.stride,d=n.offset,m=0,v=0,b=0,g=0;1===(s=n.shape).length?(m=s[0],v=1,b=f[0],g=0):2===s.length?(m=s[0],v=s[1],b=f[0],g=f[1]):O.raise("invalid shape"),t.dtype=i||ye(n.data)||be,t.dimension=v;var y=re.allocType(t.dtype,m*v);_e(y,n.data,m,v,b,g,d),u(t,y,r),a?t.persistentData=y:re.freeType(y)}else n instanceof ArrayBuffer?(t.dtype=ve,t.dimension=o,u(t,n,r),a&&(t.persistentData=new Uint8Array(new Uint8Array(n)))):O.raise("invalid buffer data")}function p(e){n.bufferCount--,i(e);var r=e.buffer;O(r,"buffer must not be deleted already"),t.deleteBuffer(r),e.buffer=null,delete a[e.id]}return r.profile&&(n.getTotalBufferSize=function(){var e=0;return Object.keys(a).forEach(function(t){e+=a[t].stats.size}),e}),{create:function(i,o,l,u){n.bufferCount++;var h=new s(o);function f(n){var i=de,o=null,a=0,s=0,l=1;return Array.isArray(n)||e(n)||oe(n)||n instanceof ArrayBuffer?o=n:"number"==typeof n?a=0|n:n&&(O.type(n,"object","buffer arguments must be an object, a number or an array"),"data"in n&&(O(null===o||Array.isArray(o)||e(o)||oe(o),"invalid data for buffer"),o=n.data),"usage"in n&&(O.parameter(n.usage,pe,"invalid buffer usage"),i=pe[n.usage]),"type"in n&&(O.parameter(n.type,ce,"invalid buffer type"),s=ce[n.type]),"dimension"in n&&(O.type(n.dimension,"number","invalid dimension"),l=0|n.dimension),"length"in n&&(O.nni(a,"buffer length must be a nonnegative integer"),a=0|n.length)),h.bind(),o?c(h,o,i,s,l,u):(a&&t.bufferData(h.type,a,i),h.dtype=s||ve,h.usage=i,h.dimension=l,h.byteLength=a),r.profile&&(h.stats.size=h.byteLength*ge[h.dtype]),f}function d(e,n){O(n+e.byteLength<=h.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+e.byteLength+" starting from offset "+n+" to a buffer of size "+h.byteLength),t.bufferSubData(h.type,n,e)}return a[h.id]=h,l||f(i),f._reglType="buffer",f._buffer=h,f.subdata=function(t,n){var r,i=0|(n||0);if(h.bind(),e(t)||t instanceof ArrayBuffer)d(t,i);else if(Array.isArray(t)){if(t.length>0)if("number"==typeof t[0]){var o=re.allocType(h.dtype,t.length);we(o,t),d(o,i),re.freeType(o)}else if(Array.isArray(t[0])||e(t[0])){r=fe(t);var a=he(t,r,h.dtype);d(a,i),re.freeType(a)}else O.raise("invalid buffer data")}else if(oe(t)){var s=t.stride,l=0,u=0,c=0,p=0;1===(r=t.shape).length?(l=r[0],u=1,c=s[0],p=0):2===r.length?(l=r[0],u=r[1],c=s[0],p=s[1]):O.raise("invalid shape");var m=Array.isArray(t.data)?h.dtype:ye(t.data),v=re.allocType(m,l*u);_e(v,t.data,l,u,c,p,t.offset),d(v,i),re.freeType(v)}else O.raise("invalid data for buffer subdata");return f},r.profile&&(f.stats=h.stats),f.destroy=function(){p(h)},f},createStream:function(e,t){var n=l.pop();return n||(n=new s(e)),n.bind(),c(n,t,me,0,1,!1),n},destroyStream:function(e){l.push(e)},clear:function(){ae(a).forEach(p),l.forEach(p)},getBuffer:function(e){return e&&e._buffer instanceof s?e._buffer:null},restore:function(){ae(a).forEach(function(e){e.buffer=t.createBuffer(),t.bindBuffer(e.type,e.buffer),t.bufferData(e.type,e.persistentData||e.byteLength,e.usage)})},_initBuffer:c}}(i,p,r,function(e){return w.destroyBuffer(e)}),w=function(t,n,r,i,o){for(var a=r.maxAttributes,s=new Array(a),l=0;l<a;++l)s[l]=new Hn;var u=0,c={},p={Record:Hn,scope:{},state:s,currentVAO:null,targetVAO:null,restore:h()?function(){h()&&ae(c).forEach(function(e){e.refresh()})}:function(){},createVAO:function(t){var r=new d;function s(t){O(Array.isArray(t),"arguments to vertex array constructor must be an array"),O(t.length<a,"too many attributes"),O(t.length>0,"must specify at least one attribute");var i={},l=r.attributes;l.length=t.length;for(var u=0;u<t.length;++u){var c,p=t[u],h=l[u]=new Hn,f=p.data||p;Array.isArray(f)||e(f)||oe(f)?(r.buffers[u]&&(c=r.buffers[u],e(f)&&c._buffer.byteLength>=f.byteLength?c.subdata(f):(c.destroy(),r.buffers[u]=null)),r.buffers[u]||(c=r.buffers[u]=o.create(p,qn,!1,!0)),h.buffer=o.getBuffer(c),h.size=0|h.buffer.dimension,h.normalized=!1,h.type=h.buffer.dtype,h.offset=0,h.stride=0,h.divisor=0,h.state=1,i[u]=1):o.getBuffer(p)?(h.buffer=o.getBuffer(p),h.size=0|h.buffer.dimension,h.normalized=!1,h.type=h.buffer.dtype,h.offset=0,h.stride=0,h.divisor=0,h.state=1):o.getBuffer(p.buffer)?(h.buffer=o.getBuffer(p.buffer),h.size=0|(+p.size||h.buffer.dimension),h.normalized=!!p.normalized||!1,"type"in p?(O.parameter(p.type,ce,"invalid buffer type"),h.type=ce[p.type]):h.type=h.buffer.dtype,h.offset=0|(p.offset||0),h.stride=0|(p.stride||0),h.divisor=0|(p.divisor||0),h.state=1,O(h.size>=1&&h.size<=4,"size must be between 1 and 4"),O(h.offset>=0,"invalid offset"),O(h.stride>=0&&h.stride<=255,"stride must be between 0 and 255"),O(h.divisor>=0,"divisor must be positive"),O(!h.divisor||!!n.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in p?(O(u>0,"first attribute must not be a constant"),h.x=+p.x||0,h.y=+p.y||0,h.z=+p.z||0,h.w=+p.w||0,h.state=2):O(!1,"invalid attribute spec for location "+u)}for(var d=0;d<r.buffers.length;++d)!i[d]&&r.buffers[d]&&(r.buffers[d].destroy(),r.buffers[d]=null);return r.refresh(),s}return i.vaoCount+=1,s.destroy=function(){for(var e=0;e<r.buffers.length;++e)r.buffers[e]&&r.buffers[e].destroy();r.buffers.length=0,r.destroy()},s._vao=r,s._reglType="vao",s(t)},getVAO:function(e){return"function"==typeof e&&e._vao?e._vao:null},destroyBuffer:function(e){for(var n=0;n<s.length;++n){var r=s[n];r.buffer===e&&(t.disableVertexAttribArray(n),r.buffer=null)}},setVAO:h()?function(e){if(e!==p.currentVAO){var t=h();t.bindVertexArrayOES(e?e.vao:null),p.currentVAO=e}}:function(e){if(e!==p.currentVAO){if(e)e.bindAttrs();else for(var n=f(),r=0;r<s.length;++r){var i=s[r];i.buffer?(t.enableVertexAttribArray(r),t.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offfset),n&&i.divisor&&n.vertexAttribDivisorANGLE(r,i.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}p.currentVAO=e}},clear:h()?function(){ae(c).forEach(function(e){e.destroy()})}:function(){}};function h(){return n.oes_vertex_array_object}function f(){return n.angle_instanced_arrays}function d(){this.id=++u,this.attributes=[];var e=h();this.vao=e?e.createVertexArrayOES():null,c[this.id]=this,this.buffers=[]}return d.prototype.bindAttrs=function(){for(var e=f(),n=this.attributes,r=0;r<n.length;++r){var i=n[r];i.buffer?(t.enableVertexAttribArray(r),t.bindBuffer(qn,i.buffer.buffer),t.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offset),e&&i.divisor&&e.vertexAttribDivisorANGLE(r,i.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}for(var o=n.length;o<a;++o)t.disableVertexAttribArray(o)},d.prototype.refresh=function(){var e=h();e&&(e.bindVertexArrayOES(this.vao),this.bindAttrs(),p.currentVAO=this)},d.prototype.destroy=function(){if(this.vao){var e=h();this===p.currentVAO&&(p.currentVAO=null,e.bindVertexArrayOES(null)),e.deleteVertexArrayOES(this.vao),this.vao=null}c[this.id]&&(delete c[this.id],i.vaoCount-=1)},p}(i,h,g,p,y),_=function(t,n,r,i){var o={},a=0,s={uint8:Pe,uint16:Se};function l(e){this.id=a++,o[this.id]=this,this.buffer=e,this.primType=Ee,this.vertCount=0,this.type=0}n.oes_element_index_uint&&(s.uint32=Ve),l.prototype.bind=function(){this.buffer.bind()};var u=[];function c(i,o,a,s,l,u,c){var p;if(i.buffer.bind(),o){var h=c;c||e(o)&&(!oe(o)||e(o.data))||(h=n.oes_element_index_uint?Ve:Se),r._initBuffer(i.buffer,o,a,h,3)}else t.bufferData(je,u,a),i.buffer.dtype=p||Pe,i.buffer.usage=a,i.buffer.dimension=3,i.buffer.byteLength=u;if(p=c,!c){switch(i.buffer.dtype){case Pe:case Ae:p=Pe;break;case Se:case Me:p=Se;break;case Ve:case Te:p=Ve;break;default:O.raise("unsupported type for element array")}i.buffer.dtype=p}i.type=p,O(p!==Ve||!!n.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var f=l;f<0&&(f=i.buffer.byteLength,p===Se?f>>=1:p===Ve&&(f>>=2)),i.vertCount=f;var d=s;if(s<0){d=Ee;var m=i.buffer.dimension;1===m&&(d=ke),2===m&&(d=Ce),3===m&&(d=Ee)}i.primType=d}function p(e){i.elementsCount--,O(null!==e.buffer,"must not double destroy elements"),delete o[e.id],e.buffer.destroy(),e.buffer=null}return{create:function(t,n){var o=r.create(null,je,!0),a=new l(o._buffer);function u(t){if(t)if("number"==typeof t)o(t),a.primType=Ee,a.vertCount=0|t,a.type=Pe;else{var n=null,r=De,i=-1,l=-1,p=0,h=0;Array.isArray(t)||e(t)||oe(t)?n=t:(O.type(t,"object","invalid arguments for elements"),"data"in t&&(n=t.data,O(Array.isArray(n)||e(n)||oe(n),"invalid data for element buffer")),"usage"in t&&(O.parameter(t.usage,pe,"invalid element buffer usage"),r=pe[t.usage]),"primitive"in t&&(O.parameter(t.primitive,xe,"invalid element buffer primitive"),i=xe[t.primitive]),"count"in t&&(O("number"==typeof t.count&&t.count>=0,"invalid vertex count for elements"),l=0|t.count),"type"in t&&(O.parameter(t.type,s,"invalid buffer type"),h=s[t.type]),"length"in t?p=0|t.length:(p=l,h===Se||h===Me?p*=2:h!==Ve&&h!==Te||(p*=4))),c(a,n,r,i,l,p,h)}else o(),a.primType=Ee,a.vertCount=0,a.type=Pe;return u}return i.elementsCount++,u(t),u._reglType="elements",u._elements=a,u.subdata=function(e,t){return o.subdata(e,t),u},u.destroy=function(){p(a)},u},createStream:function(e){var t=u.pop();return t||(t=new l(r.create(null,je,!0,!1)._buffer)),c(t,e,Oe,-1,-1,0,0),t},destroyStream:function(e){u.push(e)},getElements:function(e){return"function"==typeof e&&e._elements instanceof l?e._elements:null},clear:function(){ae(o).forEach(p)}}}(i,h,y,p),x=function(e,n,r,i){var o={},a={};function s(e,t,n,r){this.name=e,this.id=t,this.location=n,this.info=r}function l(e,t){for(var n=0;n<e.length;++n)if(e[n].id===t.id)return void(e[n].location=t.location);e.push(t)}function u(t,r,i){var s=t===Kn?o:a,l=s[r];if(!l){var u=n.str(r);l=e.createShader(t),e.shaderSource(l,u),e.compileShader(l),O.shaderError(e,l,u,t,i),s[r]=l}return l}var c={},p=[],h=0;function f(e,t){this.id=h++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,i.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function d(t,r,o){var a,c,p=u(Kn,t.fragId),h=u(Gn,t.vertId),f=t.program=e.createProgram();if(e.attachShader(f,p),e.attachShader(f,h),o)for(a=0;a<o.length;++a){var d=o[a];e.bindAttribLocation(f,d[0],d[1])}e.linkProgram(f),O.linkError(e,f,n.str(t.fragId),n.str(t.vertId),r);var m=e.getProgramParameter(f,$n);i.profile&&(t.stats.uniformsCount=m);var v=t.uniforms;for(a=0;a<m;++a)if(c=e.getActiveUniform(f,a))if(c.size>1)for(var b=0;b<c.size;++b){var g=c.name.replace("[0]","["+b+"]");l(v,new s(g,n.id(g),e.getUniformLocation(f,g),c))}else l(v,new s(c.name,n.id(c.name),e.getUniformLocation(f,c.name),c));var y=e.getProgramParameter(f,Wn);i.profile&&(t.stats.attributesCount=y);var w=t.attributes;for(a=0;a<y;++a)(c=e.getActiveAttrib(f,a))&&l(w,new s(c.name,n.id(c.name),e.getAttribLocation(f,c.name),c))}return i.profile&&(r.getMaxUniformsCount=function(){var e=0;return p.forEach(function(t){t.stats.uniformsCount>e&&(e=t.stats.uniformsCount)}),e},r.getMaxAttributesCount=function(){var e=0;return p.forEach(function(t){t.stats.attributesCount>e&&(e=t.stats.attributesCount)}),e}),{clear:function(){var t=e.deleteShader.bind(e);ae(o).forEach(t),o={},ae(a).forEach(t),a={},p.forEach(function(t){e.deleteProgram(t.program)}),p.length=0,c={},r.shaderCount=0},program:function(n,i,s,l){O.command(n>=0,"missing vertex shader",s),O.command(i>=0,"missing fragment shader",s);var u=c[i];u||(u=c[i]={});var h=u[n];if(h&&(h.refCount++,!l))return h;var m=new f(i,n);return r.shaderCount++,d(m,s,l),h||(u[n]=m),p.push(m),t(m,{destroy:function(){if(m.refCount--,m.refCount<=0){e.deleteProgram(m.program);var t=p.indexOf(m);p.splice(t,1),r.shaderCount--}u[m.vertId].refCount<=0&&(e.deleteShader(a[m.vertId]),delete a[m.vertId],delete c[m.fragId][m.vertId]),Object.keys(c[m.fragId]).length||(e.deleteShader(o[m.fragId]),delete o[m.fragId],delete c[m.fragId])}})},restore:function(){o={},a={};for(var e=0;e<p.length;++e)d(p[e],null,p[e].attributes.map(function(e){return[e.location,e.name]}))},shader:u,frag:-1,vert:-1}}(i,c,p,r),k=gn(i,h,g,function(){A.procs.poll()},b,p,r),C=kn(i,h,g,p,r),E=function(e,n,r,i,o,a){var s={cur:null,next:null,dirty:!1,setFBO:null},l=["rgba"],u=["rgba4","rgb565","rgb5 a1"];n.ext_srgb&&u.push("srgba"),n.ext_color_buffer_half_float&&u.push("rgba16f","rgb16f"),n.webgl_color_buffer_float&&u.push("rgba32f");var c=["uint8"];function p(e,t,n){this.target=e,this.texture=t,this.renderbuffer=n;var r=0,i=0;t?(r=t.width,i=t.height):n&&(r=n.width,i=n.height),this.width=r,this.height=i}function h(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function f(e,t,n){if(e)if(e.texture){var r=e.texture._texture,i=Math.max(1,r.width),o=Math.max(1,r.height);O(i===t&&o===n,"inconsistent width/height for supplied texture"),r.refCount+=1}else{var a=e.renderbuffer._renderbuffer;O(a.width===t&&a.height===n,"inconsistent width/height for renderbuffer"),a.refCount+=1}}function d(t,n){n&&(n.texture?e.framebufferTexture2D(Cn,t,n.target,n.texture._texture.texture,0):e.framebufferRenderbuffer(Cn,t,En,n.renderbuffer._renderbuffer.renderbuffer))}function m(e){var t=An,n=null,r=null,i=e;"object"==typeof e&&(i=e.data,"target"in e&&(t=0|e.target)),O.type(i,"function","invalid attachment data");var o=i._reglType;return"texture2d"===o?(n=i,O(t===An)):"textureCube"===o?(n=i,O(t>=Pn&&t<Pn+6,"invalid cube map target")):"renderbuffer"===o?(r=i,t=En):O.raise("invalid regl object for attachment"),new p(t,n,r)}function v(e,t,n,r,a){if(n){var s=i.create2D({width:e,height:t,format:r,type:a});return s._texture.refCount=0,new p(An,s,null)}var l=o.create({width:e,height:t,format:r});return l._renderbuffer.refCount=0,new p(En,null,l)}function b(e){return e&&(e.texture||e.renderbuffer)}function g(e,t,n){e&&(e.texture?e.texture.resize(t,n):e.renderbuffer&&e.renderbuffer.resize(t,n),e.width=t,e.height=n)}n.oes_texture_half_float&&c.push("half float","float16"),n.oes_texture_float&&c.push("float","float32");var y=0,w={};function _(){this.id=y++,w[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function x(e){e.colorAttachments.forEach(h),h(e.depthAttachment),h(e.stencilAttachment),h(e.depthStencilAttachment)}function k(t){var n=t.framebuffer;O(n,"must not double destroy framebuffer"),e.deleteFramebuffer(n),t.framebuffer=null,a.framebufferCount--,delete w[t.id]}function C(t){var n;e.bindFramebuffer(Cn,t.framebuffer);var i=t.colorAttachments;for(n=0;n<i.length;++n)d(Mn+n,i[n]);for(n=i.length;n<r.maxColorAttachments;++n)e.framebufferTexture2D(Cn,Mn+n,An,null,0);e.framebufferTexture2D(Cn,Vn,An,null,0),e.framebufferTexture2D(Cn,Sn,An,null,0),e.framebufferTexture2D(Cn,Tn,An,null,0),d(Sn,t.depthAttachment),d(Tn,t.stencilAttachment),d(Vn,t.depthStencilAttachment);var o=e.checkFramebufferStatus(Cn);e.isContextLost()||o===jn||O.raise("framebuffer configuration not supported, status = "+Un[o]),e.bindFramebuffer(Cn,s.next?s.next.framebuffer:null),s.cur=s.next,e.getError()}function E(e,i){var o=new _;function p(e,t){var i;O(s.next!==o,"can not update framebuffer which is currently in use");var a=0,h=0,d=!0,g=!0,y=null,w=!0,_="rgba",k="uint8",E=1,A=null,P=null,M=null,S=!1;if("number"==typeof e)a=0|e,h=0|t||a;else if(e){O.type(e,"object","invalid arguments for framebuffer");var T=e;if("shape"in T){var V=T.shape;O(Array.isArray(V)&&V.length>=2,"invalid shape for framebuffer"),a=V[0],h=V[1]}else"radius"in T&&(a=h=T.radius),"width"in T&&(a=T.width),"height"in T&&(h=T.height);("color"in T||"colors"in T)&&(y=T.color||T.colors,Array.isArray(y)&&O(1===y.length||n.webgl_draw_buffers,"multiple render targets not supported")),y||("colorCount"in T&&O((E=0|T.colorCount)>0,"invalid color buffer count"),"colorTexture"in T&&(w=!!T.colorTexture,_="rgba4"),"colorType"in T&&(k=T.colorType,w?(O(n.oes_texture_float||!("float"===k||"float32"===k),"you must enable OES_texture_float in order to use floating point framebuffer objects"),O(n.oes_texture_half_float||!("half float"===k||"float16"===k),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===k||"float16"===k?(O(n.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),_="rgba16f"):"float"!==k&&"float32"!==k||(O(n.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),_="rgba32f"),O.oneOf(k,c,"invalid color type")),"colorFormat"in T&&(l.indexOf(_=T.colorFormat)>=0?w=!0:u.indexOf(_)>=0?w=!1:w?O.oneOf(T.colorFormat,l,"invalid color format for texture"):O.oneOf(T.colorFormat,u,"invalid color format for renderbuffer"))),("depthTexture"in T||"depthStencilTexture"in T)&&O(!(S=!(!T.depthTexture&&!T.depthStencilTexture))||n.webgl_depth_texture,"webgl_depth_texture extension not supported"),"depth"in T&&("boolean"==typeof T.depth?d=T.depth:(A=T.depth,g=!1)),"stencil"in T&&("boolean"==typeof T.stencil?g=T.stencil:(P=T.stencil,d=!1)),"depthStencil"in T&&("boolean"==typeof T.depthStencil?d=g=T.depthStencil:(M=T.depthStencil,d=!1,g=!1))}else a=h=1;var j=null,D=null,L=null,R=null;if(Array.isArray(y))j=y.map(m);else if(y)j=[m(y)];else for(j=new Array(E),i=0;i<E;++i)j[i]=v(a,h,w,_,k);O(n.webgl_draw_buffers||j.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),O(j.length<=r.maxColorAttachments,"too many color attachments, not supported"),a=a||j[0].width,h=h||j[0].height,A?D=m(A):d&&!g&&(D=v(a,h,S,"depth","uint32")),P?L=m(P):g&&!d&&(L=v(a,h,!1,"stencil","uint8")),M?R=m(M):!A&&!P&&g&&d&&(R=v(a,h,S,"depth stencil","depth stencil")),O(!!A+!!P+!!M<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var I=null;for(i=0;i<j.length;++i)if(f(j[i],a,h),O(!j[i]||j[i].texture&&Dn.indexOf(j[i].texture._texture.format)>=0||j[i].renderbuffer&&zn.indexOf(j[i].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+i+" is invalid"),j[i]&&j[i].texture){var B=Ln[j[i].texture._texture.format]*Rn[j[i].texture._texture.type];null===I?I=B:O(I===B,"all color attachments much have the same number of bits per pixel.")}return f(D,a,h),O(!D||D.texture&&D.texture._texture.format===On||D.renderbuffer&&D.renderbuffer._renderbuffer.format===In,"invalid depth attachment for framebuffer object"),f(L,a,h),O(!L||L.renderbuffer&&L.renderbuffer._renderbuffer.format===Bn,"invalid stencil attachment for framebuffer object"),f(R,a,h),O(!R||R.texture&&R.texture._texture.format===Fn||R.renderbuffer&&R.renderbuffer._renderbuffer.format===Fn,"invalid depth-stencil attachment for framebuffer object"),x(o),o.width=a,o.height=h,o.colorAttachments=j,o.depthAttachment=D,o.stencilAttachment=L,o.depthStencilAttachment=R,p.color=j.map(b),p.depth=b(D),p.stencil=b(L),p.depthStencil=b(R),p.width=o.width,p.height=o.height,C(o),p}return a.framebufferCount++,p(e,i),t(p,{resize:function(e,t){O(s.next!==o,"can not resize a framebuffer which is currently in use");var n=Math.max(0|e,1),r=Math.max(0|t||n,1);if(n===o.width&&r===o.height)return p;for(var i=o.colorAttachments,a=0;a<i.length;++a)g(i[a],n,r);return g(o.depthAttachment,n,r),g(o.stencilAttachment,n,r),g(o.depthStencilAttachment,n,r),o.width=p.width=n,o.height=p.height=r,C(o),p},_reglType:"framebuffer",_framebuffer:o,destroy:function(){k(o),x(o)},use:function(e){s.setFBO({framebuffer:p},e)}})}return t(s,{getFramebuffer:function(e){if("function"==typeof e&&"framebuffer"===e._reglType){var t=e._framebuffer;if(t instanceof _)return t}return null},create:E,createCube:function(e){var o=Array(6);function a(e){var r;O(o.indexOf(s.next)<0,"can not update framebuffer which is currently in use");var u,p={color:null},h=0,f=null,d="rgba",m="uint8",v=1;if("number"==typeof e)h=0|e;else if(e){O.type(e,"object","invalid arguments for framebuffer");var b=e;if("shape"in b){var g=b.shape;O(Array.isArray(g)&&g.length>=2,"invalid shape for framebuffer"),O(g[0]===g[1],"cube framebuffer must be square"),h=g[0]}else"radius"in b&&(h=0|b.radius),"width"in b?(h=0|b.width,"height"in b&&O(b.height===h,"must be square")):"height"in b&&(h=0|b.height);("color"in b||"colors"in b)&&(f=b.color||b.colors,Array.isArray(f)&&O(1===f.length||n.webgl_draw_buffers,"multiple render targets not supported")),f||("colorCount"in b&&O((v=0|b.colorCount)>0,"invalid color buffer count"),"colorType"in b&&(O.oneOf(b.colorType,c,"invalid color type"),m=b.colorType),"colorFormat"in b&&(d=b.colorFormat,O.oneOf(b.colorFormat,l,"invalid color format for texture"))),"depth"in b&&(p.depth=b.depth),"stencil"in b&&(p.stencil=b.stencil),"depthStencil"in b&&(p.depthStencil=b.depthStencil)}else h=1;if(f)if(Array.isArray(f))for(u=[],r=0;r<f.length;++r)u[r]=f[r];else u=[f];else{u=Array(v);var y={radius:h,format:d,type:m};for(r=0;r<v;++r)u[r]=i.createCube(y)}for(p.color=Array(u.length),r=0;r<u.length;++r){var w=u[r];O("function"==typeof w&&"textureCube"===w._reglType,"invalid cube map"),O(w.width===(h=h||w.width)&&w.height===h,"invalid cube map shape"),p.color[r]={target:Pn,data:u[r]}}for(r=0;r<6;++r){for(var _=0;_<u.length;++_)p.color[_].target=Pn+r;r>0&&(p.depth=o[0].depth,p.stencil=o[0].stencil,p.depthStencil=o[0].depthStencil),o[r]?o[r](p):o[r]=E(p)}return t(a,{width:h,height:h,color:u})}return a(e),t(a,{faces:o,resize:function(e){var t,n=0|e;if(O(n>0&&n<=r.maxCubeMapSize,"invalid radius for cube fbo"),n===a.width)return a;var i=a.color;for(t=0;t<i.length;++t)i[t].resize(n);for(t=0;t<6;++t)o[t].resize(n);return a.width=a.height=n,a},_reglType:"framebufferCube",destroy:function(){o.forEach(function(e){e.destroy()})}})},clear:function(){ae(w).forEach(k)},restore:function(){s.cur=null,s.next=null,s.dirty=!0,ae(w).forEach(function(t){t.framebuffer=e.createFramebuffer(),C(t)})}})}(i,h,g,k,C,p),A=so(i,c,h,g,y,_,0,E,{},w,x,{elements:null,primitive:4,count:-1,offset:0,instances:-1},b,f,r),P=Zn(i,E,A.procs.poll,b,o,h,g),M=A.next,S=i.canvas,T=[],V=[],j=[],D=[r.onDestroy],L=null;function R(){if(0===T.length)return f&&f.update(),void(L=null);L=N.next(R),Q();for(var e=T.length-1;e>=0;--e){var t=T[e];t&&t(b,null,0)}i.flush(),f&&f.update()}function I(){!L&&T.length>0&&(L=N.next(R))}function B(){L&&(N.cancel(R),L=null)}function F(e){e.preventDefault(),a=!0,B(),V.forEach(function(e){e()})}function z(e){i.getError(),a=!1,s.restore(),x.restore(),y.restore(),k.restore(),C.restore(),E.restore(),w.restore(),f&&f.restore(),A.procs.refresh(),I(),j.forEach(function(e){e()})}function H(e){function n(e,t){var n={},r={};return Object.keys(e).forEach(function(i){var o=e[i];if(U.isDynamic(o))r[i]=U.unbox(o,i);else{if(t&&Array.isArray(o))for(var a=0;a<o.length;++a)if(U.isDynamic(o[a]))return void(r[i]=U.unbox(o,i));n[i]=o}}),{dynamic:r,static:n}}O(!!e,"invalid args to regl({...})"),O.type(e,"object","invalid args to regl({...})");var r=n(e.context||{},!0),i=n(e.uniforms||{},!0),o=n(e.attributes||{},!1),s=n(function(e){var n=t({},e);function r(e){if(e in n){var t=n[e];delete n[e],Object.keys(t).forEach(function(r){n[e+"."+r]=t[r]})}}return delete n.uniforms,delete n.attributes,delete n.context,delete n.vao,"stencil"in n&&n.stencil.op&&(n.stencil.opBack=n.stencil.opFront=n.stencil.op,delete n.stencil.op),r("blend"),r("depth"),r("cull"),r("stencil"),r("polygonOffset"),r("scissor"),r("sample"),"vao"in e&&(n.vao=e.vao),n}(e),!1),l={gpuTime:0,cpuTime:0,count:0},u=A.compile(s,o,i,r,l),c=u.draw,p=u.batch,h=u.scope,f=[];return t(function(e,t){var n;if(a&&O.raise("context lost"),"function"==typeof e)return h.call(this,null,e,0);if("function"==typeof t)if("number"==typeof e)for(n=0;n<e;++n)h.call(this,null,t,n);else{if(!Array.isArray(e))return h.call(this,e,t,0);for(n=0;n<e.length;++n)h.call(this,e[n],t,n)}else if("number"==typeof e){if(e>0)return p.call(this,function(e){for(;f.length<e;)f.push(null);return f}(0|e),0|e)}else{if(!Array.isArray(e))return c.call(this,e);if(e.length)return p.call(this,e,e.length)}},{stats:l,destroy:function(){u.destroy()}})}S&&(S.addEventListener(bo,F,!1),S.addEventListener(go,z,!1));var K=E.setFBO=H({framebuffer:U.define.call(null,yo,"framebuffer")});function $(e,t){var n=0;A.procs.poll();var r=t.color;r&&(i.clearColor(+r[0]||0,+r[1]||0,+r[2]||0,+r[3]||0),n|=ho),"depth"in t&&(i.clearDepth(+t.depth),n|=fo),"stencil"in t&&(i.clearStencil(0|t.stencil),n|=mo),O(!!n,"called regl.clear with no buffer specified"),i.clear(n)}function W(e){return O.type(e,"function","regl.frame() callback must be a function"),T.push(e),I(),{cancel:function(){var t=xo(T,e);O(t>=0,"cannot cancel a frame twice"),T[t]=function e(){var t=xo(T,e);T[t]=T[T.length-1],T.length-=1,T.length<=0&&B()}}}}function Y(){var e=M.viewport,t=M.scissor_box;e[0]=e[1]=t[0]=t[1]=0,b.viewportWidth=b.framebufferWidth=b.drawingBufferWidth=e[2]=t[2]=i.drawingBufferWidth,b.viewportHeight=b.framebufferHeight=b.drawingBufferHeight=e[3]=t[3]=i.drawingBufferHeight}function Q(){b.tick+=1,b.time=J(),Y(),A.procs.poll()}function X(){k.refresh(),Y(),A.procs.refresh(),f&&f.update()}function J(){return(q()-d)/1e3}X();var Z=t(H,{clear:function(e){if(O("object"==typeof e&&e,"regl.clear() takes an object as input"),"framebuffer"in e)if(e.framebuffer&&"framebufferCube"===e.framebuffer_reglType)for(var n=0;n<6;++n)K(t({framebuffer:e.framebuffer.faces[n]},e),$);else K(e,$);else $(0,e)},prop:U.define.bind(null,yo),context:U.define.bind(null,wo),this:U.define.bind(null,_o),draw:H({}),buffer:function(e){return y.create(e,vo,!1,!1)},elements:function(e){return _.create(e,!1)},texture:k.create2D,cube:k.createCube,renderbuffer:C.create,framebuffer:E.create,framebufferCube:E.createCube,vao:w.createVAO,attributes:o,frame:W,on:function(e,t){var n;switch(O.type(t,"function","listener callback must be a function"),e){case"frame":return W(t);case"lost":n=V;break;case"restore":n=j;break;case"destroy":n=D;break;default:O.raise("invalid event, must be one of frame,lost,restore,destroy")}return n.push(t),{cancel:function(){for(var e=0;e<n.length;++e)if(n[e]===t)return n[e]=n[n.length-1],void n.pop()}}},limits:g,hasExtension:function(e){return g.extensions.indexOf(e.toLowerCase())>=0},read:P,destroy:function(){T.length=0,B(),S&&(S.removeEventListener(bo,F),S.removeEventListener(go,z)),x.clear(),E.clear(),C.clear(),k.clear(),_.clear(),y.clear(),w.clear(),f&&f.clear(),D.forEach(function(e){e()})},_gl:i,_refresh:X,poll:function(){Q(),f&&f.update()},now:J,stats:p});return r.onDone(null,Z),Z}},"object"==typeof n&&void 0!==t?t.exports=i():"function"==typeof define&&define.amd?define(i):r.createREGL=i()},{}],29:[function(e,t,n){!function(){"use strict";var e=.5*(Math.sqrt(3)-1),r=(3-Math.sqrt(3))/6,i=1/6,o=(Math.sqrt(5)-1)/4,a=(5-Math.sqrt(5))/20;function s(e){var t;t="function"==typeof e?e:e?function(){var e=0,t=0,n=0,r=1,i=(o=4022871197,function(e){e=e.toString();for(var t=0;t<e.length;t++){var n=.02519603282416938*(o+=e.charCodeAt(t));n-=o=n>>>0,o=(n*=o)>>>0,o+=4294967296*(n-=o)}return 2.3283064365386963e-10*(o>>>0)});var o;e=i(" "),t=i(" "),n=i(" ");for(var a=0;a<arguments.length;a++)(e-=i(arguments[a]))<0&&(e+=1),(t-=i(arguments[a]))<0&&(t+=1),(n-=i(arguments[a]))<0&&(n+=1);return i=null,function(){var i=2091639*e+2.3283064365386963e-10*r;return e=t,t=n,n=i-(r=0|i)}}(e):Math.random,this.p=l(t),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(var n=0;n<512;n++)this.perm[n]=this.p[255&n],this.permMod12[n]=this.perm[n]%12}function l(e){var t,n=new Uint8Array(256);for(t=0;t<256;t++)n[t]=t;for(t=0;t<255;t++){var r=t+~~(e()*(256-t)),i=n[t];n[t]=n[r],n[r]=i}return n}s.prototype={grad3:new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),grad4:new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]),noise2D:function(t,n){var i,o,a=this.permMod12,s=this.perm,l=this.grad3,u=0,c=0,p=0,h=(t+n)*e,f=Math.floor(t+h),d=Math.floor(n+h),m=(f+d)*r,v=t-(f-m),b=n-(d-m);v>b?(i=1,o=0):(i=0,o=1);var g=v-i+r,y=b-o+r,w=v-1+2*r,_=b-1+2*r,x=255&f,k=255&d,C=.5-v*v-b*b;if(C>=0){var E=3*a[x+s[k]];u=(C*=C)*C*(l[E]*v+l[E+1]*b)}var A=.5-g*g-y*y;if(A>=0){var P=3*a[x+i+s[k+o]];c=(A*=A)*A*(l[P]*g+l[P+1]*y)}var M=.5-w*w-_*_;if(M>=0){var S=3*a[x+1+s[k+1]];p=(M*=M)*M*(l[S]*w+l[S+1]*_)}return 70*(u+c+p)},noise3D:function(e,t,n){var r,o,a,s,l,u,c,p,h,f,d=this.permMod12,m=this.perm,v=this.grad3,b=(e+t+n)*(1/3),g=Math.floor(e+b),y=Math.floor(t+b),w=Math.floor(n+b),_=(g+y+w)*i,x=e-(g-_),k=t-(y-_),C=n-(w-_);x>=k?k>=C?(l=1,u=0,c=0,p=1,h=1,f=0):x>=C?(l=1,u=0,c=0,p=1,h=0,f=1):(l=0,u=0,c=1,p=1,h=0,f=1):k<C?(l=0,u=0,c=1,p=0,h=1,f=1):x<C?(l=0,u=1,c=0,p=0,h=1,f=1):(l=0,u=1,c=0,p=1,h=1,f=0);var E=x-l+i,A=k-u+i,P=C-c+i,M=x-p+2*i,S=k-h+2*i,T=C-f+2*i,V=x-1+.5,j=k-1+.5,O=C-1+.5,D=255&g,L=255&y,R=255&w,I=.6-x*x-k*k-C*C;if(I<0)r=0;else{var B=3*d[D+m[L+m[R]]];r=(I*=I)*I*(v[B]*x+v[B+1]*k+v[B+2]*C)}var F=.6-E*E-A*A-P*P;if(F<0)o=0;else{var z=3*d[D+l+m[L+u+m[R+c]]];o=(F*=F)*F*(v[z]*E+v[z+1]*A+v[z+2]*P)}var U=.6-M*M-S*S-T*T;if(U<0)a=0;else{var N=3*d[D+p+m[L+h+m[R+f]]];a=(U*=U)*U*(v[N]*M+v[N+1]*S+v[N+2]*T)}var q=.6-V*V-j*j-O*O;if(q<0)s=0;else{var H=3*d[D+1+m[L+1+m[R+1]]];s=(q*=q)*q*(v[H]*V+v[H+1]*j+v[H+2]*O)}return 32*(r+o+a+s)},noise4D:function(e,t,n,r){var i,s,l,u,c,p,h,f,d,m,v,b,g,y,w,_,x,k=this.perm,C=this.grad4,E=(e+t+n+r)*o,A=Math.floor(e+E),P=Math.floor(t+E),M=Math.floor(n+E),S=Math.floor(r+E),T=(A+P+M+S)*a,V=e-(A-T),j=t-(P-T),O=n-(M-T),D=r-(S-T),L=0,R=0,I=0,B=0;V>j?L++:R++,V>O?L++:I++,V>D?L++:B++,j>O?R++:I++,j>D?R++:B++,O>D?I++:B++;var F=V-(p=L>=3?1:0)+a,z=j-(h=R>=3?1:0)+a,U=O-(f=I>=3?1:0)+a,N=D-(d=B>=3?1:0)+a,q=V-(m=L>=2?1:0)+2*a,H=j-(v=R>=2?1:0)+2*a,K=O-(b=I>=2?1:0)+2*a,G=D-(g=B>=2?1:0)+2*a,$=V-(y=L>=1?1:0)+3*a,W=j-(w=R>=1?1:0)+3*a,Y=O-(_=I>=1?1:0)+3*a,Q=D-(x=B>=1?1:0)+3*a,X=V-1+4*a,J=j-1+4*a,Z=O-1+4*a,ee=D-1+4*a,te=255&A,ne=255&P,re=255&M,ie=255&S,oe=.6-V*V-j*j-O*O-D*D;if(oe<0)i=0;else{var ae=k[te+k[ne+k[re+k[ie]]]]%32*4;i=(oe*=oe)*oe*(C[ae]*V+C[ae+1]*j+C[ae+2]*O+C[ae+3]*D)}var se=.6-F*F-z*z-U*U-N*N;if(se<0)s=0;else{var le=k[te+p+k[ne+h+k[re+f+k[ie+d]]]]%32*4;s=(se*=se)*se*(C[le]*F+C[le+1]*z+C[le+2]*U+C[le+3]*N)}var ue=.6-q*q-H*H-K*K-G*G;if(ue<0)l=0;else{var ce=k[te+m+k[ne+v+k[re+b+k[ie+g]]]]%32*4;l=(ue*=ue)*ue*(C[ce]*q+C[ce+1]*H+C[ce+2]*K+C[ce+3]*G)}var pe=.6-$*$-W*W-Y*Y-Q*Q;if(pe<0)u=0;else{var he=k[te+y+k[ne+w+k[re+_+k[ie+x]]]]%32*4;u=(pe*=pe)*pe*(C[he]*$+C[he+1]*W+C[he+2]*Y+C[he+3]*Q)}var fe=.6-X*X-J*J-Z*Z-ee*ee;if(fe<0)c=0;else{var de=k[te+1+k[ne+1+k[re+1+k[ie+1]]]]%32*4;c=(fe*=fe)*fe*(C[de]*X+C[de+1]*J+C[de+2]*Z+C[de+3]*ee)}return 27*(i+s+l+u+c)}},s._buildPermutationTable=l,"undefined"!=typeof define&&define.amd&&define(function(){return s}),void 0!==n?n.SimplexNoise=s:"undefined"!=typeof window&&(window.SimplexNoise=s),void 0!==t&&(t.exports=s)}()},{}],30:[function(e,t,n){var r=e("defined"),i=e("convert-length"),o=e("d3-path"),a=e("svg-path-contours"),s=e("parse-svg-path"),l=e("abs-svg-path"),u=e("normalize-svg-path"),c=e("./lib/optimize-penplot-paths"),p=e("./geometry"),h=.03,f="cm",d=90;function m(e,t){var n=w(e,t=t||{});return(Array.isArray(n)?n:[n]).filter(Boolean)}function v(e,t){var n;null!=(t=t||{}).curveResolution&&isFinite(t.curveResolution)&&"number"==typeof t.curveResolution?n=t.curveResolution:n=Math.max(1,i(4,t.units||"px","px"));var r=[];return _(e,function(e){if("string"==typeof e){var t=s(e);a(t,n).forEach(function(e){r.push(e)})}else{var i=e.map(function(e){return[e[0]||0,e[1]||0]});r.push(i)}}),r}function b(e,t){var n=(t=t||{}).width,o=t.height;if(void 0===n||void 0===o)throw new Error('Must specify "width" and "height" options');var a=t.units||"px",s={units:a,viewUnits:"px",roundPixel:!1,precision:r(t.precision,5),pixelsPerInch:d};if(e=v(e,Object.assign({},s,{curveResolution:t.curveResolution||void 0})),t.optimize){var l="object"==typeof t.optimize?t.optimize:{sort:!0,merge:!0,removeDuplicates:!0,removeCollinear:!0},u=!1!==l.sort,b=!1!==l.merge,y=!1!==l.removeCollinear;if(!1!==l.removeDuplicates&&(e=e.map(function(e){return p.removeDuplicatePoints(e)})),y&&(e=e.map(function(e){return p.removeCollinearPoints(e)})),u&&(e=c.sort(e)),b){var w=null!=l.mergeThreshold?l.mergeThreshold:i(.25,"mm",a,{pixelsPerInch:d});e=c.merge(e,w)}}var _=m(e,s),x=i(n,a,"px",s).toString(),k=i(o,a,"px",s).toString(),C=t.fillStyle||"none",E=t.strokeStyle||"black",A=t.lineWidth,P=t.lineJoin,M=t.lineCap;void 0===A&&(A=i(h,f,a,s).toString());var S=_.map(function(e){return"    <path "+g([["d",e]])+" />"}).join("\n");return['<?xml version="1.0" standalone="no"?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','    "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">','<svg width="'+n+a+'" height="'+o+a+'"','    xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 '+x+" "+k+'">',"  <g "+g([["fill",C],["stroke",E],["stroke-width",A+""+a],!!P&&["stroke-linejoin",P],!!M&&["stroke-linecap",M]])+">",S,"  </g>","</svg>"].join("\n")}function g(e){return e.filter(Boolean).map(function(e){return e[0]+'="'+e[1]+'"'}).join(" ")}function y(e,t){var n=(t=t||{}).context;if(!n)throw new Error('Must specify "context" options');var r=t.units||"px",o=t.width,a=t.height;if(void 0===o||void 0===a)throw new Error('Must specify "width" and "height" options');var s=t.lineWidth;return void 0===s&&(s=i(h,f,r,{roundPixel:!1,pixelsPerInch:d})),n.clearRect(0,0,o,a),n.fillStyle=t.background||"white",n.fillRect(0,0,o,a),n.strokeStyle=t.foreground||t.strokeStyle||"black",n.lineWidth=s,n.lineJoin=t.lineJoin||"miter",n.lineCap=t.lineCap||"butt",_(e,function(e){n.beginPath(),"string"==typeof e?x(n,e):e.forEach(function(e){n.lineTo(e[0],e[1])}),n.stroke()}),[n.canvas,{data:b(e,t),extension:".svg"}]}function w(e,t){return C(e)?"":"string"==typeof e?e:E(e)?e.toString():A(e)?k(e,t):Array.isArray(e)?e.map(function(e){return w(e,t)}).reduce(function(e,t){return e.concat(t)},[]):""}function _(e,t){C(e)||("string"==typeof e||E(e)?t(e.toString()):A(e)?t(e):Array.isArray(e)&&e.forEach(function(e){return _(e,t)}))}function x(e,t){for(var n=u(l(s(t))),r=0;r<n.length;r++){var i=n[r],o=i[0];if("M"===o)e.moveTo(i[1],i[2]);else{if("C"!==o)throw new Error('Illegal type "'+o+'" in SVG commands');e.bezierCurveTo(i[1],i[2],i[3],i[4],i[5],i[6])}}}function k(e,t){var n=(t=t||{}).units||"px",o=t.viewUnits||n,a=[],s={roundPixel:!1,precision:r(t.precision,5),pixelsPerInch:d};return e.forEach(function(e,t){var r=0===t?"M":"L",l=i(e[0],n,o,s).toString(),u=i(e[1],n,o,s).toString();a.push(r+l+" "+u)}),a.join(" ")}function C(e){return!e||Array.isArray(e)&&0===e.length}function E(e){return"object"==typeof e&&e&&!Array.isArray(e)}function A(e){return!(!e||!Array.isArray(e)||0===e.length)&&(t=e[0],Array.isArray(t)&&t.length>=2&&t.every(function(e){return"number"==typeof e}));var t}t.exports.createPath=function(e){var t=o.path();"function"==typeof e&&e(t);return t.lineTo=n(t.lineTo),t.quadraticCurveTo=n(t.quadraticCurveTo),t.bezierCurveTo=n(t.bezierCurveTo),t;function n(e){return function(){var n=Array.prototype.slice.call(arguments);return null==t._x1&&null==t._y1&&t.moveTo(n[0],n[1]),e.apply(t,n)}}},t.exports.pathsToSVGPaths=m,t.exports.pathsToPolylines=v,t.exports.pathsToSVG=b,t.exports.renderPaths=y,t.exports.convertToSVGPath=w,t.exports.eachPath=_,t.exports.drawSVGPath=x,t.exports.polylineToSVGPath=k,t.exports.polylinesToSVG=function(e,t){if(!Array.isArray(e))throw new Error("Expected array of arrays for polylines");return console.warn("polylinesToSVG is deprecated, use pathsToSVG instead which has the same functionality"),b(e,t)},t.exports.renderPolylines=function(e,t){if(!Array.isArray(e))throw new Error("Expected array of arrays for polylines");return console.warn("renderPolylines is deprecated, use renderPaths instead which has the same functionality"),y(e,t)}},{"./geometry":13,"./lib/optimize-penplot-paths":21,"abs-svg-path":5,"convert-length":37,"d3-path":27,defined:38,"normalize-svg-path":42,"parse-svg-path":44,"svg-path-contours":48}],31:[function(e,t,n){var r=e("seed-random"),i=e("simplex-noise"),o=e("defined");t.exports=function e(t){t=o(t,null);var n,a,s,l=Math.random,u=null,c=!1;return p(t),{value:h,createRandom:function(t){return e(t)},setSeed:p,getSeed:function(){return n},getRandomSeed:function(){return String(Math.floor(1e6*Math.random()))},valueNonZero:function(){for(var e=0;0===e;)e=h();return e},permuteNoise:function(){s=f()},noise1D:function(e,t,n){if(!isFinite(e))throw new TypeError("x component for noise() must be finite");return t=o(t,1),(n=o(n,1))*s.noise2D(e*t,0)},noise2D:function(e,t,n,r){if(!isFinite(e))throw new TypeError("x component for noise() must be finite");if(!isFinite(t))throw new TypeError("y component for noise() must be finite");return n=o(n,1),(r=o(r,1))*s.noise2D(e*n,t*n)},noise3D:function(e,t,n,r,i){if(!isFinite(e))throw new TypeError("x component for noise() must be finite");if(!isFinite(t))throw new TypeError("y component for noise() must be finite");if(!isFinite(n))throw new TypeError("z component for noise() must be finite");return r=o(r,1),(i=o(i,1))*s.noise3D(e*r,t*r,n*r)},noise4D:function(e,t,n,r,i,a){if(!isFinite(e))throw new TypeError("x component for noise() must be finite");if(!isFinite(t))throw new TypeError("y component for noise() must be finite");if(!isFinite(n))throw new TypeError("z component for noise() must be finite");if(!isFinite(r))throw new TypeError("w component for noise() must be finite");return i=o(i,1),(a=o(a,1))*s.noise4D(e*i,t*i,n*i,r*i)},sign:function(){return d()?1:-1},boolean:d,chance:function(e){if("number"!=typeof(e=o(e,.5)))throw new TypeError("expected n to be a number");return h()<e},range:m,rangeFloor:v,pick:function(e){return 0===e.length?void 0:e[v(0,e.length)]},shuffle:function(e){if(!Array.isArray(e))throw new TypeError("Expected Array, got "+typeof e);for(var t,n,r=e.length,i=e.slice();r;)t=Math.floor(h()*r--),n=i[r],i[r]=i[t],i[t]=n;return i},onCircle:b,insideCircle:function(e,t){e=o(e,1),b(1,t=t||[]);var n=e*Math.sqrt(h());return t[0]*=n,t[1]*=n,t},onSphere:function(e,t){e=o(e,1),t=t||[];var n=h()*Math.PI*2,r=2*h()-1,i=n,a=Math.acos(r);return t[0]=e*Math.sin(a)*Math.cos(i),t[1]=e*Math.sin(a)*Math.sin(i),t[2]=e*Math.cos(a),t},insideSphere:function(e,t){e=o(e,1),t=t||[];var n=h()*Math.PI*2,r=2*h()-1,i=h(),a=n,s=Math.acos(r),l=e*Math.cbrt(i);return t[0]=l*Math.sin(s)*Math.cos(a),t[1]=l*Math.sin(s)*Math.sin(a),t[2]=l*Math.cos(s),t},quaternion:function(e){e=e||[];var t=h(),n=h(),r=h(),i=Math.sqrt(1-t),o=Math.sqrt(t),a=2*Math.PI*n,s=2*Math.PI*r,l=Math.sin(a)*i,u=Math.cos(a)*i,c=Math.sin(s)*o,p=Math.cos(s)*o;return e[0]=l,e[1]=u,e[2]=c,e[3]=p,e},weighted:y,weightedSet:function(e){return 0===(e=e||[]).length?null:e[g(e)].value},weightedSetIndex:g,gaussian:function(e,t){if(e=o(e,0),t=o(t,1),c){c=!1;var n=u;return u=null,e+t*n}var r=0,i=0,a=0;do{r=2*h()-1,i=2*h()-1,a=r*r+i*i}while(a>=1||0===a);var s=Math.sqrt(-2*Math.log(a)/a);return u=i*s,c=!0,e+t*(r*s)}};function p(e,t){"number"==typeof e||"string"==typeof e?a=r(n=e,t):(n=void 0,a=l),s=f(),u=null,c=!1}function h(){return a()}function f(){return new i(a)}function d(){return h()>.5}function m(e,t){if(void 0===t&&(t=e,e=0),"number"!=typeof e||"number"!=typeof t)throw new TypeError("Expected all arguments to be numbers");return h()*(t-e)+e}function v(e,t){if(void 0===t&&(t=e,e=0),"number"!=typeof e||"number"!=typeof t)throw new TypeError("Expected all arguments to be numbers");return Math.floor(m(e,t))}function b(e,t){e=o(e,1),t=t||[];var n=2*h()*Math.PI;return t[0]=e*Math.cos(n),t[1]=e*Math.sin(n),t}function g(e){return 0===(e=e||[]).length?-1:y(e.map(function(e){return e.weight}))}function y(e){if(0===(e=e||[]).length)return-1;var t,n=0;for(t=0;t<e.length;t++)n+=e[t];if(n<=0)throw new Error("Weights must sum to > 0");var r=h()*n;for(t=0;t<e.length;t++){if(r<e[t])return t;r-=e[t]}return 0}}()},{defined:38,"seed-random":46,"simplex-noise":29}],32:[function(e,t,n){var r=e("regl"),i=e("primitive-quad"),o=e("parse-color"),a=e("defined");function s(e){return e&&!Array.isArray(e)&&"object"==typeof e}t.exports=function(e){if(!(e=e||{}).gl)throw new Error('Must specify { context: "webgl" } in sketch settings, or a WebGL-enabled canvas');var t=e.gl,n={gl:t};void 0!==e.extensions&&(n.extensions=e.extensions);void 0!==e.optionalExtensions&&(n.optionalExtensions=e.optionalExtensions);void 0!==e.profile&&(n.profile=e.profile);void 0!==e.onDone&&(n.onDone=e.onDone);var l,u=r(n),c=i(),p=new Map,h=e.uniforms||{},f=Object.assign({},h);Object.keys(h).forEach(function(e){var t=h[e];f[e]="function"==typeof t?function(e,n,r){var i=t.call(h,n,r);if(s(i))if(p.has(t)){var o=p.get(t);o(i),i=o}else{var a=u.texture(i);p.set(t,a),i=a}return i}:s(t)?u.texture(t):t});try{l=u({scissor:!!e.scissor&&{enable:!0,box:{x:u.prop("scissorX"),y:u.prop("scissorY"),width:u.prop("scissorWidth"),height:u.prop("scissorHeight")}},uniforms:f,frag:e.frag||["precision highp float;","","void main () {","  gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","}"].join("\n"),vert:e.vert||["precision highp float;","attribute vec3 position;","varying vec2 vUv;","","void main () {","  gl_Position = vec4(position.xyz, 1.0);","  vUv = gl_Position.xy * 0.5 + 0.5;","}"].join("\n"),blend:!1!==e.blend?{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:1}}:void 0,attributes:{position:c.positions},elements:c.cells})}catch(e){y(e)}var d=a(e.clearColor,"black");if("string"==typeof d){var m=o(d);if(!m.rgb)throw new Error('Error parsing { clearColor } color string "'+d+'"');d=m.rgb.slice(0,3).map(function(e){return e/255})}else if(d&&(!Array.isArray(d)||d.length<3))throw new Error("Error with { clearColor } option, must be a string or [ r, g, b ] float array");var v=a(e.clearAlpha,1),b=!!d&&d.concat([v||0]);return{render:function(e){u.poll(),b&&u.clear({color:b,depth:1,stencil:0}),g(e),t.flush()},regl:u,drawQuad:g,unload:function(){p.clear(),u.destroy()}};function g(e){if(e=e||{},l)try{l(e)}catch(t){y(t)&&null==e&&console.warn('Warning: shader.render() is not called with any "props" parameter')}}function y(e){if(/^\(regl\)/.test(e.message))return!0;throw e}}},{defined:38,"parse-color":43,"primitive-quad":45,regl:28}],33:[function(e,t,n){(function(e){(function(){!function(e,r){"object"==typeof n&&void 0!==t?t.exports=r():"function"==typeof define&&define.amd?define(r):e.canvasSketch=r()}(this,function(){var t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;var i=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(e){r[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()?Object.assign:function(e,i){for(var o,a,s=function(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),l=1;l<arguments.length;l++){for(var u in o=Object(arguments[l]))n.call(o,u)&&(s[u]=o[u]);if(t){a=t(o);for(var c=0;c<a.length;c++)r.call(o,a[c])&&(s[a[c]]=o[a[c]])}}return s},o="undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{};function a(e,t){return e(t={exports:{}},t.exports),t.exports}var s=o.performance&&o.performance.now?function(){return performance.now()}:Date.now||function(){return+new Date},l=function(e){return!!e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof e.then};var u=function(e){return!(!e||"object"!=typeof e)&&("object"==typeof window&&"object"==typeof window.Node?e instanceof window.Node:"number"==typeof e.nodeType&&"string"==typeof e.nodeName)};function c(){return"undefined"!=typeof window&&window["canvas-sketch-cli"]}function p(){for(var e=arguments,t=0;t<arguments.length;t++)if(null!=e[t])return e[t]}function h(){return"undefined"!=typeof document}var f,d=a(function(e,t){function n(e){var t=[];for(var n in e)t.push(n);return t}(e.exports="function"==typeof Object.keys?Object.keys:n).shim=n}),m=a(function(e,t){var n="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();function r(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function i(e){return e&&"object"==typeof e&&"number"==typeof e.length&&Object.prototype.hasOwnProperty.call(e,"callee")&&!Object.prototype.propertyIsEnumerable.call(e,"callee")||!1}(t=e.exports=n?r:i).supported=r,t.unsupported=i}),v=a(function(e){var t=Array.prototype.slice,n=e.exports=function(e,o,a){return a||(a={}),e===o||(e instanceof Date&&o instanceof Date?e.getTime()===o.getTime():!e||!o||"object"!=typeof e&&"object"!=typeof o?a.strict?e===o:e==o:function(e,o,a){var s,l;if(r(e)||r(o))return!1;if(e.prototype!==o.prototype)return!1;if(m(e))return!!m(o)&&(e=t.call(e),o=t.call(o),n(e,o,a));if(i(e)){if(!i(o))return!1;if(e.length!==o.length)return!1;for(s=0;s<e.length;s++)if(e[s]!==o[s])return!1;return!0}try{var u=d(e),c=d(o)}catch(e){return!1}if(u.length!=c.length)return!1;for(u.sort(),c.sort(),s=u.length-1;s>=0;s--)if(u[s]!=c[s])return!1;for(s=u.length-1;s>=0;s--)if(!n(e[l=u[s]],o[l],a))return!1;return typeof e==typeof o}(e,o,a))};function r(e){return null==e}function i(e){return!(!e||"object"!=typeof e||"number"!=typeof e.length)&&("function"==typeof e.copy&&"function"==typeof e.slice&&!(e.length>0&&"number"!=typeof e[0]))}}),b=a(function(e,t){!function(t){var n,r,i,o=(n=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZWN]|"[^"]*"|'[^']*'/g,r=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,i=/[^-+\dA-Z]/g,function(e,t,s,l){if(1!==arguments.length||"string"!==(null===(u=e)?"null":void 0===u?"undefined":"object"!=typeof u?typeof u:Array.isArray(u)?"array":{}.toString.call(u).slice(8,-1).toLowerCase())||/\d/.test(e)||(t=e,e=void 0),(e=e||new Date)instanceof Date||(e=new Date(e)),isNaN(e))throw TypeError("Invalid date");var u,c=(t=String(o.masks[t]||t||o.masks.default)).slice(0,4);"UTC:"!==c&&"GMT:"!==c||(t=t.slice(4),s=!0,"GMT:"===c&&(l=!0));var p=s?"getUTC":"get",h=e[p+"Date"](),f=e[p+"Day"](),d=e[p+"Month"](),m=e[p+"FullYear"](),v=e[p+"Hours"](),b=e[p+"Minutes"](),g=e[p+"Seconds"](),y=e[p+"Milliseconds"](),w=s?0:e.getTimezoneOffset(),_=function(e){var t=new Date(e.getFullYear(),e.getMonth(),e.getDate());t.setDate(t.getDate()-(t.getDay()+6)%7+3);var n=new Date(t.getFullYear(),0,4);n.setDate(n.getDate()-(n.getDay()+6)%7+3);var r=t.getTimezoneOffset()-n.getTimezoneOffset();return t.setHours(t.getHours()-r),1+Math.floor((t-n)/6048e5)}(e),x=function(e){var t=e.getDay();return 0===t&&(t=7),t}(e),k={d:h,dd:a(h),ddd:o.i18n.dayNames[f],dddd:o.i18n.dayNames[f+7],m:d+1,mm:a(d+1),mmm:o.i18n.monthNames[d],mmmm:o.i18n.monthNames[d+12],yy:String(m).slice(2),yyyy:m,h:v%12||12,hh:a(v%12||12),H:v,HH:a(v),M:b,MM:a(b),s:g,ss:a(g),l:a(y,3),L:a(Math.round(y/10)),t:v<12?o.i18n.timeNames[0]:o.i18n.timeNames[1],tt:v<12?o.i18n.timeNames[2]:o.i18n.timeNames[3],T:v<12?o.i18n.timeNames[4]:o.i18n.timeNames[5],TT:v<12?o.i18n.timeNames[6]:o.i18n.timeNames[7],Z:l?"GMT":s?"UTC":(String(e).match(r)||[""]).pop().replace(i,""),o:(w>0?"-":"+")+a(100*Math.floor(Math.abs(w)/60)+Math.abs(w)%60,4),S:["th","st","nd","rd"][h%10>3?0:(h%100-h%10!=10)*h%10],W:_,N:x};return t.replace(n,function(e){return e in k?k[e]:e.slice(1,e.length-1)})});function a(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e}o.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},o.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],timeNames:["a","p","am","pm","A","P","AM","PM"]},e.exports=o}()}),g="",y=function(e,t){if("string"!=typeof e)throw new TypeError("expected a string");if(1===t)return e;if(2===t)return e+e;var n=e.length*t;if(f!==e||void 0===f)f=e,g="";else if(g.length>=n)return g.substr(0,n);for(;n>g.length&&t>1;)1&t&&(g+=e),t>>=1,e+=e;return g=(g+=e).substr(0,n)};var w,_=function(e,t,n){return e=e.toString(),void 0===t?e:(n=0===n?"0":n?n.toString():" ",y(n,t-e.length)+e)},x=function(){},k={extension:"",prefix:"",suffix:""},C=["image/png","image/jpeg","image/webp"];function E(e,t){return void 0===t&&(t={}),new Promise(function(n,r){t=i({},k,t);var o=M(Object.assign({},t,{extension:"",frame:void 0})),a=e?"streamStart":"streamEnd",s=c();return s&&s.output&&"function"==typeof s[a]?s[a](i({},t,{filename:o})).then(function(e){return n(e)}):n({filename:o,client:!1})})}function A(e,t){return void 0===t&&(t={}),function(e){return new Promise(function(t){var n=e.indexOf(",");if(-1!==n){for(var r=e.slice(n+1),i=window.atob(r),o=e.slice(0,n),a=/data:([^;]+)/.exec(o),s=(a?a[1]:"")||void 0,l=new ArrayBuffer(i.length),u=new Uint8Array(l),c=0;c<i.length;c++)u[c]=i.charCodeAt(c);t(new window.Blob([l],{type:s}))}else t(new window.Blob)})}(e).then(function(e){return P(e,t)})}function P(e,t){return void 0===t&&(t={}),new Promise(function(n){var r=(t=i({},k,t)).filename,o=c();if(o&&"function"==typeof o.saveBlob&&o.output)return o.saveBlob(e,i({},t,{filename:r})).then(function(e){return n(e)});w||((w=document.createElement("a")).style.visibility="hidden",w.target="_blank"),w.download=r,w.href=window.URL.createObjectURL(e),document.body.appendChild(w),w.onclick=function(){w.onclick=x,setTimeout(function(){window.URL.revokeObjectURL(e),w.parentElement&&w.parentElement.removeChild(w),w.removeAttribute("href"),n({filename:r,client:!1})})},w.click()})}function M(e){if(void 0===e&&(e={}),"function"==typeof(e=i({},e)).file)return e.file(e);if(e.file)return e.file;var t,n=null,r="";("string"==typeof e.extension&&(r=e.extension),"number"==typeof e.frame)&&(t="number"==typeof e.totalFrames?e.totalFrames:Math.max(1e4,e.frame),n=_(String(e.frame),String(t).length,"0"));var o=isFinite(e.totalLayers)&&isFinite(e.layer)&&e.totalLayers>1?""+e.layer:"";return null!=n?[o,n].filter(Boolean).join("-")+r:[e.prefix,e.name||e.timeStamp,o,e.hash,e.suffix].filter(Boolean).join("-")+r}var S={dimension:"dimensions",animated:"animate",animating:"animate",unit:"units",P5:"p5",pixellated:"pixelated",looping:"loop",pixelPerInch:"pixels"},T=["dimensions","units","pixelsPerInch","orientation","scaleToFit","scaleToView","bleed","pixelRatio","exportPixelRatio","maxPixelRatio","scaleContext","resizeCanvas","styleCanvas","canvas","context","attributes","parent","file","name","prefix","suffix","animate","playing","loop","duration","totalFrames","fps","playbackRate","timeScale","frame","time","flush","pixelated","hotkeys","p5","id","scaleToFitPadding","data","params","encoding","encodingQuality"],V=function(e){Object.keys(e).forEach(function(e){e in S?console.warn('[canvas-sketch] Could not recognize the setting "'+e+'", did you mean "'+S[e]+'"?'):T.includes(e)||console.warn('[canvas-sketch] Could not recognize the setting "'+e+'"')})};var j=[["postcard",101.6,152.4],["poster-small",280,430],["poster",460,610],["poster-large",610,910],["business-card",50.8,88.9],["2r",64,89],["3r",89,127],["4r",102,152],["5r",127,178],["6r",152,203],["8r",203,254],["10r",254,305],["11r",279,356],["12r",305,381],["a0",841,1189],["a1",594,841],["a2",420,594],["a3",297,420],["a4",210,297],["a5",148,210],["a6",105,148],["a7",74,105],["a8",52,74],["a9",37,52],["a10",26,37],["2a0",1189,1682],["4a0",1682,2378],["b0",1e3,1414],["b1",707,1e3],["b1+",720,1020],["b2",500,707],["b2+",520,720],["b3",353,500],["b4",250,353],["b5",176,250],["b6",125,176],["b7",88,125],["b8",62,88],["b9",44,62],["b10",31,44],["b11",22,32],["b12",16,22],["c0",917,1297],["c1",648,917],["c2",458,648],["c3",324,458],["c4",229,324],["c5",162,229],["c6",114,162],["c7",81,114],["c8",57,81],["c9",40,57],["c10",28,40],["c11",22,32],["c12",16,22],["half-letter",5.5,8.5,"in"],["letter",8.5,11,"in"],["legal",8.5,14,"in"],["junior-legal",5,8,"in"],["ledger",11,17,"in"],["tabloid",11,17,"in"],["ansi-a",8.5,11,"in"],["ansi-b",11,17,"in"],["ansi-c",17,22,"in"],["ansi-d",22,34,"in"],["ansi-e",34,44,"in"],["arch-a",9,12,"in"],["arch-b",12,18,"in"],["arch-c",18,24,"in"],["arch-d",24,36,"in"],["arch-e",36,48,"in"],["arch-e1",30,42,"in"],["arch-e2",26,38,"in"],["arch-e3",27,39,"in"]].reduce(function(e,t){var n={units:t[3]||"mm",dimensions:[t[1],t[2]]};return e[t[0]]=n,e[t[0].replace(/-/g," ")]=n,e},{}),O=function(){for(var e=0;e<arguments.length;e++)if(void 0!==arguments[e])return arguments[e]},D=["mm","cm","m","pc","pt","in","ft","px"],L={m:{system:"metric",factor:1},cm:{system:"metric",factor:.01},mm:{system:"metric",factor:.001},pt:{system:"imperial",factor:1/72},pc:{system:"imperial",factor:1/6},in:{system:"imperial",factor:1},ft:{system:"imperial",factor:12}};const R={metric:{unit:"m",ratio:1/.0254},imperial:{unit:"in",ratio:.0254}};var I=function(e,t,n,r){if("number"!=typeof e||!isFinite(e))throw new Error("Value must be a finite number");if(!t||!n)throw new Error("Must specify from and to units");var i=O((r=r||{}).pixelsPerInch,96),o=r.precision,a=!1!==r.roundPixel;if(t=t.toLowerCase(),n=n.toLowerCase(),-1===D.indexOf(t))throw new Error('Invalid from unit "'+t+'", must be one of: '+D.join(", "));if(-1===D.indexOf(n))throw new Error('Invalid from unit "'+n+'", must be one of: '+D.join(", "));if(t===n)return e;var s=1,l=1,u=!1;"px"===t&&(l=1/i,t="in"),"px"===n&&(u=!0,s=i,n="in");var c=L[t],p=L[n],h=e*c.factor*l;c.system!==p.system&&(h*=R[c.system].ratio);var f=h/p.factor*s;return u&&a?f=Math.round(f):"number"==typeof o&&isFinite(o)&&(f=function(e,t){return Number(Math.round(e+"e"+t)+"e-"+t)}(f,o)),f};function B(e,t,n,r){return void 0===t&&(t="px"),void 0===n&&(n="px"),void 0===r&&(r=72),I(e,t,n,{pixelsPerInch:r,precision:4,roundPixel:!0})}function F(e,t){var n,r,i,o,a,s,l=h(),u=t.dimensions,c=function(e){return!(!e.dimensions||"string"!=typeof e.dimensions&&!(Array.isArray(e.dimensions)&&e.dimensions.length>=2))}(t),f=e.exporting,d=!!c&&!1!==t.scaleToFit,m=!(!f&&c)||t.scaleToView;l||(d=m=!1);var v,b,g=t.units,y="number"==typeof t.pixelsPerInch&&isFinite(t.pixelsPerInch)?t.pixelsPerInch:72,w=p(t.bleed,0),_=l?window.devicePixelRatio:1,x=m?_:1;"number"==typeof t.pixelRatio&&isFinite(t.pixelRatio)?b=p(t.exportPixelRatio,v=t.pixelRatio):c?(v=x,b=p(t.exportPixelRatio,1)):b=p(t.exportPixelRatio,v=_),"number"==typeof t.maxPixelRatio&&isFinite(t.maxPixelRatio)&&(v=Math.min(t.maxPixelRatio,v)),f&&(v=b);var k,C,E=function(e,t){if(!h())return[300,150];var n=t.parent||window;if(n===window||n===document||n===document.body)return[window.innerWidth,window.innerHeight];var r=n.getBoundingClientRect();return[r.width,r.height]}(0,t),A=E[0],P=E[1];if(c){var M=function(e,t,n){if(void 0===t&&(t="px"),void 0===n&&(n=72),"string"==typeof e){var r=e.toLowerCase();if(!(r in j))throw new Error('The dimension preset "'+e+'" is not supported or could not be found; try using a4, a3, postcard, letter, etc.');var i=j[r];return i.dimensions.map(function(e){return B(e,i.units,t,n)})}return e}(u,g,y),S=Math.max(M[0],M[1]),T=Math.min(M[0],M[1]);if(t.orientation){var V="landscape"===t.orientation;n=V?S:T,r=V?T:S}else n=M[0],r=M[1];k=n,C=r,n+=2*w,r+=2*w}else k=n=A,C=r=P;var O=n,D=r;if(c&&g&&(O=B(n,g,"px",y),D=B(r,g,"px",y)),i=Math.round(O),o=Math.round(D),d&&!f&&c){var L=n/r,R=A/P,I=p(t.scaleToFitPadding,40),F=Math.round(A-2*I),z=Math.round(P-2*I);(i>F||o>z)&&(R>L?(o=z,i=Math.round(o*L)):(i=F,o=Math.round(i/L)))}return{bleed:w,pixelRatio:v,width:n,height:r,dimensions:[n,r],units:g||"px",scaleX:(a=m?Math.round(v*i):Math.round(v*O))/n,scaleY:(s=m?Math.round(v*o):Math.round(v*D))/r,pixelsPerInch:y,viewportWidth:m?Math.round(i):Math.round(O),viewportHeight:m?Math.round(o):Math.round(D),canvasWidth:a,canvasHeight:s,trimWidth:k,trimHeight:C,styleWidth:i,styleHeight:o}}I.units=D;var z=function(e,t){if("string"!=typeof e)throw new TypeError("must specify type string");if(t=t||{},"undefined"==typeof document&&!t.canvas)return null;var n=t.canvas||document.createElement("canvas");"number"==typeof t.width&&(n.width=t.width);"number"==typeof t.height&&(n.height=t.height);var r,i=t;try{var o=[e];0===e.indexOf("webgl")&&o.push("experimental-"+e);for(var a=0;a<o.length;a++)if(r=n.getContext(o[a],i))return r}catch(e){r=null}return r||null};function U(e){var t,n;void 0===e&&(e={});var r=!1;if(!1!==e.canvas){if(!(t=e.context)||"string"==typeof t){var o=e.canvas;o||(o=function(){if(!h())throw new Error("It appears you are runing from Node.js or a non-browser environment. Try passing in an existing { canvas } interface instead.");return document.createElement("canvas")}(),r=!0);var a=t||"2d";if("function"!=typeof o.getContext)throw new Error("The specified { canvas } element does not have a getContext() function, maybe it is not a <canvas> tag?");if(!(t=z(a,i({},e.attributes,{canvas:o}))))throw new Error("Failed at canvas.getContext('"+a+"') - the browser may not support this context, or a different context may already be in use with this canvas.")}if(n=t.canvas,e.canvas&&n!==e.canvas)throw new Error("The { canvas } and { context } settings must point to the same underlying canvas element");e.pixelated&&(t.imageSmoothingEnabled=!1,t.mozImageSmoothingEnabled=!1,t.oImageSmoothingEnabled=!1,t.webkitImageSmoothingEnabled=!1,t.msImageSmoothingEnabled=!1,n.style["image-rendering"]="pixelated")}return{canvas:n,context:t,ownsCanvas:r}}var N=function(){var e=this;this._settings={},this._props={},this._sketch=void 0,this._raf=null,this._recordTimeout=null,this._lastRedrawResult=void 0,this._isP5Resizing=!1,this._keyboardShortcuts=function(e){void 0===e&&(e={});var t=function(t){if(e.enabled()){var n=c();83!==t.keyCode||t.altKey||!t.metaKey&&!t.ctrlKey?32===t.keyCode?e.togglePlay(t):n&&!t.altKey&&75===t.keyCode&&(t.metaKey||t.ctrlKey)&&(t.preventDefault(),e.commit(t)):(t.preventDefault(),e.save(t))}};return{attach:function(){window.addEventListener("keydown",t)},detach:function(){window.removeEventListener("keydown",t)}}}({enabled:function(){return!1!==e.settings.hotkeys},save:function(t){t.shiftKey?e.props.recording?(e.endRecord(),e.run()):e.record():e.props.recording||e.exportFrame()},togglePlay:function(){e.props.playing?e.pause():e.play()},commit:function(t){e.exportFrame({commit:!0})}}),this._animateHandler=function(){return e.animate()},this._resizeHandler=function(){e.resize()&&e.render()}},q={sketch:{configurable:!0},settings:{configurable:!0},props:{configurable:!0}};q.sketch.get=function(){return this._sketch},q.settings.get=function(){return this._settings},q.props.get=function(){return this._props},N.prototype._computePlayhead=function(e,t){return"number"==typeof t&&isFinite(t)?e/t:0},N.prototype._computeFrame=function(e,t,n,r){return isFinite(n)&&n>1?Math.floor(e*(n-1)):Math.floor(r*t)},N.prototype._computeCurrentFrame=function(){return this._computeFrame(this.props.playhead,this.props.time,this.props.totalFrames,this.props.fps)},N.prototype._getSizeProps=function(){var e=this.props;return{width:e.width,height:e.height,pixelRatio:e.pixelRatio,canvasWidth:e.canvasWidth,canvasHeight:e.canvasHeight,viewportWidth:e.viewportWidth,viewportHeight:e.viewportHeight}},N.prototype.run=function(){if(!this.sketch)throw new Error("should wait until sketch is loaded before trying to play()");return!1!==this.settings.playing&&this.play(),"function"==typeof this.sketch.dispose&&console.warn("In canvas-sketch@0.0.23 the dispose() event has been renamed to unload()"),this.props.started||(this._signalBegin(),this.props.started=!0),this.tick(),this.render(),this},N.prototype._cancelTimeouts=function(){null!=this._raf&&"undefined"!=typeof window&&"function"==typeof window.cancelAnimationFrame&&(window.cancelAnimationFrame(this._raf),this._raf=null),null!=this._recordTimeout&&(clearTimeout(this._recordTimeout),this._recordTimeout=null)},N.prototype.play=function(){var e=this.settings.animate;"animation"in this.settings&&(e=!0,console.warn("[canvas-sketch] { animation } has been renamed to { animate }")),e&&(h()?this.props.playing||(this.props.started||(this._signalBegin(),this.props.started=!0),this.props.playing=!0,this._cancelTimeouts(),this._lastTime=s(),this._raf=window.requestAnimationFrame(this._animateHandler)):console.error("[canvas-sketch] WARN: Using { animate } in Node.js is not yet supported"))},N.prototype.pause=function(){this.props.recording&&this.endRecord(),this.props.playing=!1,this._cancelTimeouts()},N.prototype.togglePlay=function(){this.props.playing?this.pause():this.play()},N.prototype.stop=function(){this.pause(),this.props.frame=0,this.props.playhead=0,this.props.time=0,this.props.deltaTime=0,this.props.started=!1,this.render()},N.prototype.record=function(){var e=this;if(!this.props.recording)if(h()){this.stop(),this.props.playing=!0,this.props.recording=!0;var t=this._createExportOptions({sequence:!0}),n=1/this.props.fps;this._cancelTimeouts();var r,i=function(){return e.props.recording?(e.props.deltaTime=n,e.tick(),e.exportFrame(t).then(function(){e.props.recording&&(e.props.deltaTime=0,e.props.frame++,e.props.frame<e.props.totalFrames?(e.props.time+=n,e.props.playhead=e._computePlayhead(e.props.time,e.props.duration),e._recordTimeout=setTimeout(i,0)):(console.log("Finished recording"),e._signalEnd(),e.endRecord(),e.stop(),e.run()))})):Promise.resolve()};this.props.started||(this._signalBegin(),this.props.started=!0),this.sketch&&"function"==typeof this.sketch.beginRecord&&this._wrapContextScale(function(t){return e.sketch.beginRecord(t)}),(r=t,void 0===r&&(r={}),E(!0,r)).catch(function(e){console.error(e)}).then(function(t){e._raf=window.requestAnimationFrame(i)})}else console.error("[canvas-sketch] WARN: Recording from Node.js is not yet supported")},N.prototype._signalBegin=function(){var e=this;this.sketch&&"function"==typeof this.sketch.begin&&this._wrapContextScale(function(t){return e.sketch.begin(t)})},N.prototype._signalEnd=function(){var e=this;this.sketch&&"function"==typeof this.sketch.end&&this._wrapContextScale(function(t){return e.sketch.end(t)})},N.prototype.endRecord=function(){var e,t=this,n=this.props.recording;return this._cancelTimeouts(),this.props.recording=!1,this.props.deltaTime=0,this.props.playing=!1,(void 0===e&&(e={}),E(!1,e)).catch(function(e){console.error(e)}).then(function(){n&&t.sketch&&"function"==typeof t.sketch.endRecord&&t._wrapContextScale(function(e){return t.sketch.endRecord(e)})})},N.prototype._createExportOptions=function(e){return void 0===e&&(e={}),{sequence:e.sequence,save:e.save,fps:this.props.fps,frame:e.sequence?this.props.frame:void 0,file:this.settings.file,name:this.settings.name,prefix:this.settings.prefix,suffix:this.settings.suffix,encoding:this.settings.encoding,encodingQuality:this.settings.encodingQuality,timeStamp:e.timeStamp||b(new Date,"yyyy.mm.dd-HH.MM.ss"),totalFrames:isFinite(this.props.totalFrames)?Math.max(0,this.props.totalFrames):1e3}},N.prototype.exportFrame=function(e){var t=this;if(void 0===e&&(e={}),!this.sketch)return Promise.all([]);"function"==typeof this.sketch.preExport&&this.sketch.preExport();var n=this._createExportOptions(e),r=c(),o=Promise.resolve();if(r&&e.commit&&"function"==typeof r.commit){var a=i({},n),s=r.commit(a);o=l(s)?s:Promise.resolve(s)}return o.then(function(e){return t._doExportFrame(i({},n,{hash:e||""}))}).then(function(e){return 1===e.length?e[0]:e})},N.prototype._doExportFrame=function(e){var t=this;void 0===e&&(e={}),this._props.exporting=!0,this.resize();var n=this.render();return void 0===n&&(n=[this.props.canvas]),n=(n=[].concat(n).filter(Boolean)).map(function(t){var n,r="object"==typeof t&&t&&("data"in t||"dataURL"in t),o=r?t.data:t,a=r?i({},t,{data:o}):{data:o};if(u(n=o)&&/canvas/i.test(n.nodeName)&&"function"==typeof n.getContext){var s=function(e,t){void 0===t&&(t={});var n=t.encoding||"image/png";if(!C.includes(n))throw new Error("Invalid canvas encoding "+n);var r=(n.split("/")[1]||"").replace(/jpeg/i,"jpg");return r&&(r=("."+r).toLowerCase()),{extension:r,type:n,dataURL:e.toDataURL(n,t.encodingQuality)}}(o,{encoding:a.encoding||e.encoding,encodingQuality:p(a.encodingQuality,e.encodingQuality,.95)});return Object.assign(a,{dataURL:s.dataURL,extension:s.extension,type:s.type})}return a}),this._props.exporting=!1,this.resize(),this.render(),Promise.all(n.map(function(t,n,r){var o=i({extension:"",prefix:"",suffix:""},e,t,{layer:n,totalLayers:r.length}),a=!1!==e.save&&t.save;for(var s in o.save=!1!==a,o.filename=M(o),delete o.encoding,delete o.encodingQuality,o)void 0===o[s]&&delete o[s];var l=Promise.resolve({});if(o.save){var u=o.data;if(o.dataURL)l=A(o.dataURL,o);else l=function(e,t){void 0===t&&(t={});var n=Array.isArray(e)?e:[e];return P(new window.Blob(n,{type:t.type||""}),t)}(u,o)}return l.then(function(e){return Object.assign({},o,e)})})).then(function(n){var r=n.filter(function(e){return e.save});if(r.length>0){var i,o=r.find(function(e){return e.outputName}),a=r.some(function(e){return e.client}),s=r.some(function(e){return e.stream});i=r.length>1?r.length:o?o.outputName+"/"+r[0].filename:""+r[0].filename;var l="";if(e.sequence)l=isFinite(t.props.totalFrames)?" (frame "+(e.frame+1)+" / "+t.props.totalFrames+")":" (frame "+e.frame+")";else r.length>1&&(l=" files");console.log("%c["+(a?"canvas-sketch-cli":"canvas-sketch")+"]%c "+(s?"Streaming into":"Exported")+" %c"+i+"%c"+l,"color: #8e8e8e;","color: initial;","font-weight: bold;","font-weight: initial;")}return"function"==typeof t.sketch.postExport&&t.sketch.postExport(),n})},N.prototype._wrapContextScale=function(e){this._preRender(),e(this.props),this._postRender()},N.prototype._preRender=function(){var e=this.props;this.props.gl||!e.context||e.p5?e.p5&&e.p5.scale(e.scaleX/e.pixelRatio,e.scaleY/e.pixelRatio):(e.context.save(),!1!==this.settings.scaleContext&&e.context.scale(e.scaleX,e.scaleY))},N.prototype._postRender=function(){var e=this.props;this.props.gl||!e.context||e.p5||e.context.restore(),e.gl&&!1!==this.settings.flush&&!e.p5&&e.gl.flush()},N.prototype.tick=function(){this.sketch&&"function"==typeof this.sketch.tick&&(this._preRender(),this.sketch.tick(this.props),this._postRender())},N.prototype.render=function(){return this.props.p5?(this._lastRedrawResult=void 0,this.props.p5.redraw(),this._lastRedrawResult):this.submitDrawCall()},N.prototype.submitDrawCall=function(){if(this.sketch){var e,t=this.props;return this._preRender(),"function"==typeof this.sketch?e=this.sketch(t):"function"==typeof this.sketch.render&&(e=this.sketch.render(t)),this._postRender(),e}},N.prototype.update=function(e){var t=this;void 0===e&&(e={});var n=["animate"];Object.keys(e).forEach(function(e){if(n.indexOf(e)>=0)throw new Error("Sorry, the { "+e+" } option is not yet supported with update().")});var r=this._settings.canvas,i=this._settings.context;for(var o in e){var a=e[o];void 0!==a&&(t._settings[o]=a)}var s=Object.assign({},this._settings,e);if("time"in e&&"frame"in e)throw new Error("You should specify { time } or { frame } but not both");if("time"in e?delete s.frame:"frame"in e&&delete s.time,"duration"in e&&"totalFrames"in e)throw new Error("You should specify { duration } or { totalFrames } but not both");"duration"in e?delete s.totalFrames:"totalFrames"in e&&delete s.duration,"data"in e&&(this._props.data=e.data);var l=this.getTimeProps(s);if(Object.assign(this._props,l),r!==this._settings.canvas||i!==this._settings.context){var u=U(this._settings),c=u.context;this.props.canvas=u.canvas,this.props.context=c,this._setupGLKey(),this._appendCanvasIfNeeded()}return e.p5&&"function"!=typeof e.p5&&(this.props.p5=e.p5,this.props.p5.draw=function(){t._isP5Resizing||(t._lastRedrawResult=t.submitDrawCall())}),"playing"in e&&(e.playing?this.play():this.pause()),V(this._settings),this.resize(),this.render(),this.props},N.prototype.resize=function(){var e=this._getSizeProps(),t=this.settings,n=this.props,r=F(n,t);Object.assign(this._props,r);var i=this.props,o=i.pixelRatio,a=i.canvasWidth,s=i.canvasHeight,l=i.styleWidth,u=i.styleHeight,c=this.props.canvas;c&&!1!==t.resizeCanvas&&(n.p5?c.width===a&&c.height===s||(this._isP5Resizing=!0,n.p5.pixelDensity(o),n.p5.resizeCanvas(a/o,s/o,!1),this._isP5Resizing=!1):(c.width!==a&&(c.width=a),c.height!==s&&(c.height=s)),h()&&!1!==t.styleCanvas&&(c.style.width=l+"px",c.style.height=u+"px"));var p=this._getSizeProps(),f=!v(e,p);return f&&this._sizeChanged(),f},N.prototype._sizeChanged=function(){this.sketch&&"function"==typeof this.sketch.resize&&this.sketch.resize(this.props)},N.prototype.animate=function(){if(this.props.playing)if(h()){this._raf=window.requestAnimationFrame(this._animateHandler);var e=s(),t=1e3/this.props.fps,n=e-this._lastTime,r=this.props.duration,i="number"==typeof r&&isFinite(r),o=!0,a=this.settings.playbackRate;"fixed"===a?n=t:"throttle"===a?n>t?this._lastTime=e-=n%t:o=!1:this._lastTime=e;var l=n/1e3,u=this.props.time+l*this.props.timeScale;u<0&&i&&(u=r+u);var c=!1,p=!1;if(i&&u>=r&&(!1!==this.settings.loop?(o=!0,u%=r,p=!0):(o=!1,u=r,c=!0),this._signalEnd()),o){this.props.deltaTime=l,this.props.time=u,this.props.playhead=this._computePlayhead(u,r);var f=this.props.frame;this.props.frame=this._computeCurrentFrame(),p&&this._signalBegin(),f!==this.props.frame&&this.tick(),this.render(),this.props.deltaTime=0}c&&this.pause()}else console.error("[canvas-sketch] WARN: Animation in Node.js is not yet supported")},N.prototype.dispatch=function(e){if("function"!=typeof e)throw new Error("must pass function into dispatch()");e(this.props),this.render()},N.prototype.mount=function(){this._appendCanvasIfNeeded()},N.prototype.unmount=function(){h()&&(window.removeEventListener("resize",this._resizeHandler),this._keyboardShortcuts.detach()),this.props.canvas.parentElement&&this.props.canvas.parentElement.removeChild(this.props.canvas)},N.prototype._appendCanvasIfNeeded=function(){h()&&(!1!==this.settings.parent&&this.props.canvas&&!this.props.canvas.parentElement&&(this.settings.parent||document.body).appendChild(this.props.canvas))},N.prototype._setupGLKey=function(){var e;this.props.context&&("function"==typeof(e=this.props.context).clear&&"function"==typeof e.clearColor&&"function"==typeof e.bufferData?this._props.gl=this.props.context:delete this._props.gl)},N.prototype.getTimeProps=function(e){void 0===e&&(e={});var t=e.duration,n=e.totalFrames,r=p(e.timeScale,1),i=p(e.fps,24),o="number"==typeof t&&isFinite(t),a="number"==typeof n&&isFinite(n),s=o?Math.floor(i*t):void 0,l=a?n/i:void 0;if(o&&a&&s!==n)throw new Error("You should specify either duration or totalFrames, but not both. Or, they must match exactly.");void 0===e.dimensions&&void 0!==e.units&&console.warn("You've specified a { units } setting but no { dimension }, so the units will be ignored."),n=p(n,s,Infinity),t=p(t,l,Infinity);var u=e.time,c=e.frame,h="number"==typeof u&&isFinite(u),f="number"==typeof c&&isFinite(c),d=0,m=0,v=0;if(h&&f)throw new Error("You should specify either start frame or time, but not both.");return h?(v=this._computePlayhead(d=u,t),m=this._computeFrame(v,d,n,i)):f&&(v=this._computePlayhead(d=(m=c)/i,t)),{playhead:v,time:d,frame:m,duration:t,totalFrames:n,fps:i,timeScale:r}},N.prototype.setup=function(e){var t=this;if(void 0===e&&(e={}),this.sketch)throw new Error("Multiple setup() calls not yet supported.");this._settings=Object.assign({},e,this._settings),V(this._settings);var n=U(this._settings),r=n.context,i=n.canvas,o=this.getTimeProps(this._settings);this._props=Object.assign({},o,{canvas:i,context:r,deltaTime:0,started:!1,exporting:!1,playing:!1,recording:!1,settings:this.settings,data:this.settings.data,render:function(){return t.render()},togglePlay:function(){return t.togglePlay()},dispatch:function(e){return t.dispatch(e)},tick:function(){return t.tick()},resize:function(){return t.resize()},update:function(e){return t.update(e)},exportFrame:function(e){return t.exportFrame(e)},record:function(){return t.record()},play:function(){return t.play()},pause:function(){return t.pause()},stop:function(){return t.stop()}}),this._setupGLKey(),this.resize()},N.prototype.loadAndRun=function(e,t){var n=this;return this.load(e,t).then(function(){return n.run(),n})},N.prototype.unload=function(){var e=this;this.pause(),this.sketch&&("function"==typeof this.sketch.unload&&this._wrapContextScale(function(t){return e.sketch.unload(t)}),this._sketch=null)},N.prototype.destroy=function(){this.unload(),this.unmount()},N.prototype.load=function(e,t){var n=this;if("function"!=typeof e)throw new Error("The function must take in a function as the first parameter. Example:\n  canvasSketcher(() => { ... }, settings)");this.sketch&&this.unload(),void 0!==t&&this.update(t),this._preRender();var r=Promise.resolve();if(this.settings.p5){if(!h())throw new Error("[canvas-sketch] ERROR: Using p5.js in Node.js is not supported");r=new Promise(function(e){var t,r=n.settings.p5;r.p5&&(t=r.preload,r=r.p5);var i=function(r){t&&(r.preload=function(){return t(r)}),r.setup=function(){var t=n.props,i="webgl"===n.settings.context,o=i?r.WEBGL:r.P2D;r.noLoop(),r.pixelDensity(t.pixelRatio),r.createCanvas(t.viewportWidth,t.viewportHeight,o),i&&n.settings.attributes&&r.setAttributes(n.settings.attributes),n.update({p5:r,canvas:r.canvas,context:r._renderer.drawingContext}),e()}};if("function"==typeof r)new r(i);else{if("function"!=typeof window.createCanvas)throw new Error("{ p5 } setting is passed but can't find p5.js in global (window) scope. Maybe you did not create it globally?\nnew p5(); // <-- attaches to global scope");i(window)}})}return r.then(function(){var t=e(n.props);return l(t)||(t=Promise.resolve(t)),t}).then(function(e){return e||(e={}),n._sketch=e,h()&&(n._keyboardShortcuts.attach(),window.addEventListener("resize",n._resizeHandler)),n._postRender(),n._sizeChanged(),n}).catch(function(e){throw console.warn("Could not start sketch, the async loading function rejected with an error:\n    Error: "+e.message),e})},Object.defineProperties(N.prototype,q);var H="hot-id-cache",K=[];function G(e,t){if(void 0===t&&(t={}),t.p5){if(t.canvas||t.context&&"string"!=typeof t.context)throw new Error('In { p5 } mode, you can\'t pass your own canvas or context, unless the context is a "webgl" or "2d" string');t=Object.assign({},t,{canvas:!1,context:"string"==typeof t.context&&t.context})}var n,r,i=(n=c())&&n.hot;i&&(r=p(t.id,"$__DEFAULT_CANVAS_SKETCH_ID__$"));var o=i&&"string"==typeof r;o&&K.includes(r)&&(console.warn("Warning: You have multiple calls to canvasSketch() in --hot mode. You must pass unique { id } strings in settings to enable hot reload across multiple sketches. ",r),o=!1);var a=Promise.resolve();if(o){K.push(r);var s=function(e){var t=c();if(t)return t[H]=t[H]||{},t[H][e]}(r);if(s){var l=function(){var e,n=(e=s.manager,t.animate?{time:e.props.time}:void 0);return s.manager.destroy(),n};a=s.load.then(l).catch(l)}}return a.then(function(n){var i,a,s,l,u=new N;return e?(t=Object.assign({},t,n),u.setup(t),u.mount(),i=u.loadAndRun(e)):i=Promise.resolve(u),o&&(a=r,s={load:i,manager:u},(l=c())&&(l[H]=l[H]||{},l[H][a]=s)),i})}return G.canvasSketch=G,G.PaperSizes=j,G})}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],34:[function(e,t,n){(function(e){(function(){var n=function(){"use strict";function t(e,t){return null!=t&&e instanceof t}var n,r,i;try{n=Map}catch(e){n=function(){}}try{r=Set}catch(e){r=function(){}}try{i=Promise}catch(e){i=function(){}}function o(a,l,u,c,p){"object"==typeof l&&(u=l.depth,c=l.prototype,p=l.includeNonEnumerable,l=l.circular);var h=[],f=[],d=void 0!==e;return void 0===l&&(l=!0),void 0===u&&(u=Infinity),function a(u,m){if(null===u)return null;if(0===m)return u;var v,b;if("object"!=typeof u)return u;if(t(u,n))v=new n;else if(t(u,r))v=new r;else if(t(u,i))v=new i(function(e,t){u.then(function(t){e(a(t,m-1))},function(e){t(a(e,m-1))})});else if(o.__isArray(u))v=[];else if(o.__isRegExp(u))v=new RegExp(u.source,s(u)),u.lastIndex&&(v.lastIndex=u.lastIndex);else if(o.__isDate(u))v=new Date(u.getTime());else{if(d&&e.isBuffer(u))return v=e.allocUnsafe?e.allocUnsafe(u.length):new e(u.length),u.copy(v),v;t(u,Error)?v=Object.create(u):void 0===c?(b=Object.getPrototypeOf(u),v=Object.create(b)):(v=Object.create(c),b=c)}if(l){var g=h.indexOf(u);if(-1!=g)return f[g];h.push(u),f.push(v)}for(var y in t(u,n)&&u.forEach(function(e,t){var n=a(t,m-1),r=a(e,m-1);v.set(n,r)}),t(u,r)&&u.forEach(function(e){var t=a(e,m-1);v.add(t)}),u){var w;b&&(w=Object.getOwnPropertyDescriptor(b,y)),w&&null==w.set||(v[y]=a(u[y],m-1))}if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(u);for(y=0;y<_.length;y++){var x=_[y];(!(C=Object.getOwnPropertyDescriptor(u,x))||C.enumerable||p)&&(v[x]=a(u[x],m-1),C.enumerable||Object.defineProperty(v,x,{enumerable:!1}))}}if(p){var k=Object.getOwnPropertyNames(u);for(y=0;y<k.length;y++){var C,E=k[y];(C=Object.getOwnPropertyDescriptor(u,E))&&C.enumerable||(v[E]=a(u[E],m-1),Object.defineProperty(v,E,{enumerable:!1}))}}return v}(a,u)}function a(e){return Object.prototype.toString.call(e)}function s(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return o.clonePrototype=function(e){if(null===e)return null;var t=function(){};return t.prototype=e,new t},o.__objToStr=a,o.__isDate=function(e){return"object"==typeof e&&"[object Date]"===a(e)},o.__isArray=function(e){return"object"==typeof e&&"[object Array]"===a(e)},o.__isRegExp=function(e){return"object"==typeof e&&"[object RegExp]"===a(e)},o.__getRegExpFlags=s,o}();"object"==typeof t&&t.exports&&(t.exports=n)}).call(this)}).call(this,e("buffer").Buffer)},{buffer:2}],35:[function(e,t,n){function i(e){var t,n,r=e[0]/255,i=e[1]/255,o=e[2]/255,a=Math.min(r,i,o),s=Math.max(r,i,o),l=s-a;return s==a?t=0:r==s?t=(i-o)/l:i==s?t=2+(o-r)/l:o==s&&(t=4+(r-i)/l),(t=Math.min(60*t,360))<0&&(t+=360),n=(a+s)/2,[t,100*(s==a?0:n<=.5?l/(s+a):l/(2-s-a)),100*n]}function o(e){var t,n,r=e[0],i=e[1],o=e[2],a=Math.min(r,i,o),s=Math.max(r,i,o),l=s-a;return n=0==s?0:l/s*1e3/10,s==a?t=0:r==s?t=(i-o)/l:i==s?t=2+(o-r)/l:o==s&&(t=4+(r-i)/l),(t=Math.min(60*t,360))<0&&(t+=360),[t,n,s/255*1e3/10]}function a(e){var t=e[0],n=e[1],r=e[2];return[i(e)[0],100*(1/255*Math.min(t,Math.min(n,r))),100*(r=1-1/255*Math.max(t,Math.max(n,r)))]}function s(e){var t,n=e[0]/255,r=e[1]/255,i=e[2]/255;return[100*((1-n-(t=Math.min(1-n,1-r,1-i)))/(1-t)||0),100*((1-r-t)/(1-t)||0),100*((1-i-t)/(1-t)||0),100*t]}function l(e){return E[JSON.stringify(e)]}function u(e){var t=e[0]/255,n=e[1]/255,r=e[2]/255;return[100*(.4124*(t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92)+.3576*(n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92)+.1805*(r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92)),100*(.2126*t+.7152*n+.0722*r),100*(.0193*t+.1192*n+.9505*r)]}function c(e){var t=u(e),n=t[0],r=t[1],i=t[2];return r/=100,i/=108.883,n=(n/=95.047)>.008856?Math.pow(n,1/3):7.787*n+16/116,[116*(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116)-16,500*(n-r),200*(r-(i=i>.008856?Math.pow(i,1/3):7.787*i+16/116))]}function p(e){var t,n,r,i,o,a=e[0]/360,s=e[1]/100,l=e[2]/100;if(0==s)return[o=255*l,o,o];t=2*l-(n=l<.5?l*(1+s):l+s-l*s),i=[0,0,0];for(var u=0;u<3;u++)(r=a+1/3*-(u-1))<0&&r++,r>1&&r--,i[u]=255*(o=6*r<1?t+6*(n-t)*r:2*r<1?n:3*r<2?t+(n-t)*(2/3-r)*6:t);return i}function h(e){var t=e[0]/60,n=e[1]/100,r=e[2]/100,i=Math.floor(t)%6,o=t-Math.floor(t),a=255*r*(1-n),s=255*r*(1-n*o),l=255*r*(1-n*(1-o));r*=255;switch(i){case 0:return[r,l,a];case 1:return[s,r,a];case 2:return[a,r,l];case 3:return[a,s,r];case 4:return[l,a,r];case 5:return[r,a,s]}}function f(e){var t,n,i,o,a=e[0]/360,s=e[1]/100,l=e[2]/100,u=s+l;switch(u>1&&(s/=u,l/=u),i=6*a-(t=Math.floor(6*a)),0!=(1&t)&&(i=1-i),o=s+i*((n=1-l)-s),t){default:case 6:case 0:r=n,g=o,b=s;break;case 1:r=o,g=n,b=s;break;case 2:r=s,g=n,b=o;break;case 3:r=s,g=o,b=n;break;case 4:r=o,g=s,b=n;break;case 5:r=n,g=s,b=o}return[255*r,255*g,255*b]}function d(e){var t=e[1]/100,n=e[2]/100,r=e[3]/100;return[255*(1-Math.min(1,e[0]/100*(1-r)+r)),255*(1-Math.min(1,t*(1-r)+r)),255*(1-Math.min(1,n*(1-r)+r))]}function m(e){var t,n,r,i=e[0]/100,o=e[1]/100,a=e[2]/100;return n=-.9689*i+1.8758*o+.0415*a,r=.0557*i+-.204*o+1.057*a,t=(t=3.2406*i+-1.5372*o+-.4986*a)>.0031308?1.055*Math.pow(t,1/2.4)-.055:t*=12.92,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:n*=12.92,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:r*=12.92,[255*(t=Math.min(Math.max(0,t),1)),255*(n=Math.min(Math.max(0,n),1)),255*(r=Math.min(Math.max(0,r),1))]}function v(e){var t=e[0],n=e[1],r=e[2];return n/=100,r/=108.883,t=(t/=95.047)>.008856?Math.pow(t,1/3):7.787*t+16/116,[116*(n=n>.008856?Math.pow(n,1/3):7.787*n+16/116)-16,500*(t-n),200*(n-(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116))]}function y(e){var t,n,r,i,o=e[0],a=e[1],s=e[2];return o<=8?i=(n=100*o/903.3)/100*7.787+16/116:(n=100*Math.pow((o+16)/116,3),i=Math.pow(n/100,1/3)),[t=t/95.047<=.008856?t=95.047*(a/500+i-16/116)/7.787:95.047*Math.pow(a/500+i,3),n,r=r/108.883<=.008859?r=108.883*(i-s/200-16/116)/7.787:108.883*Math.pow(i-s/200,3)]}function w(e){var t,n=e[0],r=e[1],i=e[2];return(t=360*Math.atan2(i,r)/2/Math.PI)<0&&(t+=360),[n,Math.sqrt(r*r+i*i),t]}function _(e){return m(y(e))}function x(e){var t,n=e[1];return t=e[2]/360*2*Math.PI,[e[0],n*Math.cos(t),n*Math.sin(t)]}function k(e){return C[e]}t.exports={rgb2hsl:i,rgb2hsv:o,rgb2hwb:a,rgb2cmyk:s,rgb2keyword:l,rgb2xyz:u,rgb2lab:c,rgb2lch:function(e){return w(c(e))},hsl2rgb:p,hsl2hsv:function(e){var t=e[0],n=e[1]/100,r=e[2]/100;if(0===r)return[0,0,0];return[t,100*(2*(n*=(r*=2)<=1?r:2-r)/(r+n)),100*((r+n)/2)]},hsl2hwb:function(e){return a(p(e))},hsl2cmyk:function(e){return s(p(e))},hsl2keyword:function(e){return l(p(e))},hsv2rgb:h,hsv2hsl:function(e){var t,n,r=e[1]/100,i=e[2]/100;return t=r*i,[e[0],100*(t=(t/=(n=(2-r)*i)<=1?n:2-n)||0),100*(n/=2)]},hsv2hwb:function(e){return a(h(e))},hsv2cmyk:function(e){return s(h(e))},hsv2keyword:function(e){return l(h(e))},hwb2rgb:f,hwb2hsl:function(e){return i(f(e))},hwb2hsv:function(e){return o(f(e))},hwb2cmyk:function(e){return s(f(e))},hwb2keyword:function(e){return l(f(e))},cmyk2rgb:d,cmyk2hsl:function(e){return i(d(e))},cmyk2hsv:function(e){return o(d(e))},cmyk2hwb:function(e){return a(d(e))},cmyk2keyword:function(e){return l(d(e))},keyword2rgb:k,keyword2hsl:function(e){return i(k(e))},keyword2hsv:function(e){return o(k(e))},keyword2hwb:function(e){return a(k(e))},keyword2cmyk:function(e){return s(k(e))},keyword2lab:function(e){return c(k(e))},keyword2xyz:function(e){return u(k(e))},xyz2rgb:m,xyz2lab:v,xyz2lch:function(e){return w(v(e))},lab2xyz:y,lab2rgb:_,lab2lch:w,lch2lab:x,lch2xyz:function(e){return y(x(e))},lch2rgb:function(e){return _(x(e))}};var C={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},E={};for(var A in C)E[JSON.stringify(C[A])]=A},{}],36:[function(e,t,n){var r=e("./conversions"),i=function(){return new u};for(var o in r){i[o+"Raw"]=function(e){return function(t){return"number"==typeof t&&(t=Array.prototype.slice.call(arguments)),r[e](t)}}(o);var a=/(\w+)2(\w+)/.exec(o),s=a[1],l=a[2];(i[s]=i[s]||{})[l]=i[o]=function(e){return function(t){"number"==typeof t&&(t=Array.prototype.slice.call(arguments));var n=r[e](t);if("string"==typeof n||void 0===n)return n;for(var i=0;i<n.length;i++)n[i]=Math.round(n[i]);return n}}(o)}var u=function(){this.convs={}};u.prototype.routeSpace=function(e,t){var n=t[0];return void 0===n?this.getValues(e):("number"==typeof n&&(n=Array.prototype.slice.call(t)),this.setValues(e,n))},u.prototype.setValues=function(e,t){return this.space=e,this.convs={},this.convs[e]=t,this},u.prototype.getValues=function(e){var t=this.convs[e];if(!t){var n=this.space;t=i[n][e](this.convs[n]),this.convs[e]=t}return t},["rgb","hsl","hsv","cmyk","keyword"].forEach(function(e){u.prototype[e]=function(t){return this.routeSpace(e,arguments)}}),t.exports=i},{"./conversions":35}],37:[function(e,t,n){var r=e("defined"),i=["mm","cm","m","pc","pt","in","ft","px"],o={m:{system:"metric",factor:1},cm:{system:"metric",factor:.01},mm:{system:"metric",factor:.001},pt:{system:"imperial",factor:1/72},pc:{system:"imperial",factor:1/6},in:{system:"imperial",factor:1},ft:{system:"imperial",factor:12}};const a={metric:{unit:"m",ratio:1/.0254},imperial:{unit:"in",ratio:.0254}};t.exports=function(e,t,n,s){if("number"!=typeof e||!isFinite(e))throw new Error("Value must be a finite number");if(!t||!n)throw new Error("Must specify from and to units");var l=r((s=s||{}).pixelsPerInch,96),u=s.precision,c=!1!==s.roundPixel;if(t=t.toLowerCase(),n=n.toLowerCase(),-1===i.indexOf(t))throw new Error('Invalid from unit "'+t+'", must be one of: '+i.join(", "));if(-1===i.indexOf(n))throw new Error('Invalid from unit "'+n+'", must be one of: '+i.join(", "));if(t===n)return e;var p=1,h=1,f=!1;"px"===t&&(h=1/l,t="in"),"px"===n&&(f=!0,p=l,n="in");var d=o[t],m=o[n],v=e*d.factor*h;d.system!==m.system&&(v*=a[d.system].ratio);var b=v/m.factor*p;return f&&c?b=Math.round(b):"number"==typeof u&&isFinite(u)&&(b=function(e,t){return Number(Math.round(e+"e"+t)+"e-"+t)}(b,u)),b},t.exports.units=i},{defined:38}],38:[function(e,t,n){t.exports=function(){for(var e=0;e<arguments.length;e++)if(void 0!==arguments[e])return arguments[e]}},{}],39:[function(e,t,n){t.exports=function(e){var t,n,r,i,o,a=e[0],s=e[1],l=e[2];if(0===s)return[o=l,o,o];n=l<.5?l*(1+s):l+s-l*s;t=2*l-n,i=[0,0,0];for(var u=0;u<3;u++)(r=a+1/3*-(u-1))<0&&r++,r>1&&r--,i[u]=o=6*r<1?t+6*(n-t)*r:2*r<1?n:3*r<2?t+(n-t)*(2/3-r)*6:t;return i}},{}],40:[function(e,t,n){t.exports=function(e){var t,n,r,i=e[0],o=e[1],a=e[2],s=Math.min(i,o,a),l=Math.max(i,o,a),u=l-s;l===s?t=0:i===l?t=(o-a)/u:o===l?t=2+(a-i)/u:a===l&&(t=4+(i-o)/u);(t=Math.min(60*t,360))<0&&(t+=360);r=(s+l)/2,n=l===s?0:r<=.5?u/(l+s):u/(2-l-s);return[t/360,n,r]}},{}],41:[function(e,t,n){"use strict";function r(e,t,n){var r,a,s,l,u,c=e.length,p=o(e[0],t),h=[];for(n||(n=[]),r=1;r<c;r++){for(a=e[r-1],l=u=o(s=e[r],t);;){if(!(p|l)){h.push(a),l!==u?(h.push(s),r<c-1&&(n.push(h),h=[])):r===c-1&&h.push(s);break}if(p&l)break;p?p=o(a=i(a,s,p,t),t):l=o(s=i(a,s,l,t),t)}p=u}return h.length&&n.push(h),n}function i(e,t,n,r){return 8&n?[e[0]+(t[0]-e[0])*(r[3]-e[1])/(t[1]-e[1]),r[3]]:4&n?[e[0]+(t[0]-e[0])*(r[1]-e[1])/(t[1]-e[1]),r[1]]:2&n?[r[2],e[1]+(t[1]-e[1])*(r[2]-e[0])/(t[0]-e[0])]:1&n?[r[0],e[1]+(t[1]-e[1])*(r[0]-e[0])/(t[0]-e[0])]:null}function o(e,t){var n=0;return e[0]<t[0]?n|=1:e[0]>t[2]&&(n|=2),e[1]<t[1]?n|=4:e[1]>t[3]&&(n|=8),n}t.exports=r,r.polyline=r,r.polygon=function(e,t){var n,r,a,s,l,u,c;for(r=1;r<=8;r*=2){for(n=[],s=!(o(a=e[e.length-1],t)&r),l=0;l<e.length;l++)(c=!(o(u=e[l],t)&r))!==s&&n.push(i(a,u,r,t)),c&&n.push(u),a=u,s=c;if(!(e=n).length)break}return n}},{}],42:[function(e,t,n){"use strict";t.exports=function(e){for(var t,n=[],a=0,s=0,l=0,u=0,c=null,p=null,h=0,f=0,d=0,m=e.length;d<m;d++){var v=e[d],b=v[0];switch(b){case"M":l=v[1],u=v[2];break;case"A":var g=r({px:h,py:f,cx:v[6],cy:v[7],rx:v[1],ry:v[2],xAxisRotation:v[3],largeArcFlag:v[4],sweepFlag:v[5]});if(!g.length)continue;for(var y,w=0;w<g.length;w++)v=["C",(y=g[w]).x1,y.y1,y.x2,y.y2,y.x,y.y],w<g.length-1&&n.push(v);break;case"S":var _=h,x=f;"C"!=t&&"S"!=t||(_+=_-a,x+=x-s),v=["C",_,x,v[1],v[2],v[3],v[4]];break;case"T":"Q"==t||"T"==t?(c=2*h-c,p=2*f-p):(c=h,p=f),v=o(h,f,c,p,v[1],v[2]);break;case"Q":c=v[1],p=v[2],v=o(h,f,v[1],v[2],v[3],v[4]);break;case"L":v=i(h,f,v[1],v[2]);break;case"H":v=i(h,f,v[1],f);break;case"V":v=i(h,f,h,v[1]);break;case"Z":v=i(h,f,l,u)}t=b,h=v[v.length-2],f=v[v.length-1],v.length>4?(a=v[v.length-4],s=v[v.length-3]):(a=h,s=f),n.push(v)}return n};var r=e("svg-arc-to-cubic-bezier");function i(e,t,n,r){return["C",e,t,n,r,n,r]}function o(e,t,n,r,i,o){return["C",e/3+2/3*n,t/3+2/3*r,i/3+2/3*n,o/3+2/3*r,i,o]}},{"svg-arc-to-cubic-bezier":47}],43:[function(e,t,n){var r=e("color-convert");t.exports=function(e){var t,n,i,o;if(t=/^((?:rgb|hs[lv]|cmyk|xyz|lab)a?)\s*\(([^\)]*)\)/.exec(e)){var a=t[1],s="cmyk"===(l=a.replace(/a$/,""))?4:3;n=r[l],i=t[2].replace(/^\s+|\s+$/g,"").split(/\s*,\s*/).map(function(e,t){return/%$/.test(e)&&t===s?parseFloat(e)/100:(/%$/.test(e),parseFloat(e))}),a===l&&i.push(1),o=void 0===i[s]?1:i[s],i=i.slice(0,s),n[l]=function(){return i}}else if(/^#[A-Fa-f0-9]+$/.test(e)){var l=e.replace(/^#/,"");n=r.rgb,i=(i=l.split(3===(s=l.length)?/(.)/:/(..)/)).filter(Boolean).map(function(e){return 3===s?parseInt(e+e,16):parseInt(e,16)}),o=1,n.rgb=function(){return i},i[0]||(i[0]=0),i[1]||(i[1]=0),i[2]||(i[2]=0)}else(n=r.keyword).keyword=function(){return e},i=e,o=1;var u={rgb:void 0,hsl:void 0,hsv:void 0,cmyk:void 0,keyword:void 0,hex:void 0};try{u.rgb=n.rgb(i)}catch(e){}try{u.hsl=n.hsl(i)}catch(e){}try{u.hsv=n.hsv(i)}catch(e){}try{u.cmyk=n.cmyk(i)}catch(e){}try{u.keyword=n.keyword(i)}catch(e){}return u.rgb&&(u.hex="#"+u.rgb.map(function(e){var t=e.toString(16);return 1===t.length?"0"+t:t}).join("")),u.rgb&&(u.rgba=u.rgb.concat(o)),u.hsl&&(u.hsla=u.hsl.concat(o)),u.hsv&&(u.hsva=u.hsv.concat(o)),u.cmyk&&(u.cmyka=u.cmyk.concat(o)),u}},{"color-convert":36}],44:[function(e,t,n){t.exports=function(e){var t=[];return e.replace(i,function(e,n,i){var a=n.toLowerCase();for(i=function(e){var t=e.match(o);return t?t.map(Number):[]}(i),"m"==a&&i.length>2&&(t.push([n].concat(i.splice(0,2))),a="l",n="m"==n?"l":"L");;){if(i.length==r[a])return i.unshift(n),t.push(i);if(i.length<r[a])throw new Error("malformed path data");t.push([n].concat(i.splice(0,r[a])))}}),t};var r={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},i=/([astvzqmhlc])([^astvzqmhlc]*)/gi;var o=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi},{}],45:[function(e,t,n){t.exports=function(e){e=void 0!==e?e:1,Array.isArray(e)||(e=[e,e]);var t=[[-e[0],-e[1],0],[e[0],-e[1],0],[e[0],e[1],0],[-e[0],e[1],0]],n=[0,0,-1],r=[n.slice(),n.slice(),n.slice(),n.slice()];return{positions:t,cells:[[0,1,2],[2,3,0]],uvs:[[0,0],[1,0],[1,1],[0,1]],normals:r}}},{}],46:[function(e,t,n){(function(e){(function(){"use strict";var n=256,r=[],i=void 0===e?window:e,o=Math.pow(n,6),a=Math.pow(2,52),s=2*a,l=n-1,u=Math.random;function c(e){var t,r=e.length,i=this,o=0,a=i.i=i.j=0,s=i.S=[];for(r||(e=[r++]);o<n;)s[o]=o++;for(o=0;o<n;o++)s[o]=s[a=l&a+e[o%r]+(t=s[o])],s[a]=t;(i.g=function(e){for(var t,r=0,o=i.i,a=i.j,s=i.S;e--;)t=s[o=l&o+1],r=r*n+s[l&(s[o]=s[a=l&a+t])+(s[a]=t)];return i.i=o,i.j=a,r})(n)}function p(e,t){for(var n,r=e+"",i=0;i<r.length;)t[l&i]=l&(n^=19*t[l&i])+r.charCodeAt(i++);return h(t)}function h(e){return String.fromCharCode.apply(0,e)}t.exports=function(e,l){if(l&&!0===l.global)return l.global=!1,Math.random=t.exports(e,l),l.global=!0,Math.random;var u=[],f=(p(function e(t,n){var r,i=[],o=(typeof t)[0];if(n&&"o"==o)for(r in t)try{i.push(e(t[r],n-1))}catch(e){}return i.length?i:"s"==o?t:t+"\0"}(l&&l.entropy||!1?[e,h(r)]:0 in arguments?e:function(e){try{return i.crypto.getRandomValues(e=new Uint8Array(n)),h(e)}catch(e){return[+new Date,i,i.navigator&&i.navigator.plugins,i.screen,h(r)]}}(),3),u),new c(u));return p(h(f.S),r),function(){for(var e=f.g(6),t=o,r=0;e<a;)e=(e+r)*n,t*=n,r=f.g(1);for(;e>=s;)e/=2,t/=2,r>>>=1;return(e+r)/t}},t.exports.resetGlobal=function(){Math.random=u},p(Math.random(),r)}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],47:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=2*Math.PI,o=function(e,t,n,r,i,o,a){var s=e.x,l=e.y;return{x:r*(s*=t)-i*(l*=n)+o,y:i*s+r*l+a}},a=function(e,t){var n=1.5707963267948966===t?.551915024494:-1.5707963267948966===t?-.551915024494:4/3*Math.tan(t/4),r=Math.cos(e),i=Math.sin(e),o=Math.cos(e+t),a=Math.sin(e+t);return[{x:r-i*n,y:i+r*n},{x:o+a*n,y:a-o*n},{x:o,y:a}]},s=function(e,t,n,r){var i=e*n+t*r;return i>1&&(i=1),i<-1&&(i=-1),(e*r-t*n<0?-1:1)*Math.acos(i)};n.default=function(e){var t=e.px,n=e.py,l=e.cx,u=e.cy,c=e.rx,p=e.ry,h=e.xAxisRotation,f=void 0===h?0:h,d=e.largeArcFlag,m=void 0===d?0:d,v=e.sweepFlag,b=void 0===v?0:v,g=[];if(0===c||0===p)return[];var y=Math.sin(f*i/360),w=Math.cos(f*i/360),_=w*(t-l)/2+y*(n-u)/2,x=-y*(t-l)/2+w*(n-u)/2;if(0===_&&0===x)return[];c=Math.abs(c),p=Math.abs(p);var k=Math.pow(_,2)/Math.pow(c,2)+Math.pow(x,2)/Math.pow(p,2);k>1&&(c*=Math.sqrt(k),p*=Math.sqrt(k));var C=function(e,t,n,r,o,a,l,u,c,p,h,f){var d=Math.pow(o,2),m=Math.pow(a,2),v=Math.pow(h,2),b=Math.pow(f,2),g=d*m-d*b-m*v;g<0&&(g=0),g/=d*b+m*v;var y=(g=Math.sqrt(g)*(l===u?-1:1))*o/a*f,w=g*-a/o*h,_=p*y-c*w+(e+n)/2,x=c*y+p*w+(t+r)/2,k=(h-y)/o,C=(f-w)/a,E=(-h-y)/o,A=(-f-w)/a,P=s(1,0,k,C),M=s(k,C,E,A);return 0===u&&M>0&&(M-=i),1===u&&M<0&&(M+=i),[_,x,P,M]}(t,n,l,u,c,p,m,b,y,w,_,x),E=r(C,4),A=E[0],P=E[1],M=E[2],S=E[3],T=Math.abs(S)/(i/4);Math.abs(1-T)<1e-7&&(T=1);var V=Math.max(Math.ceil(T),1);S/=V;for(var j=0;j<V;j++)g.push(a(M,S)),M+=S;return g.map(function(e){var t=o(e[0],c,p,w,y,A,P),n=t.x,r=t.y,i=o(e[1],c,p,w,y,A,P),a=i.x,s=i.y,l=o(e[2],c,p,w,y,A,P);return{x1:n,y1:r,x2:a,y2:s,x:l.x,y:l.y}})},t.exports=n.default},{}],48:[function(e,t,n){var r=e("adaptive-bezier-curve"),i=e("abs-svg-path"),o=e("normalize-svg-path"),a=e("vec2-copy");function s(e,t,n){return e[0]=t,e[1]=n,e}var l=[0,0],u=[0,0],c=[0,0];t.exports=function(e,t){var n=[],p=[],h=[0,0];return o(i(e)).forEach(function(e,i,o){if("M"===e[0])a(h,e.slice(1)),p.length>0&&(n.push(p),p=[]);else{if("C"!==e[0])throw new Error("illegal type in SVG: "+e[0]);!function(e,t,n,i){r(n,s(l,i[1],i[2]),s(u,i[3],i[4]),s(c,i[5],i[6]),t,e)}(p,t,h,e),s(h,e[5],e[6])}}),p.length>0&&n.push(p),n}},{"abs-svg-path":5,"adaptive-bezier-curve":7,"normalize-svg-path":49,"vec2-copy":50}],49:[function(e,t,n){var r=Math.PI,i=u(120);function o(e,t,n,r){return["C",e,t,n,r,n,r]}function a(e,t,n,r,i,o){return["C",e/3+2/3*n,t/3+2/3*r,i/3+2/3*n,o/3+2/3*r,i,o]}function s(e,t,n,o,a,u,c,p,h,f){if(f)k=f[0],C=f[1],_=f[2],x=f[3];else{var d=l(e,t,-a);t=d.y;var m=((e=d.x)-(p=(d=l(p,h,-a)).x))/2,v=(t-(h=d.y))/2,b=m*m/(n*n)+v*v/(o*o);b>1&&(n*=b=Math.sqrt(b),o*=b);var g=n*n,y=o*o,w=(u==c?-1:1)*Math.sqrt(Math.abs((g*y-g*v*v-y*m*m)/(g*v*v+y*m*m)));Infinity==w&&(w=1);var _=w*n*v/o+(e+p)/2,x=w*-o*m/n+(t+h)/2,k=Math.asin(((t-x)/o).toFixed(9)),C=Math.asin(((h-x)/o).toFixed(9));(k=e<_?r-k:k)<0&&(k=2*r+k),(C=p<_?r-C:C)<0&&(C=2*r+C),c&&k>C&&(k-=2*r),!c&&C>k&&(C-=2*r)}if(Math.abs(C-k)>i){var E=C,A=p,P=h;C=k+i*(c&&C>k?1:-1);var M=s(p=_+n*Math.cos(C),h=x+o*Math.sin(C),n,o,a,0,c,A,P,[C,E,_,x])}var S=Math.tan((C-k)/4),T=4/3*n*S,V=4/3*o*S,j=[2*e-(e+T*Math.sin(k)),2*t-(t-V*Math.cos(k)),p+T*Math.sin(C),h-V*Math.cos(C),p,h];if(f)return j;M&&(j=j.concat(M));for(var O=0;O<j.length;){var D=l(j[O],j[O+1],a);j[O++]=D.x,j[O++]=D.y}return j}function l(e,t,n){return{x:e*Math.cos(n)-t*Math.sin(n),y:e*Math.sin(n)+t*Math.cos(n)}}function u(e){return e*(r/180)}t.exports=function(e){for(var t,n=[],r=0,i=0,l=0,c=0,p=null,h=null,f=0,d=0,m=0,v=e.length;m<v;m++){var b=e[m],g=b[0];switch(g){case"M":l=b[1],c=b[2];break;case"A":(b=s(f,d,b[1],b[2],u(b[3]),b[4],b[5],b[6],b[7])).unshift("C"),b.length>7&&(n.push(b.splice(0,7)),b.unshift("C"));break;case"S":var y=f,w=d;"C"!=t&&"S"!=t||(y+=y-r,w+=w-i),b=["C",y,w,b[1],b[2],b[3],b[4]];break;case"T":"Q"==t||"T"==t?(p=2*f-p,h=2*d-h):(p=f,h=d),b=a(f,d,p,h,b[1],b[2]);break;case"Q":p=b[1],h=b[2],b=a(f,d,b[1],b[2],b[3],b[4]);break;case"L":b=o(f,d,b[1],b[2]);break;case"H":b=o(f,d,b[1],d);break;case"V":b=o(f,d,f,b[1]);break;case"Z":b=o(f,d,l,c)}t=g,f=b[b.length-2],d=b[b.length-1],b.length>4?(r=b[b.length-4],i=b[b.length-3]):(r=f,i=d),n.push(b)}return n}},{}],50:[function(e,t,n){t.exports=function(e,t){return e[0]=t[0],e[1]=t[1],e}},{}],51:[function(e,t,n){const r=e("canvas-sketch"),{math:i,random:o}=e("canvas-sketch-util"),a=e("Tweakpane");let s;const l={dimensions:[1280,1440],animate:!0,parent:document.getElementById("app-canvas")},u={columns:18,rows:24,scaleMin:2,scaleMax:18,frequency:.003,amplitude:.2,frame:0,animate:!0,lineCap:"round"},c=document.createElement("canvas"),p=c.getContext("2d"),h=()=>({context:e,width:t,height:n,frame:r})=>{e.fillStyle="white",e.fillRect(0,0,t,n);const a=u.columns,l=u.rows,h=a*l,f=t/a,d=n/l,m=.5*(t-t),v=.5*(n-n);p.fillStyle="white",c.width=t,c.height=n,p.drawImage(s,0,0,a,l);const b=p.getImageData(0,0,a,l).data;for(let t=0;t<h;t++){const n=t%a*f,s=Math.floor(t/a)*d,l=.6*f,c=b[4*t+0],p=b[4*t+1],h=b[4*t+2],g=o.noise3D(n,s,10*(u.animate?r:u.frame),u.frequency),y=g*Math.PI*u.amplitude,w=i.mapRange(g,-1,1,u.scaleMin,u.scaleMax);e.save(),e.translate(n,s),e.translate(m,v),e.translate(.5*f,.5*d),e.rotate(y),e.lineWidth=w,e.lineCap=u.lineCap,e.beginPath(),e.moveTo(-.5*l,0),e.lineTo(.5*l,0),e.strokeStyle=`rgb(${c}, ${p}, ${h})`,e.stroke(),e.restore()}};(()=>{const e=new a.Pane;let t;(t=e.addFolder({title:"Grid"})).addInput(u,"lineCap",{options:{butt:"butt",round:"round",square:"square"}}),t.addInput(u,"columns",{min:2,max:50,step:1}),t.addInput(u,"rows",{min:2,max:50,step:1}),t.addInput(u,"scaleMin",{min:1,max:100}),t.addInput(u,"scaleMax",{min:1,max:100}),(t=e.addFolder({title:"Noise"})).addInput(u,"frequency",{min:-.01,max:.01}),t.addInput(u,"amplitude",{min:0,max:1}),t.addInput(u,"animate"),t.addInput(u,"frame",{min:0,max:999})})(),(async()=>{s=await(e=>new Promise((t,n)=>{const r=new Image;r.onload=t(r),r.onerror=n(),r.src=e}))("gradient-bg.png"),canvasManager=await r(h,l)})()},{Tweakpane:4,"canvas-sketch":33,"canvas-sketch-util":14}],52:[function(e,t,n){(function(e){(function(){e.CANVAS_SKETCH_DEFAULT_STORAGE_KEY=window.location.href}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[51,52]);
//# sourceMappingURL=index.js.map
